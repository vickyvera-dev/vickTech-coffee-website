(function(g){var window=this;'use strict';var O4$=function(w){var M=new g.mj("und",new g.zm("Default","und",!0));M.captionTracks=w.captionTracks;return M},aPx=function(w){return new g.qa(function(M,P){var u=w.length,X=[];
if(u)for(var U=function(Z,S){u--;X[Z]=S;u==0&&M(X)},f=function(Z){P(Z)},h,c=0;c<w.length;c++)h=w[c],g.JaH(h,g.Wa(U,c),f);
else M(X)})},kU=function(w){this.B=w},R2=function(){kU.apply(this,arguments)},whp=function(){R2.apply(this,arguments)},ih$=function(){R2.apply(this,arguments)},MVE=function(){R2.apply(this,arguments)},Pmp=function(){R2.apply(this,arguments)},uap=function(){R2.apply(this,arguments)},XhU=function(){R2.apply(this,arguments)},$P3=function(){kU.apply(this,arguments)},UPa=function(){R2.apply(this,arguments)},fxE=function(){R2.apply(this,arguments)},WQ4=function(){R2.apply(this,arguments)},hOC=function(){R2.apply(this,
arguments)},c0c=function(){R2.apply(this,arguments)},ZhC=function(){R2.apply(this,arguments)},Sva=function(){R2.apply(this,arguments)},HhE=function(){R2.apply(this,arguments)},phC=function(){R2.apply(this,arguments)},FQc=function(){R2.apply(this,arguments)},EXE=function(){R2.apply(this,arguments)},NTC=function(){R2.apply(this,arguments)},VVE=function(){kU.apply(this,arguments)},mPV=function(){R2.apply(this,arguments)},oXE=function(){R2.apply(this,arguments)},GF$=function(){R2.apply(this,arguments)},
y0E=function(){R2.apply(this,arguments)},DP4=function(){R2.apply(this,arguments)},qv$=function(){R2.apply(this,arguments)},YvC=function(){R2.apply(this,arguments)},zOE=function(){R2.apply(this,arguments)},TT3=function(){R2.apply(this,arguments)},dPh=function(){kU.apply(this,arguments)},lxt=function(){kU.apply(this,arguments)},LQV=function(){kU.apply(this,arguments)},eO3=function(){R2.apply(this,arguments)},BTC=function(){R2.apply(this,arguments)},QLx=function(){R2.apply(this,arguments)},kFE=function(){R2.apply(this,
arguments)},RO4=function(){R2.apply(this,arguments)},nX$=function(){R2.apply(this,arguments)},vXt=function(){R2.apply(this,arguments)},sLc=function(){R2.apply(this,arguments)},KQV=function(){R2.apply(this,arguments)},bh4=function(){R2.apply(this,arguments)},IxV=function(){R2.apply(this,arguments)},A0t=function(){R2.apply(this,arguments)},gXp=function(){R2.apply(this,arguments)},J0$=function(){R2.apply(this,arguments)},r0V=function(){R2.apply(this,arguments)},jLt=function(){R2.apply(this,arguments)},
Cmj=function(){R2.apply(this,arguments)},tVA=function(){R2.apply(this,arguments)},xPV=function(){R2.apply(this,arguments)},Oh3=function(){R2.apply(this,arguments)},axt=function(){R2.apply(this,arguments)},wWt=function(){R2.apply(this,arguments)},iLh=function(){R2.apply(this,arguments)},Mm$=function(){R2.apply(this,arguments)},PYp=function(){R2.apply(this,arguments)},uHA=function(){R2.apply(this,arguments)},XWt=function(){R2.apply(this,arguments)},$2x=function(){kU.apply(this,arguments)},U2j=function(){R2.apply(this,
arguments)},fHc=function(){R2.apply(this,arguments)},WlC=function(){R2.apply(this,arguments)},hqE=function(){R2.apply(this,arguments)},cmc=function(){R2.apply(this,arguments)},ZL3=function(){R2.apply(this,arguments)},SJa=function(){R2.apply(this,arguments)},HLE=function(){R2.apply(this,arguments)},pWA=function(){R2.apply(this,arguments)},Flh=function(){R2.apply(this,arguments)},E4c=function(){R2.apply(this,arguments)},Nnx=function(){R2.apply(this,arguments)},VmC=function(){R2.apply(this,arguments)},
m2j=function(){R2.apply(this,arguments)},o4U=function(){R2.apply(this,arguments)},GKC=function(){R2.apply(this,arguments)},ymj=function(){R2.apply(this,arguments)},D2a=function(){R2.apply(this,arguments)},qJV=function(){R2.apply(this,arguments)},YJc=function(){R2.apply(this,arguments)},zqE=function(){R2.apply(this,arguments)},Tnj=function(){R2.apply(this,arguments)},d2E=function(){R2.apply(this,arguments)},lHE=function(){R2.apply(this,arguments)},LlV=function(){R2.apply(this,arguments)},eq4=function(){R2.apply(this,
arguments)},BnV=function(){R2.apply(this,arguments)},Qut=function(){R2.apply(this,arguments)},kKh=function(){R2.apply(this,arguments)},RqV=function(){R2.apply(this,arguments)},n4C=function(){R2.apply(this,arguments)},v4h=function(){R2.apply(this,arguments)},su$=function(){R2.apply(this,arguments)},Klx=function(w){w=w.key||w.id;
if(!w)throw Error("Entity key is missing");return w},bLU=function(){if(ni)return ni();
var w={};ni=g.CA("PersistentEntityStoreDb",{Mk:(w.EntityStore={XW:1},w.EntityAssociationStore={XW:2},w),shared:!1,upgrade:function(M,P){P(1)&&g.lb(g.Dl(M,"EntityStore",{keyPath:"key"}),"entityType","entityType");P(2)&&(M=g.Dl(M,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.lb(M,"byParentEntityKey","parentEntityKey"),g.lb(M,"byChildEntityKey","childEntityKey"))},
version:3});return ni()},IHx=function(w){return g.vN(bLU(),w)},AmC=function(w){return g.vN((0,g.qSE)(),w)},vq=function(w){this.token=w},si=function(w,M){M=M===void 0?{}:M;
g.bK.call(this,g.YSc[w],Object.assign({},{name:"PESEncoderError",type:w},M));this.type=w;this.level="WARNING";Object.setPrototypeOf(this,si.prototype)},g4t=function(w){return new si("WRONG_DATA_TYPE",{b7:w})},Jmh=function(w){return w instanceof Error?new si("UNKNOWN_ENCODE_ERROR",{originalMessage:w.message}):new si("UNKNOWN_ENCODE_ERROR")},rmA=function(w){return w instanceof Error?new si("UNKNOWN_DECODE_ERROR",{originalMessage:w.message}):new si("UNKNOWN_DECODE_ERROR")},juU=function(w,M){w=w instanceof
si?w:M(w);
g.qU(w);throw w;},CYx=function(){},tmA=function(w,M,P){try{return w.C(M,P)}catch(u){juU(u,Jmh)}},x2E=function(w){w=(new TextEncoder).encode(w).subarray(0,16);
var M=new Uint8Array(16);M.set(w);return M},Ki=function(w){this.B=w},aHp=function(w){var M=OLC[w];
if(M)return M;g.Yq(new g.bK("Entity model not found.",{entityType:w}))},wXA=function(w,M){this.B=w;
this.L=M;this.C={}},M7C=function(w,M){a:{w=iyj(w.L,M.version);
try{var P=w.L(M.data,M.key);break a}catch(u){juU(u,rmA)}P=void 0}return P},bI=function(w,M,P){return w.B.objectStore("EntityStore").get(M).then(function(u){if(u){if(P&&u.entityType!==P)throw Error("Incorrect entity type");
return M7C(w,u)}})},I2=function(w,M,P){return P?(P=P.map(function(u){return bI(w,u,M)}),g.NZ.all(P)):w.B.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(M)).then(function(u){return u.map(function(X){return M7C(w,X)})})},gP=function(w,M,P){var u=Klx(M),X=iyj(w.L,1),U=Object.assign({},M);
return w.B.objectStore("EntityStore").get(u).then(function(f){if(f){if(f.entityType!==P)throw Error("Incorrect entity type");U.entityMetadata||(f=M7C(w,f),U.entityMetadata=f.entityMetadata)}}).then(function(){var f={key:u,
entityType:P,data:tmA(X,U,u),version:1};return g.NZ.all([g.z$(w.B.objectStore("EntityStore"),f),POC(w,U,P)])}).then(function(){Aq(w,u,P);
return u})},u4c=function(w,M,P){M=M.map(function(u){return gP(w,u,P)});
return g.NZ.all(M)},Jq=function(w,M,P){if(P==null?0:P.HO){var u=new Set;
return XXE(w,M,u).then(function(){for(var U=[],f=g.G(u),h=f.next();!h.done;h=f.next())U.push(Jq(w,h.value));return g.NZ.all(U).then(function(){})})}var X=g.Jt(M).entityType;
return g.NZ.all([w.B.objectStore("EntityStore").delete(M),$a3(w,M)]).then(function(){Aq(w,M,X)})},UaE=function(w,M){return g.QS(w.B.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(M)},function(P){return g.NZ.all([P.delete(),
$a3(w,P.cursor.primaryKey)]).then(function(){Aq(w,P.cursor.primaryKey,M);return g.eP(P)})})},fGU=function(w,M,P,u){var X=iyj(w.L,1);
return bI(w,M,u).then(function(U){if(U){U=g.wt(U,P);var f={key:M,entityType:u,data:tmA(X,U,M),version:1};return g.NZ.all([g.z$(w.B.objectStore("EntityStore"),f),POC(w,U,u)])}}).then(function(){Aq(w,M,u);
return M})},Aq=function(w,M,P){var u=w.C[P];
u||(u=new Set,w.C[P]=u);u.add(M)},Wqh=function(w,M,P){var u=Klx(M);
P=aHp(P);if(!P)return g.NZ.resolve([]);P=new P(M);w=w.B.objectStore("EntityAssociationStore");M=[];P=g.G(P.L());for(var X=P.next();!X.done;X=P.next())M.push(g.z$(w,{parentEntityKey:u,childEntityKey:X.value}));return g.NZ.all(M).then(function(U){return U.map(function(f){return f[1]})})},$a3=function(w,M){return w.B.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(M))},POC=function(w,M,P){var u=Klx(M);
return $a3(w,u).then(function(){return Wqh(w,M,P)})},XXE=function(w,M,P){if(P.has(M))return g.NZ.resolve(void 0);
P.add(M);return hBU(w,M).then(function(u){return w.B.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(M)).then(function(){return u})}).then(function(u){var X=g.NZ.resolve(void 0);
u=g.G(u);for(var U=u.next(),f={};!U.done;f={IU:void 0},U=u.next())f.IU=U.value,X=X.then(function(h){return function(){return XXE(w,h.IU,P)}}(f));
return X}).then(function(){})},hBU=function(w,M){var P=w.B.objectStore("EntityAssociationStore");
return P.index("byParentEntityKey").getAll(IDBKeyRange.only(M)).then(function(u){var X=[];u=g.G(u);for(var U=u.next();!U.done;U=u.next())U=U.value,X.push(P.index("byChildEntityKey").getAll(U.childEntityKey));return g.NZ.all(X)}).then(function(u){var X=[];
u=g.G(u);for(var U=u.next();!U.done;U=u.next())U=U.value,U.length===1&&X.push(U[0].childEntityKey);return X})},rP=function(){},cnV=function(){this.B={};
this.B[0]=new rP;if(!g.FW("aes_pes_encoder_killswitch")){var w=this.B;try{var M=g.IS();var P=x2E(M);var u=new Ki(new g.$W(P),new g.Us(P))}catch(X){throw w=X instanceof Error?new si("KEY_CREATION_FAILED",{originalMessage:X.message}):new si("KEY_CREATION_FAILED"),g.qU(w),w;}w[1]=u}},iyj=function(w,M){M=M===void 0?0:M;
w=w.B[M];if(!w)throw M=new si("INVALID_ENCODER_VERSION",{b7:M}),g.qU(M),M;return w},js=function(w,M){g.v.call(this);
this.token=w;this.B=M;this.observers=[];w=new g.aF.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.IS());w.onmessage=this.L.bind(this);this.channel=w},Ci=function(w,M,P){var u,X,U,f;
return g.n(function(h){if(h.L==1)return g.B(h,IHx(w.token),2);if(h.L!=3)return u=h.B,g.B(h,g.Y1(u,["EntityStore","EntityAssociationStore"],M,function(c){X=new wXA(c,w.B);return P(X)}),3);
U=h.B;X&&(f=X.C,Object.keys(f).length>0&&(w.channel.postMessage(f),ZyU(w,f)));return h.return(U)})},tq=function(w,M,P){return Ci(w,{mode:"readwrite",
UF:!0},function(u){return gP(u,M,P)})},SZE=function(w,M){return Ci(w,{mode:"readwrite",
UF:!0},function(P){return u4c(P,M,"offlineOrchestrationActionWrapperEntity")})},Hyp=function(w,M){return Ci(w,{mode:"readwrite",
UF:!0},function(P){return Jq(P,M)})},pX3=function(w){return Ci(w,{mode:"readwrite",
UF:!0},function(M){return UaE(M,"videoPlaybackPositionEntity")})},xU=function(w,M,P){return Ci(w,{mode:"readonly",
UF:!0},function(u){return bI(u,M,P)})},Oi=function(w,M,P){return Ci(w,{mode:"readonly",
UF:!0},function(u){return I2(u,M,P)})},ZyU=function(w,M){w=g.G(w.observers);
for(var P=w.next();!P.done;P=w.next())P=P.value,P(M)},FqA=function(){var w,M,P;
return g.n(function(u){if(u.L==1)return g.DU(u,2),g.B(u,g.rK(),4);if(u.L!=2){w=u.B;if(!w||!g.AS()||typeof g.aF.BroadcastChannel==="undefined")return u.return();M=new cnV;return u.return(new js(w,M))}P=g.d4(u);P instanceof Error&&g.qU(P);return u.return()})},a2=function(){Ev$||(Ev$=FqA());
return Ev$},Nbc=function(w){var M;
w=(M=w.options)==null?void 0:M.persistenceOption;return w==="ENTITY_PERSISTENCE_OPTION_PERSIST"||w==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},V7U=function(w){var M;
return g.n(function(P){return P.L==1?g.B(P,a2(),2):(M=P.B)?g.B(P,Ci(M,"readwrite",function(u){for(var X={},U=g.G(w),f=U.next(),h={};!f.done;h={sQ:void 0,Vy:void 0},f=U.next())h.sQ=f.value,h.sQ.entityKey&&Nbc(h.sQ)&&(h.Vy=g.$s(h.sQ.payload),f=void 0,h.sQ.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(f=function(c){return function(){return gP(u,c.sQ.payload[c.Vy],c.Vy)}}(h)),h.sQ.type==="ENTITY_MUTATION_TYPE_DELETE"&&(f=function(c){return function(){return Jq(u,c.sQ.entityKey)}}(h)),h.sQ.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(f=function(c){return function(){return fGU(u,c.sQ.entityKey,c.sQ.payload[c.Vy],c.Vy)}}(h)),f&&(X[h.sQ.entityKey]=X[h.sQ.entityKey]?X[h.sQ.entityKey].then(f):f()));
return g.NZ.all(Object.values(X))}),0):P.return()})},map=function(w){var M;
return g.n(function(P){if(P.L==1){M=w.mutations;if(!M||M.length<=0)return P.return();if(g.H7){var u={type:"ENTITY_LOADED"};M!==void 0&&(u.payload=M);g.H7.dispatch(u)}return g.B(P,V7U(M),2)}M.length=0;g.yx(P)})},ovC=function(w){return w!==void 0},GSE=function(w){var M=g.bT();
M=Object.assign({},M);w=Object.assign({},w);for(var P in M)w[P]?(M[P]!==4&&(M[P]=w[P]),delete w[P]):M[P]!==2&&(M[P]=4);Object.assign(M,w);g.mS_(M);JSON.stringify(M);return M},yn3=function(w){var M,P;
return g.n(function(u){if(u.L==1)return g.B(u,g.rK(),2);if(u.L!=3)return(M=u.B)?g.B(u,g.gD(M),3):u.return();P=u.B;return u.return(g.Y1(P,["index","media","captions"],{mode:"readwrite",UF:!0},function(X){var U=IDBKeyRange.bound(w+"|",w+"~");X=[X.objectStore("index").delete(U),X.objectStore("media").delete(U),X.objectStore("captions").delete(U)];return g.NZ.all(X).then(function(){})}))})},Da3=function(){var w,M;
return g.n(function(P){if(P.L==1)return g.B(P,g.rK(),2);if(P.L!=3){w=P.B;if(!w)throw g.F7("rvdfd");return g.B(P,g.gD(w),3)}M=P.B;return P.return(g.Y1(M,["index","media"],{mode:"readwrite",UF:!0},function(u){var X={};return g.LA(u.objectStore("index"),{},function(U){var f=U.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),h=g.NZ.resolve(void 0);if(f){var c=f[1];f=f[2];X[c]=X[c]||{};var Z;X[c][f]=g.qGu((Z=U.getValue())==null?void 0:Z.fmts)}else h=U.delete().then(function(){});
return g.NZ.all([g.eP(U),h]).then(function(S){return g.G(S).next().value})}).then(function(){for(var U={},f=g.G(Object.keys(X)),h=f.next();!h.done;h=f.next()){h=h.value;
var c=X[h].v;U[h]=X[h].a&&c?1:2}var Z=GSE(U);return g.zTx(u.objectStore("media"),{},function(S){var H=S.cursor.key.match(g.dSz);H&&U[H[1]]||u.objectStore("media").delete(S.cursor.key);return g.NVU(S)}).then(function(){return Z})})}))})},qZC=function(w,M){var P,u;
return g.n(function(X){if(X.L==1)return g.B(X,g.rK(),2);if(X.L!=3){P=X.B;if(!P)throw g.F7("wct");return g.B(X,g.gD(P),3)}u=X.B;return g.B(X,g.Y1(u,["captions"],{mode:"readwrite",UF:!0},function(U){var f=[];U=U.objectStore("captions");for(var h=0;h<M.length;h++){var c=g.z$(U,M[h],w+"|"+M[h].metadata.vss_id);f.push(c)}return g.NZ.all(f)}),0)})},YZ4=function(w){var M,P,u;
return g.n(function(X){if(X.L==1)return M=IDBKeyRange.bound(w+"|",w+"~"),g.B(X,g.rK(),2);if(X.L!=3){P=X.B;if(!P)throw g.F7("gactfv");return g.B(X,g.gD(P),3)}u=X.B;return X.return(u.getAll("captions",M))})},zBC=function(w){return g.n(function(M){g.AW(w,0);
return M.return(yn3(w))})},Tbj=function(w){return{context:g.Jb(),
videoIds:w}},daC=function(w){return{context:g.Jb(),
playlistIds:w}},lGE=function(w){return{context:g.Jb(),
offlinePlaylistSyncChecks:w}},Lq$=function(){this.B=new Map},BbE=function(){eBC||(eBC=new Lq$);
return eBC},QVE=function(w,M){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:w},metadata:M,statusCode:void 0,csn:void 0,can:void 0}},kSt=function(w,M,P){if(!P){var u=u===void 0?!1:u;
P=w.B.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!P||u)P=g.Hl(16),w.B.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",P)}w={flowNonce:P,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:M.eventType};M.metadata&&(w.flowMetadata=M.metadata);M.statusCode!==void 0&&(w.flowEventStatus=M.statusCode);M.csn&&(w.csn=M.csn);M.can&&(w.can=M.can);g.ub("flowEvent",w,void 0)},RBc=function(w){var M,P,u,X,U,f,h,c,Z,S,H,p,F,E,y,q,d,l,e,R,I,w4,t,$M,fz,U1,ZU,M_,Tp,kM,w3,sE,Vt,v5,OE,pC,g3,MK,T,nE;
return g.n(function(ep){if(ep.L==1)return g.B(ep,Ci(w,{mode:"readonly",UF:!0},function(P5){return I2(P5,"playbackData").then(function(d3){var D=d3.map(function(KC){return KC.transfer}).filter(function(KC){return!!KC}),i2=d3.map(function(KC){return KC.offlineVideoPolicy}).filter(function(KC){return!!KC}),J5=d3.filter(function(KC){return!!KC.key}).map(function(KC){return g.rt(g.Jt(KC.key).entityId,"downloadStatusEntity")});
D=I2(P5,"transfer",D);i2=I2(P5,"offlineVideoPolicy",i2);J5=I2(P5,"downloadStatusEntity",J5);var fQ=D.then(function(KC){KC=KC.reduce(function(g4,O1){(O1==null?0:O1.offlineVideoStreams)&&g4.push.apply(g4,g.L(O1.offlineVideoStreams));return g4},[]).filter(function(g4){return!!g4});
return I2(P5,"offlineVideoStreams",KC)});
return g.NZ.all([D,i2,fQ,J5]).then(function(KC){var g4=g.G(KC);KC=g4.next().value;var O1=g4.next().value;var aK=g4.next().value;g4=g4.next().value;return[d3,KC,O1,aK,g4]})})}),2);
if(ep.L!=3)return M=ep.B,g.B(ep,Ci(w,{mode:"readonly",UF:!0},function(P5){return I2(P5,"mainDownloadsListEntity").then(function(d3){var D,i2;return(i2=(D=d3[0])==null?void 0:D.downloads)!=null?i2:[]})}),3);
P=ep.B;u=g.G(M);X=u.next().value;U=u.next().value;f=u.next().value;h=u.next().value;c=u.next().value;Z=X;S=U;H=f;p=h;F=c;E={};y={};q={};d={};l={};e=[];R=g.G(S);for(I=R.next();!I.done;I=R.next())(w4=I.value)&&(E[w4.key]=w4);t=g.G(H);for($M=t.next();!$M.done;$M=t.next())(fz=$M.value)&&(y[fz.key]=fz);U1=g.G(F);for(ZU=U1.next();!ZU.done;ZU=U1.next())(M_=ZU.value)&&(q[M_.key]=M_);Tp=g.G(p);for(kM=Tp.next();!kM.done;kM=Tp.next())(w3=kM.value)&&(d[w3.key]=w3);sE=g.G(P);for(Vt=sE.next();!Vt.done;Vt=sE.next())v5=
Vt.value,OE=void 0,l[(OE=v5.videoItem)!=null?OE:""]=!0,v5.videoItem&&(g3=pC=void 0,MK=(g3=(pC=g.Jt(v5.videoItem))==null?void 0:pC.entityId)!=null?g3:"",e.push({externalVideoId:MK}));T=Z.filter(function(P5){if(!P5||!P5.key||!P5.offlineVideoPolicy)return!1;P5=g.Jt(P5.key).entityId;P5=g.rt(P5,"downloadStatusEntity");var d3;return!(P5&&((d3=q[P5])==null?void 0:d3.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
nE=T.map(function(P5){var d3=E[P5.transfer],D=[];if(d3==null?0:d3.offlineVideoStreams)for(var i2=g.G(d3.offlineVideoStreams),J5=i2.next();!J5.done;J5=i2.next())(J5=d[J5.value])&&D.push(J5);i2=y[P5.offlineVideoPolicy];J5=l;var fQ=P5==null?void 0:P5.playerResponseTimestamp,KC=g.Jt(i2.key).entityId;P5=g.rt(KC,"mainVideoEntity");if(i2.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var g4="OFFLINE_VIDEO_STATE_DISABLED";i2.expirationTimestamp&&Number(i2.expirationTimestamp)<Date.now()/1E3&&(g4="OFFLINE_VIDEO_STATE_EXPIRED")}else if(i2.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")g4="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(d3==null?void 0:d3.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":g4="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":g4="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":g4="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":g4="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":g4="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":g4="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:g4="OFFLINE_VIDEO_STATE_UNKNOWN"}if(g4==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(d3==null?void 0:d3.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":g4="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":g4="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":g4=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}KC={id:KC,videoState:g4};if(d3==null?0:d3.cotn)KC.cotn=d3.cotn;if(d3==null?0:d3.maximumDownloadQuality)KC.selectedVideoQuality=d3==null?void 0:d3.maximumDownloadQuality;if(d3==null?0:d3.lastProgressTimeMs)KC.lastProgressTimeMs=d3.lastProgressTimeMs;fQ&&(KC.playerResponseSavedTimeMs=String(Number(fQ)*1E3));d3=String;fQ=0;D=g.G(D);for(g4=D.next();!g4.done;g4=D.next())if(g4=g4.value,g4.streamsProgress){g4=g.G(g4.streamsProgress);for(var O1=g4.next();!O1.done;O1=g4.next()){var aK=
void 0;fQ+=Number((aK=O1.value.numBytesDownloaded)!=null?aK:0)}}KC.downloadedBytes=d3(fQ);KC.selectedOfflineMode=J5[P5]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";i2.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(KC.offlinePlaybackDisabledReason=i2.offlinePlaybackDisabledReason);return KC});
return ep.return({offlineVideos:nE,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:e}}})})},nvV=function(){this.locks=navigator.locks},vvx=function(){try{var w=g.Mj("ytglobal.locks_");
if(w)return w;var M;if(M=navigator){var P=navigator;M="locks"in P&&!!P.locks}if(M)return g.aF.localStorage&&g.aF.localStorage.getItem("noop"),w=new nvV,g.ih("ytglobal.locks_",w),w}catch(u){}},wl=function(){},sVa=function(){},Kq3=function(w){if(w.includes(":"))throw Error("Invalid user cache name: "+w);
return w+":"+g.IS("CacheStorage get")},bya=function(){return g.n(function(w){if(Mz!==void 0)return w.return(Mz);
Mz=new Promise(function(M){var P;return g.n(function(u){switch(u.L){case 1:return g.DU(u,2),g.B(u,PK.open("test-only"),4);case 4:return g.B(u,PK.delete("test-only"),5);case 5:g.zp(u,3);break;case 2:if(P=g.d4(u),P instanceof Error&&P.name==="SecurityError")return M(!1),u.return();case 3:M("caches"in window),g.yx(u)}})});
return w.return(Mz)})},Ant=function(){return g.n(function(w){if(w.L==1)return g.B(w,bya(),2);
if(!w.B)return w.return(void 0);IGE||(IGE=new sVa);return w.return(IGE)})},uf=function(w,M,P){g.Yq(new g.bK("Woffle: "+w,P?{cotn:P}:""));
M instanceof Error&&g.Yq(M)},gvE=function(w){var M;
return g.n(function(P){if(P.L==1)return g.B(P,RBc(w),2);M=P.B;g.ub("offlineStateSnapshot",M);g.yx(P)})},Xe=function(w){g.v.call(this);
var M=this;this.api=w;this.yH={u1$:function(){return M.B},
f$$:function(){return M.L}};
typeof g.aF.BroadcastChannel!=="undefined"&&(this.B=new g.aF.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.IS()),this.B.onmessage=this.C.bind(this),this.L=new g.aF.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.IS()),this.L.onmessage=this.X.bind(this))},$Z=function(w,M){w.api.Vs("onOfflineOperationFailure",M);
var P;(P=w.B)==null||P.postMessage(M)},JnU=function(w,M,P,u){var X=this;
this.V=w;this.S=M;this.visibility=P;this.D=u;this.G=this.j=this.K=this.C=this.B=!1;this.X=new g.gV(function(){X.T8()});
this.yH={LL:function(){return X.L},
T8:function(){X.T8()},
mM9:function(){return X.X}};
this.visibility.subscribe("visibilitystatechange",function(){X.fV()})},rnE=function(w){if(!w.C&&!w.B){var M=vvx();
if(M){w.C=!0;var P=g.IS("OfflineLockManager");M.request("woffle_orchestration_leader:"+P,{},function(){var u,X,U,f;return g.n(function(h){switch(h.L){case 1:return g.DU(h,2),w.L=new g.hC,w.B=!0,w.C=!1,g.B(h,w.V(),4);case 4:return g.B(h,w.L.promise,5);case 5:g.zp(h,0);break;case 2:u=g.d4(h),((U=(X=w).D)==null?0:U.call(X,"wo_relinquish_leadership_on_lock_request_error"))||w.T8(),u instanceof Error&&(f=u,f.args=[{name:"WoLockManagerError",pY:u.name}],g.qU(f)),g.yx(h)}})})}}},jV4=function(w){w.B&&(w.G=
!0,Ut(w))},COt=function(w,M){w.B&&(w.K=M,Ut(w))},t7U=function(w,M){w.B&&(w.j=M,Ut(w))},Ut=function(w){w.j&&w.K&&w.G&&w.visibility.isBackground()?g.JK(w.X,6E4):w.X.stop()},fv=function(w){var M;
w.offlineDeleteReason=(M=w.offlineDeleteReason)!=null?M:"OFFLINE_DELETE_REASON_UNKNOWN";var P;w.offlineModeType=(P=w.offlineModeType)!=null?P:"OFFLINE_NOW";g.ub("offlineDeleteEvent",w)},WK=function(w,M){var P=M.videoId;
var u=M.oG;M=M.offlineModeType;w.encryptedVideoId=P;w.cotn=u==null?void 0:u.cotn;w.offlineabilityFormatType=u==null?void 0:u.maximumDownloadQuality;var X;w.isRefresh=(X=u==null?void 0:u.isRefresh)!=null?X:!1;var U;w.softErrorCount=(U=u==null?void 0:u.transferRetryCount)!=null?U:0;w.offlineModeType=M!=null?M:"OFFLINE_NOW";(w.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&w.statusType==="UNKNOWN_STATUS_TYPE"||!w.transferStatusType&&!w.statusType)&&g.Yq(Error("Woffle unknown transfer status"));
g.ub("offlineTransferStatusChanged",w)},xax=function(w){WK({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},w)},Oya=function(w,M,P,u){u={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!u};M&&P&&(M=Math.floor(M/1024).toFixed(),P=Math.floor(P/1024).toFixed(),u.alreadyDownloadedKbytes=M,u.totalFetchedKbytes=M,u.totalContentKbytes=P);WK(u,w)},aG4=function(w){WK({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},w)},w_A=function(w){WK({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},w)},iZh=function(w){switch(w){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
hG=function(w){var M,P,u;
return((u=(M=w.actionMetadata)==null?void 0:(P=M.retryScheduleIntervalsInSeconds)==null?void 0:P.length)!=null?u:0)>0},cK=function(w){return w.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!w.entityKey},ZF=function(w){return w.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!w.entityKey},SE=function(w){return w.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!w.entityKey},M6p=function(w){return w.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!w.entityKey},
HK=function(w,M,P,u,X){X=X===void 0?!1:X;
var U,f,h,c,Z,S;return g.n(function(H){if(H.L==1)return U=g.rt(w,M),f=g.rt(w,"downloadStatusEntity"),g.B(H,Ci(P,{mode:"readonly",UF:!0},function(p){return g.NZ.all([bI(p,U,M),bI(p,f,"downloadStatusEntity")])}),2);
h=H.B;c=h.length?h[0]:void 0;if(!c)return H.M0(0);Z=PzU;if(S=h.length>1?h[1]:void 0){if(S.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!X)return H.return();S.downloadState=u}else S={key:f,downloadState:u};g.Lq(c,Z,S);return g.B(H,Ci(P,{mode:"readwrite",UF:!0},function(p){return g.NZ.all([gP(p,c,M),gP(p,S,"downloadStatusEntity")])}),0)})},pv=function(w,M){return w.actionType===M.actionType&&w.entityKey===M.entityKey},Fe=function(w,M){if(w&&w.transferState!=="TRANSFER_STATE_COMPLETE"&&w.transferState!==
"TRANSFER_STATE_FAILED"){var P=g.Jt(w.key).entityId;
WK({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:P,oG:w,offlineModeType:M})}},Et=function(w){if(!w||!w.thumbnails)return[];
var M=[];w=g.G(w.thumbnails);for(var P=w.next();!P.done;P=w.next())P=P.value,P.url&&M.push(P.url);return M},u13=function(w,M,P){P=P===void 0?[]:P;
var u,X,U,f,h,c,Z,S,H,p,F,E,y;return g.n(function(q){if(q.L==1)return P.length?g.B(q,Oi(w,M),2):q.return([]);u=q.B;X=new Set;U=g.G(u);for(f=U.next();!f.done;f=U.next())if(h=f.value,c=h.id||h.key)Z=g.Jt(c).entityId,X.add(Z);S=[];H=g.G(P);for(p=H.next();!p.done;p=H.next())F=p.value,E=F.offlineVideoData,y=void 0,((y=E)==null?0:y.videoId)&&!X.has(E.videoId)&&S.push(F);return q.return(S)})},X_U=function(w,M,P){return new g.ut(w,{cotn:M,
raw_player_response:P,download_media:!0,start:Infinity,disable_watch_next:!0})},$Mc=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},Nz=function(w,M,P,u,X,U,f,h,c,Z,S){this.entityType=w;
this.actionId=M;this.action=P;this.parentActionId=u;this.rootActionId=X===void 0?M:X;this.childActionIds=U;this.prereqActionId=f;this.postreqActionIds=h;this.hasChildActionFailed=Z;this.retryScheduleIndex=0;this.B=S||Date.now();this.retryScheduleIndex=c||0},Vu=function(w){if(!w.key)throw Error("Entity key is required.");
if(!w.actionProto)throw Error("OfflineOrchestrationAction is required.");var M=g.Jt(w.key),P=g.Jt(w.actionProto.entityKey);return new Nz(P.entityType,M.entityId,w.actionProto,w.parentActionId,w.rootActionId,w.childActionIds,w.prereqActionId,w.postreqActionIds,w.retryScheduleIndex,w.hasChildActionFailed,Number(w.enqueueTimeSec)*1E3)},mW=function(w){return{key:g.rt(w.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:w.action,parentActionId:w.parentActionId,rootActionId:w.rootActionId,childActionIds:w.childActionIds,prereqActionId:w.prereqActionId,postreqActionIds:w.postreqActionIds,retryScheduleIndex:w.retryScheduleIndex,hasChildActionFailed:w.hasChildActionFailed,enqueueTimeSec:(w.B/1E3).toFixed()}},UME=function(){var w;
return g.n(function(M){return M.L==1?g.B(M,Ant(),2):(w=M.B)?M.return(w.delete("yt-player-local-img")):M.return(!0)})},oq=function(w){var M,P;
return g.n(function(u){if(u.L==1)return g.B(u,Ant(),2);if(u.L!=3){M=u.B;if(!M)throw Error("Cache API not supported");return w.length?g.B(u,M.open("yt-player-local-img"),3):u.return()}P=u.B;return g.B(u,Promise.all(w.map(function(X){return P.delete(X)})),0)})},Gh=function(w){var M,P;
return g.n(function(u){if(u.L==1)return g.B(u,Ant(),2);if(u.L!=3){M=u.B;if(!M)throw Error("Cache API not supported");return w.length?g.B(u,M.open("yt-player-local-img"),3):u.return()}P=u.B;return g.B(u,P.addAll(w),0)})},yu=function(w,M,P,u,X){var U,f,h,c,Z,S,H,p,F,E,y,q,d,l,e,R,I,w4,t,$M,fz,U1,ZU,M_,Tp,kM,w3,sE,Vt,v5,OE;
return g.n(function(pC){switch(pC.L){case 1:return U=g.rt(w,"mainVideoEntity"),f=g.rt(w,"ytMainChannelEntity"),h=g.rt(w,"transfer"),c=g.rt(w,"videoDownloadContextEntity"),g.B(pC,Ci(M,{mode:"readonly",UF:!0},function(g3){return g.NZ.all([bI(g3,U,"mainVideoEntity"),bI(g3,f,"ytMainChannelEntity"),bI(g3,h,"transfer"),bI(g3,c,"videoDownloadContextEntity"),I2(g3,"ytMainChannelEntity"),I2(g3,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:Z=pC.B;S=g.G(Z);H=S.next().value;p=S.next().value;F=S.next().value;E=S.next().value;y=S.next().value;q=S.next().value;d=H;l=p;e=F;R=E;I=y;w4=q;if(!d&&!l){pC.M0(3);break}t=d?Et(d.thumbnail):[];if(!l){$M=[];pC.M0(4);break}return g.B(pC,fih(l,I),5);case 5:$M=pC.B;case 4:return fz=$M,g.B(pC,oq(t.concat(fz)),3);case 3:U1=[];ZU=g.rt(w,"downloadStatusEntity");M_=g.G(w4);for(Tp=M_.next();!Tp.done;Tp=M_.next())kM=Tp.value,w3=g.Jt(kM.key).entityId,sE=Vu(kM),Vt=g.Jt(sE.action.entityKey).entityId,w3!==
w&&Vt!==w||pv(P,kM.actionProto)||U1.push(kM.key);return g.B(pC,Ci(M,{mode:"readwrite",UF:!0},function(g3){var MK=U1.map(function(T){return Jq(g3,T)});
MK.push(Jq(g3,U,{HO:!0}));MK.push(Jq(g3,ZU,{HO:!0}));return g.NZ.all(MK)}),7);
case 7:OE=(v5=R)==null?void 0:v5.offlineModeType,X&&(fv(X),X.offlineModeType&&(OE=X.offlineModeType)),Fe(e,OE),$Z(u,{entityKey:U,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.yx(pC)}})},cCU=function(w,M,P,u){var X,U,f,h,c,Z,S,H,p,F,E,y,q,d,l,e,R,I,w4,t,$M,fz,U1,ZU,M_,Tp,kM,w3,sE,Vt,v5,OE,pC,g3,MK,T,nE,ep,P5,d3,D,i2,J5,fQ,KC,g4,O1,aK,vT,Y;
return g.n(function(m){switch(m.L){case 1:return X=g.rt(w,"mainPlaylistEntity"),U=g.rt(w,"ytMainChannelEntity"),g.B(m,Ci(M,{mode:"readonly",UF:!0},function(z){return g.NZ.all([bI(z,X,"mainPlaylistEntity"),bI(z,U,"ytMainChannelEntity"),I2(z,"mainPlaylistEntity"),I2(z,"mainDownloadsListEntity"),I2(z,"ytMainChannelEntity"),I2(z,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:f=m.B;h=g.G(f);c=h.next().value;Z=h.next().value;S=h.next().value;H=h.next().value;p=h.next().value;F=h.next().value;E=c;y=Z;q=S;d=H;l=p;e=F;if(!E&&!y){m.M0(3);break}R=E?Wv3(E):[];if(!y){I=[];m.M0(4);break}return g.B(m,fih(y,l),5);case 5:I=m.B;case 4:return w4=I,g.B(m,oq(R.concat(w4)),3);case 3:t=[];$M=new Map;if(!E){m.M0(7);break}return g.B(m,h9V(E,q,d),8);case 8:t=m.B;fz=g.G(t);for(U1=fz.next();!U1.done;U1=fz.next())ZU=U1.value,$M.set(ZU,{videoId:ZU,playlistId:w,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.B(m,Ci(M,{mode:"readonly",UF:!0},function(z){return g.NZ.all([I2(z,"transfer"),I2(z,"videoDownloadContextEntity")])}),9);
case 9:M_=m.B;Tp=g.G(M_);kM=Tp.next().value;w3=Tp.next().value;sE=kM;Vt=w3;v5=g.G(sE);for(OE=v5.next();!OE.done;OE=v5.next())pC=OE.value,g3=g.Jt(pC.key).entityId,(MK=$M.get(g3))&&pC&&(MK.cotn=pC.cotn);T=g.G(Vt);for(nE=T.next();!nE.done;nE=T.next())ep=nE.value,P5=g.Jt(ep.key).entityId,(d3=$M.get(P5))&&ep&&(d3.offlineModeType=ep.offlineModeType);case 7:D=[];i2=g.G(e);for(J5=i2.next();!J5.done;J5=i2.next())fQ=J5.value,KC=g.Jt(fQ.key).entityId,g4=Vu(fQ),KC!==w&&g4.rootActionId!==w||pv(P,fQ.actionProto)||
D.push(fQ.key);O1=g.rt(w,"mainPlaylistEntity");return g.B(m,Ci(M,{mode:"readwrite",UF:!0},function(z){var Q=D.map(function(K){return Jq(z,K)});
Q.push(Jq(z,O1,{HO:!0}));return g.NZ.all(Q)}),10);
case 10:if(!E){m.M0(0);break}t.reverse();if(!t){m.M0(0);break}aK=g.G(t);vT=aK.next();case 13:if(vT.done){m.M0(0);break}Y=vT.value;return g.B(m,yu(Y,M,P,u,$M.get(Y)),14);case 14:vT=aK.next(),m.M0(13)}})},SoU=function(w,M,P,u){var X,U,f,h,c,Z,S,H,p;
return g.n(function(F){if(F.L==1)return X=g.rt("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),U=new Map,g.B(F,Ci(w,{mode:"readwrite",UF:!0},function(E){var y=I2(E,"transfer"),q=I2(E,"offlineOrchestrationActionWrapperEntity"),d=I2(E,"videoDownloadContextEntity"),l=bI(E,X,"mainDownloadsListEntity");return g.NZ.all([y,q,d,l]).then(function(e){e=g.G(e);var R=e.next().value;var I=e.next().value;var w4=e.next().value;var t=e.next().value;e=ZZ3.map(function(fz){return UaE(E,fz)});
I=g.G(I);for(var $M=I.next();!$M.done;$M=I.next())$M=$M.value,pv(M,$M.actionProto)||e.push(Jq(E,$M.key,{HO:!0}));t&&(t.downloads=[],e.push(gP(E,t,"mainDownloadsListEntity")));if(w4)for(w4=g.G(w4),t=w4.next();!t.done;t=w4.next())t=t.value,I=g.Jt(t.key).entityId,I=g.rt(I,"transfer"),U.set(I,t.offlineModeType);return g.NZ.all(e).then(function(){return R})})}),2);
f=F.B;h=g.G(f);for(c=h.next();!c.done;c=h.next())Z=c.value,Fe(Z,U.get(Z.key)),S=g.Jt(Z.key).entityId,H={videoId:S,offlineDeleteReason:u,cotn:Z.cotn,offlineModeType:U.get(Z.key)},fv(H),p=g.rt(S,"mainVideoEntity"),$Z(P,{entityKey:p,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.B(F,UME(),0)})},Wv3=function(w,M){var P=[];
if(w.thumbnailStyleData){w=g.G(w.thumbnailStyleData);for(var u=w.next();!u.done;u=w.next()){var X=void 0,U=void 0,f=void 0;P=P.concat(Et((X=u.value)==null?void 0:(U=X.value)==null?void 0:(f=U.collageThumbnail)==null?void 0:f.coverThumbnail))}}M=Et(M);return P.concat(M)},h9V=function(w,M,P){var u,X,U,f,h,c,Z,S,H,p,F,E,y,q,d,l,e,R,I,w4,t,$M,fz;
return g.n(function(U1){u=[];X=new Set;if(P.length)for(U=g.G(P),f=U.next();!f.done;f=U.next())if(h=f.value,c=void 0,(c=h.downloads)==null?0:c.length)for(Z=g.G(h.downloads),S=Z.next();!S.done;S=Z.next())H=S.value,H.videoItem&&(p=g.Jt(H.videoItem).entityId,X.add(p));if(w.videos){F=g.G(w.videos);for(E=F.next();!E.done;E=F.next())y=E.value,q=JSON.parse(g.Jt(y).entityId),q.videoId&&!X.has(q.videoId)&&u.push(q.videoId);d=g.G(M);for(l=d.next();!l.done;l=d.next())if(e=l.value,e.key!==w.key&&(R=e.videos))for(I=
g.G(R),w4=I.next();!w4.done;w4=I.next())t=w4.value,$M=JSON.parse(g.Jt(t).entityId),$M.videoId&&(fz=u.indexOf($M.videoId),fz!==-1&&u.splice(fz,1))}return U1.return(u)})},fih=function(w,M){var P,u,X,U,f,h,c,Z;
return g.n(function(S){P=Et(w.avatar);u=g.G(M);for(X=u.next();!X.done;X=u.next())if(U=X.value,U.id!==w.id)for(f=g.G(Et(U.avatar)),h=f.next();!h.done;h=f.next())c=h.value,Z=P.indexOf(c),Z!==-1&&P.splice(Z,1);return S.return(P)})},HZE=function(w){var M;
return g.n(function(P){M=g.A(w.frameworkUpdates,DF);return w.frameworkUpdates&&M?g.B(P,map(M),0):P.return()})},Fvh=function(w){var M;
if((M=w.onResponseReceivedActions)!=null&&M.length){var P;w=(P=g.A(g.A(w.onResponseReceivedActions[0],p_3),g.yTV))==null?void 0:P.actions;if(w!=null&&w.length)return w}},Eja=function(w){var M,P,u;
return g.n(function(X){if(X.L==1)return w?g.B(X,xU(w,g.KT,"mainDownloadsListEntity"),2):X.return([]);M=X.B;return((P=M)==null?0:(u=P.downloads)==null?0:u.length)?X.return(M.downloads.map(function(U){var f;return(f=U.videoItem)!=null?f:""})):X.return([])})},V63=function(w,M){var P;
return g.n(function(u){return u.L==1?g.B(u,Nsc(w,M),2):(P=u.B)?g.B(u,Ci(w,{mode:"readwrite",UF:!0},function(X){var U=[gP(X,P.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];P.mainDownloadsListEntity&&U.push(gP(X,P.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.NZ.all(U)}),0):u.M0(0)})},Nsc=function(w,M){var P,u,X,U,f,h,c,Z,S,H,p,F,E,y,q,d,l,e;
return g.n(function(R){if(R.L==1)return P=g.rt("main_downloads_library_id","mainDownloadsLibraryEntity"),u=g.rt("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.B(R,Ci(w,{mode:"readonly",UF:!0},function(I){return g.NZ.all([bI(I,P,"mainDownloadsLibraryEntity"),bI(I,u,"mainDownloadsListEntity")])}),2);
X=R.B;U=g.G(X);f=U.next().value;h=U.next().value;c=f;Z=h;c||(c={id:P});S=g.G(M);for(H=S.next();!H.done;H=S.next())if(p=H.value,p===g.KT){if(c.smartDownloadsList)return R.return();c.smartDownloadsList=p}else if(F=g.Jt(p).entityType,E={},F==="mainPlaylistEntity"?E.playlistItem=p:F==="mainVideoEntity"&&(E.videoItem=p),!g.SF(E)){y=void 0;if((y=Z)==null?0:y.downloads){q=!1;d=g.G(Z.downloads);for(l=d.next();!l.done;l=d.next())if(e=l.value,e.playlistItem===p||e.videoItem===p){q=!0;break}q||Z.downloads.push(E)}else Z=
{id:u,downloads:[E]};c.downloadsList=u}return R.return({mainDownloadsLibraryEntity:c,mainDownloadsListEntity:Z})})},mMx=function(w,M){var P,u,X,U,f,h,c,Z,S,H,p,F,E,y,q;
return g.n(function(d){if(d.L==1)return P=g.rt("main_downloads_library_id","mainDownloadsLibraryEntity"),u=g.rt("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.B(d,Ci(w,{mode:"readonly",UF:!0},function(l){return g.NZ.all([bI(l,P,"mainDownloadsLibraryEntity"),bI(l,u,"mainDownloadsListEntity"),bI(l,g.KT,"mainDownloadsListEntity")])}),2);
X=d.B;U=g.G(X);f=U.next().value;h=U.next().value;c=U.next().value;Z=f;S=h;H=c;if(!Z)return d.M0(0);if(M===g.KT&&((p=H)==null?0:p.downloads))H.downloads=[];else if((F=S)==null?0:F.downloads)for(E=g.Jt(M).entityType,y=0;y<S.downloads.length;y++)if(q=S.downloads[y],E==="mainVideoEntity"&&q.videoItem===M){S.downloads.splice(y,1);break}else if(E==="mainPlaylistEntity"&&q.playlistItem===M){S.downloads.splice(y,1);break}return g.B(d,Ci(w,{mode:"readwrite",UF:!0},function(l){var e=[gP(l,Z,"mainDownloadsLibraryEntity")];
S&&e.push(gP(l,S,"mainDownloadsListEntity"));H&&e.push(gP(l,H,"mainDownloadsListEntity"));return g.NZ.all(e)}),0)})},qz=function(w,M){var P,u,X,U,f,h,c,Z,S,H,p;
return g.n(function(F){if(F.L==1)return P=g.rt(M,"transfer"),u=g.rt(M,"videoDownloadContextEntity"),g.B(F,Ci(w,{mode:"readonly",UF:!0},function(E){return g.NZ.all([bI(E,P,"transfer"),bI(E,u,"videoDownloadContextEntity")])}),2);
X=F.B;U=g.G(X);f=U.next().value;h=U.next().value;c=f;Z=h;p={videoId:M,cotn:(S=c)==null?void 0:S.cotn,offlineModeType:(H=Z)==null?void 0:H.offlineModeType};return F.return(p)})},YZ=function(w,M,P,u,X){var U,f,h,c,Z,S,H,p,F,E,y,q,d,l,e,R,I,w4,t,$M;
return g.n(function(fz){switch(fz.L){case 1:return U=g.rt(w,"musicTrack"),f=g.rt(w,"transfer"),g.B(fz,Ci(M,{mode:"readonly",UF:!0},function(U1){return g.NZ.all([bI(U1,U,"musicTrack"),bI(U1,f,"transfer"),I2(U1,"musicTrack"),I2(U1,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:h=fz.B;c=g.G(h);Z=c.next().value;S=c.next().value;H=c.next().value;p=c.next().value;F=Z;E=S;y=H;q=p;if(!F){fz.M0(3);break}return g.B(fz,ojE(F,y),4);case 4:return d=fz.B,g.B(fz,oq(d),3);case 3:l=[];e=g.G(q);for(R=e.next();!R.done;R=e.next())I=R.value,w4=g.Jt(I.key).entityId,t=Vu(I),$M=g.Jt(t.action.entityKey).entityId,w4!==w&&$M!==w||pv(P,I.actionProto)||l.push(I.key);return g.B(fz,Ci(M,{mode:"readwrite",UF:!0},function(U1){var ZU=l.map(function(M_){return Jq(U1,M_)});
ZU.push(Jq(U1,U,{HO:!0}));return g.NZ.all(ZU)}),6);
case 6:Fe(E),X&&fv(X),$Z(u,{entityKey:U,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.yx(fz)}})},zh=function(w,M,P,u,X){var U,f,h,c,Z,S,H,p,F,E,y,q,d,l,e,R,I,w4,t,$M,fz,U1,ZU,M_,Tp,kM,w3,sE,Vt,v5,OE,pC,g3,MK,T,nE;
return g.n(function(ep){switch(ep.L){case 1:return U=g.rt(w,M),f=g.rt("music_downloads_library_id","musicDownloadsLibraryEntity"),g.B(ep,Ci(P,{mode:"readonly",UF:!0},function(P5){return g.NZ.all([bI(P5,U,M),bI(P5,f,"musicDownloadsLibraryEntity"),I2(P5,M),I2(P5,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:h=ep.B;c=g.G(h);Z=c.next().value;S=c.next().value;H=c.next().value;p=c.next().value;F=Z;E=S;y=H;q=p;if(!F){ep.M0(3);break}return g.B(ep,ojE(F,y),4);case 4:return d=ep.B,g.B(ep,oq(d),3);case 3:l=[];e=new Map;if(!F){ep.M0(6);break}return g.B(ep,GNE(F,y,E),7);case 7:l=ep.B;R=g.G(l);for(I=R.next();!I.done;I=R.next())w4=I.value,t=g.Jt(w4).entityId,e.set(t,{videoId:t,playlistId:w,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.B(ep,Oi(P,"transfer"),8);case 8:for($M=ep.B,
fz=g.G($M),U1=fz.next();!U1.done;U1=fz.next())ZU=U1.value,M_=g.Jt(ZU.key).entityId,(Tp=e.get(M_))&&ZU&&(Tp.cotn=ZU.cotn);case 6:kM=[];w3=g.G(q);for(sE=w3.next();!sE.done;sE=w3.next())Vt=sE.value,v5=g.Jt(Vt.key).entityId,OE=Vu(Vt),v5!==w&&OE.rootActionId!==w||pv(u,Vt.actionProto)||kM.push(Vt.key);pC=g.rt(w,M);return g.B(ep,Ci(P,{mode:"readwrite",UF:!0},function(P5){var d3=kM.map(function(D){return Jq(P5,D)});
d3.push(Jq(P5,pC,{HO:!0}));return g.NZ.all(d3)}),9);
case 9:if(!F){ep.M0(0);break}l.reverse();if(!l.length){ep.M0(0);break}g3=g.G(l);MK=g3.next();case 12:if(MK.done){ep.M0(0);break}T=MK.value;nE=g.Jt(T).entityId;if(!nE){ep.M0(13);break}return g.B(ep,YZ(nE,P,u,X,e.get(nE)),13);case 13:MK=g3.next(),ep.M0(12)}})},Th=function(w,M,P){var u,X,U,f,h,c,Z;
return g.n(function(S){if(S.L==1)return g.B(S,Ci(w,{mode:"readwrite",UF:!0},function(H){var p=I2(H,"transfer"),F=I2(H,"offlineOrchestrationActionWrapperEntity");return g.NZ.all([p,F]).then(function(E){E=g.G(E);var y=E.next().value;var q=E.next().value;E=yCE.map(function(R){return UaE(H,R)});
q=g.G(q);for(var d=q.next();!d.done;d=q.next()){d=d.value;var l=g.Jt(d.actionProto.entityKey).entityType==="musicTrack",e=d.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";pv(M,d.actionProto)||l&&(!l||e)||E.push(Jq(H,d.key,{HO:!0}))}return g.NZ.all(E).then(function(){return y})})}),2);
u=S.B;X=g.G(u);for(U=X.next();!U.done;U=X.next())f=U.value,Fe(f),h=g.Jt(f.key).entityId,c={videoId:h,offlineDeleteReason:void 0,cotn:f.cotn},fv(c),Z=g.rt(h,"musicTrack"),$Z(P,{entityKey:Z,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.B(S,UME(),0)})},DM3=function(w){for(var M,P=g.G(w.additionalMetadatas),u=P.next();!u.done;u=P.next())u=u.value,u.offlineMusicVideoData&&(M=u.offlineMusicVideoData);
var X,U,f,h,c;return{id:g.rt(w.videoId,"musicTrack"),videoId:w.videoId,title:w.title,thumbnailDetails:w.thumbnail,lengthMs:String(Number(w.lengthSeconds)*1E3),albumTitle:(X=M)==null?void 0:X.releaseTitle,musicVideoType:(U=M)==null?void 0:U.musicVideoType,contentRating:{explicitType:(f=M)==null?void 0:f.explicitType},artistNames:((h=M)==null?void 0:h.byline)||((c=M)==null?void 0:c.channelName),downloadMetadata:g.rt(w.videoId,"musicTrackDownloadMetadataEntity")}},GNE=function(w,M,P){var u,X,U,f,h,c,
Z,S,H,p,F,E,y,q,d,l,e,R;
return g.n(function(I){u=[];X=new Set;if((U=P)==null?0:(f=U.downloadedTracks)==null?0:f.length)for(h=g.G(P.downloadedTracks),c=h.next();!c.done;c=h.next())Z=c.value,X.add(Z);if(w.tracks){S=g.G(w.tracks);for(H=S.next();!H.done;H=S.next())p=H.value,X.has(p)||u.push(p);F=g.G(M);for(E=F.next();!E.done;E=F.next())if(y=E.value,y.id!==w.id&&(q=y.tracks))for(d=g.G(q),l=d.next();!l.done;l=d.next())e=l.value,R=u.indexOf(e),R!==-1&&u.splice(R,1)}return I.return(u)})},ojE=function(w,M){var P,u,X,U,f,h,c,Z;
return g.n(function(S){P=Et(w.thumbnailDetails);u=g.G(M);for(X=u.next();!X.done;X=u.next())if(U=X.value,U.id!==w.id)for(f=g.G(Et(U.thumbnailDetails)),h=f.next();!h.done;h=f.next())c=h.value,Z=P.indexOf(c),Z!==-1&&P.splice(Z,1);return S.return(P)})},qoV=function(w,M){var P,u,X,U,f,h,c,Z,S;
return g.n(function(H){if(H.L==1)return P=g.rt("music_downloads_library_id","musicDownloadsLibraryEntity"),g.B(H,xU(w,P,"musicDownloadsLibraryEntity"),2);(u=H.B)||(u={id:P});X=g.Jt(M).entityType;X==="musicTrack"?(U=u.downloadedTracks)!=null&&U.includes(M)||(u.downloadedTracks=((f=u.downloadedTracks)!=null?f:[]).concat(M)):X==="musicPlaylist"?(h=u.downloadedPlaylists)!=null&&h.includes(M)||(u.downloadedPlaylists=((c=u.downloadedPlaylists)!=null?c:[]).concat(M)):X!=="musicAlbumRelease"||(Z=u.downloadedAlbumReleases)!=
null&&Z.includes(M)||(u.downloadedAlbumReleases=((S=u.downloadedAlbumReleases)!=null?S:[]).concat(M));return g.B(H,tq(w,u,"musicDownloadsLibraryEntity"),0)})},Yo$=function(w,M){var P,u,X,U,f,h,c;
return g.n(function(Z){if(Z.L==1)return P=g.rt("music_downloads_library_id","musicDownloadsLibraryEntity"),g.B(Z,xU(w,P,"musicDownloadsLibraryEntity"),2);u=Z.B;if(!u)return Z.M0(0);X=g.Jt(M).entityType;X==="musicTrack"?U=u.downloadedTracks:X==="musicPlaylist"&&(U=u.downloadedPlaylists);if((f=U)==null?0:f.length)for(h=0;h<U.length;h++)if(c=U[h],c===M){U.splice(h,1);break}return g.B(Z,tq(w,u,"musicDownloadsLibraryEntity"),0)})},z9E=function(w){var M=w.videos;
w=[];var P=[];if(M){M=g.G(M);for(var u=M.next();!u.done;u=M.next()){var X=u.value.offlineVideoData.videoId;u=g.rt(X,"musicTrack");X=g.rt(X,"musicTrackDownloadMetadataEntity");w.push(u);P.push(X)}}return{q9:w,bl:P}},dl=function(w,M,P){M={track:DM3(M)};
P&&(M.playlistId=P);if(w=g.A(w.actionMetadata,TsC))M.maximumDownloadQuality=w.maximumDownloadQuality;return{musicTrackEntityActionMetadata:M}},lia=function(w){var M,P,u,X,U,f,h,c;
return g.n(function(Z){switch(Z.L){case 1:return M=g.IY(),P=Tbj(w),u=g.CW(dMC),g.DU(Z,2),U={w8:!0},g.B(Z,g.LU(M,P,u,void 0,U),4);case 4:X=Z.B;g.zp(Z,3);break;case 2:f=g.d4(Z);if(f instanceof g.s7)throw h="GetOffline network manager error: "+f.message,uf(h,f),Error(h);uf("GetOffline fetch request error",f);throw Error("GetOffline fetch request error");case 3:c=lf(X);if(!X)throw uf("Network request failed"),Error("Network request failed");if(c!==void 0)Lv(c);else if(!X.videos||!X.videos.length)throw uf("No data"),
Error("No data");return Z.return(X.videos.map(function(S){return S.offlineVideoData}))}})},LvA=function(w){var M,P,u,X,U,f,h,c;
return g.n(function(Z){switch(Z.L){case 1:return M=g.IY(),P=daC(w),u=g.CW(dMC),g.DU(Z,2),U={w8:!0},g.B(Z,g.LU(M,P,u,void 0,U),4);case 4:X=Z.B;g.zp(Z,3);break;case 2:f=g.d4(Z);if(f instanceof g.s7)throw h="GetOffline network manager error for playlist: "+f.message,uf(h,f),Error(h);uf("GetOffline fetch request error for playlist",f);throw Error("GetOffline fetch request error for playlist");case 3:c=lf(X);if(!X)throw uf("Network request failed for playlist"),Error("Network request failed for playlist");
if(c!==void 0)Lv(c,"playlist");else if(!X.playlists||!X.playlists.length)throw uf("No data for playlist"),Error("No data for playlist");return Z.return(X.playlists.map(function(S){return S.offlinePlaylistData}))}})},BsC=function(w,M,P,u){var X,U,f,h,c,Z,S,H,p,F,E,y,q,d,l,e,R,I,w4,t,$M,fz,U1,ZU,M_,Tp,kM,w3,sE,Vt;
return g.n(function(v5){switch(v5.L){case 1:return g.B(v5,a2(),2);case 2:X=v5.B;if(!X)return v5.return([]);U=[];if((f=u)==null?0:f.length){U=u;v5.M0(3);break}return g.B(v5,Oi(X,"mainPlaylistEntity"),4);case 4:U=v5.B;case 3:if(!U.length)return v5.return([]);h=[];c=Date.now()/1E3;Z=g.G(U);S=Z.next();case 5:if(S.done)return h.length?g.B(v5,e9C(h),10):v5.return([]);H=S.value;if(!H.downloadState){p=void 0;v5.M0(8);break}return g.B(v5,xU(X,H.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:p=
v5.B;case 8:F=p;E=void 0;q=(y=(E=H)==null?void 0:E.entityMetadata)&&y.nextAutoRefreshIntervalSeconds?Number(y.nextAutoRefreshIntervalSeconds):NaN;d=Number.isNaN(q)?w:q;e=l=void 0;R=((l=F)==null?0:l.lastSyncedTimestampMillis)?Number((e=F)==null?void 0:e.lastSyncedTimestampMillis)/1E3:0;w4=I=void 0;t=((I=F)==null?0:I.addedTimestampMillis)?Number((w4=F)==null?void 0:w4.addedTimestampMillis)/1E3:0;if(P||!y||R+d<=c){$M=[];fz=void 0;if((fz=H.videos)==null?0:fz.length)for(U1=g.G(H.videos),ZU=U1.next();!ZU.done;ZU=
U1.next())M_=ZU.value,Tp=JSON.parse(g.Jt(M_).entityId),Tp.videoId&&$M.push(Tp.videoId);kM="0";y&&(w3=void 0,kM=String(Number((w3=y.offlineLastModifiedTimestampSeconds)!=null?w3:0).toFixed()));sE={playlistId:H.playlistId,videoIds:$M,offlineLastModifiedTimestamp:kM,autoSync:M,offlineDateAddedTimestamp:String(t.toFixed())};h.push(sE)}S=Z.next();v5.M0(5);break;case 10:return Vt=v5.B,v5.return(Vt)}})},QoA=function(){var w,M,P,u,X;
return g.n(function(U){if(U.L==1)return g.B(U,a2(),2);if(U.L!=3)return(w=U.B)?g.B(U,Oi(w,"refresh"),3):U.return(!1);M=U.B;if((P=M[0])==null||!P.refreshTime)return U.return(!1);u=Number(M[0].refreshTime);X=Date.now()/1E3;return U.return(isFinite(u)&&X>=u)})},R9C=function(w,M){var P,u,X;
return g.n(function(U){switch(U.L){case 1:return g.DU(U,2),g.B(U,kNt(w,M),4);case 4:return u=U.B,g.B(U,HZE(u),5);case 5:P=Fvh(u);g.zp(U,3);break;case 2:X=g.d4(U),uf("getAndProcessSmartDownloadsResponse request or processing error",X);case 3:return U.return(P)}})},nj4=function(w,M,P,u){var X,U,f,h,c,Z,S,H,p,F,E,y,q,d,l,e,R,I,w4,t,$M,fz,U1,ZU,M_,Tp,kM,w3,sE,Vt;
return g.n(function(v5){switch(v5.L){case 1:return g.B(v5,a2(),2);case 2:X=v5.B;if(!X)return v5.return([]);U=[];if((f=u)==null?0:f.length){U=u;v5.M0(3);break}return g.B(v5,Oi(X,"musicPlaylist"),4);case 4:U=v5.B;case 3:if(!U.length)return v5.return([]);h=[];c=Date.now()/1E3;Z=g.G(U);S=Z.next();case 5:if(S.done)return h.length?g.B(v5,e9C(h),10):v5.return([]);H=S.value;p=void 0;E=(F=(p=H)==null?void 0:p.entityMetadata)&&F.nextAutoRefreshIntervalSeconds?Number(F.nextAutoRefreshIntervalSeconds):NaN;y=
Number.isNaN(E)?w:E;d=q=0;l="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!H.downloadMetadata){v5.M0(8);break}return g.B(v5,xU(X,H.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:e=v5.B,I=R=void 0,q=Number((I=(R=e)==null?void 0:R.addedTimestampMillis)!=null?I:"0")/1E3,t=w4=void 0,d=Number((t=(w4=e)==null?void 0:w4.lastModifiedTimestampMillis)!=null?t:"0")/1E3,fz=$M=void 0,l=(fz=($M=e)==null?void 0:$M.syncState)!=null?fz:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:U1=void 0;if(P||l!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!F||Number((U1=F.lastSyncedTimestampSeconds)!=null?U1:0)+y<=c){ZU=[];M_=void 0;if((M_=H.tracks)==null?0:M_.length)for(Tp=g.G(H.tracks),kM=Tp.next();!kM.done;kM=Tp.next())w3=kM.value,ZU.push(g.Jt(w3).entityId);sE={playlistId:H.playlistId,videoIds:ZU,offlineLastModifiedTimestamp:String(d.toFixed()),autoSync:M,offlineDateAddedTimestamp:String(q.toFixed())};h.push(sE)}S=Z.next();v5.M0(5);break;case 10:return Vt=v5.B,v5.return(Vt)}})},kNt=function(w,M){var P,u,X,U,f,h,c,Z,S,H;
return g.n(function(p){switch(p.L){case 1:return P=g.IY(),g.B(p,a2(),2);case 2:u=p.B;if(!u){p.M0(3);break}return g.B(p,RBc(u),4);case 4:X=p.B;case 3:var F=X;U={context:g.Jb(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:w},offlineClientState:F,clientStateRequestData:{preferredFormatType:M}}}};f=g.CW(vjE);g.DU(p,5);c={w8:!0};return g.B(p,g.LU(P,U,f,void 0,c),7);case 7:h=p.B;g.zp(p,6);break;case 5:Z=g.d4(p);if(Z instanceof g.s7)throw S=
"DPS network manager error for smart downloads: "+Z.message,uf(S,Z),Error(S);uf("DPS fetch request error for smart downloads",Z);throw Error("DPS fetch request error for smart downloads");case 6:H=lf(h);if(h)H!==void 0&&Lv(H,"smart downloads");else throw uf("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return p.return(h)}})},Kvh=function(w,M){var P,u,X,U,f,h,c,Z;
return g.n(function(S){switch(S.L){case 1:return P=g.IY(),u={context:g.Jb(),videoPlaybackPositionEntities:w,lastSyncTimestampUsec:M},X=g.CW(soc),g.DU(S,2),f={w8:!0},g.B(S,g.LU(P,u,X,void 0,f),4);case 4:U=S.B;g.zp(S,3);break;case 2:h=g.d4(S);if(h instanceof g.s7)throw c="VPPS network manager error: "+h.message,uf(c,h),Error(c);uf("VPPS fetch request error",h);throw Error("VPPS fetch request error");case 3:Z=lf(U);if(U)Z!==void 0&&Lv(Z,"position sync");else throw uf("Network request failed for position sync"),
Error("Network request failed for position sync");return S.return(U)}})},Iic=function(w,M,P){var u,X,U,f,h,c,Z,S;
return g.n(function(H){switch(H.L){case 1:u=g.IY();var p=P.refreshData,F=P.isEnqueuedForExpiredStreamUrlRefetch,E=P.TU,y=P.offlineSourceData,q=P.mediaCapabilities,d={entityKey:w};p&&(d.refreshData=p);F&&(d.isExpiredStreamUrlRefetch=F);E&&(d.downloadParameters=E);y&&(d.offlineSourceData=y);p={context:g.Z5(M),signatureTimestamp:20269,videos:[d]};q&&(p.mediaCapabilities=q);X=p;U=g.CW(bZE);g.DU(H,2);h={w8:!0};return g.B(H,g.LU(u,X,U,void 0,h),4);case 4:f=H.B;g.zp(H,3);break;case 2:c=g.d4(H);if(c instanceof
g.s7)throw Z="GetPDE network manager error: "+c.message,uf(Z,c),Error(Z);uf("GetPDE fetch request error",c);throw Error("GetPDE fetch request error");case 3:S=lf(f);if(f)S!==void 0&&Lv(S,"PDE");else throw uf("Network request failed for PDE"),Error("Network request failed for PDE");return H.return(f)}})},lf=function(w){var M;
return(M=w.errorMetadata)==null?void 0:M.status},Lv=function(w,M){M=M?" for "+M:"";
if(w===0)throw w="Empty response body"+M,uf(w),Error(w);w="Response with error"+M;uf(w);throw Error(w);},e9C=function(w){var M,P,u,X,U,f,h,c;
return g.n(function(Z){switch(Z.L){case 1:return M=g.IY(),P=lGE(w),u=g.CW(ACp),g.DU(Z,2),U={w8:!0},g.B(Z,g.LU(M,P,u,void 0,U),4);case 4:X=Z.B;g.zp(Z,3);break;case 2:f=g.d4(Z);if(f instanceof g.s7)throw h="offlinePlaylistSyncCheck network manager error: "+f.message,uf(h,f),Error(h);uf("offlinePlaylistSyncCheck fetch request error",f);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:c=lf(X);if(!X)throw uf("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(c!==void 0)Lv(c,"playlist sync");else if(!X.offlinePlaylistSyncCheckDatas||!X.offlinePlaylistSyncCheckDatas.length)throw uf("No data for playlist sync"),Error("No data for playlist sync");return Z.return(X.offlinePlaylistSyncCheckDatas.map(function(S){return S.offlinePlaylistSyncCheckData}))}})},eE=function(w){this.B=w},gj4=function(w,M){var P,u,X,U,f,h;
return g.n(function(c){switch(c.L){case 1:P=new Map,u=g.G(M),X=u.next();case 2:if(X.done){c.M0(4);break}U=X.value;f=P;h=f.set;return g.B(c,w.L(U),5);case 5:h.call(f,U,c.B);X=u.next();c.M0(2);break;case 4:return c.return(P)}})},BK=function(w,M,P,u,X,U){M=g.rt(M,P);
u=Object.assign({},U,{priority:u,retryScheduleIntervalsInSeconds:X});return{actionType:w,entityKey:M,actionMetadata:u}},Qu=function(w,M,P,u,X,U){this.status=w;
this.B=M;this.X=P;this.L=u;this.C=X;this.downloadState=U},JCE=function(w,M,P){this.B=w;
this.P3=M;this.C=P},Cza=function(w,M){var P,u,X,U,f,h,c,Z,S;
return g.n(function(H){switch(H.L){case 1:return P=M.entityKey,X=(u=g.A(M.actionMetadata,kZ))==null?void 0:u.isEnqueuedForExpiredStreamUrlRefetch,g.DU(H,2),U=void 0,g.B(H,rCU(w,M),4);case 4:U=H.B;g.DU(H,5);var p=(p=g.A(M.actionMetadata,kZ))?{maximumDownloadQuality:p.maximumDownloadQuality}:void 0;return g.B(H,Iic(P,w.P3,{isEnqueuedForExpiredStreamUrlRefetch:X,TU:p,offlineSourceData:U}),7);case 7:f=H.B;g.zp(H,6,2);break;case 5:return g.d4(H,2),h=hG(M)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",uf("PDE handleAdd error"),H.return(Rq(M,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",h,"DOWNLOAD_STATE_FAILED"));case 6:return g.B(H,jox(w,f,M),8);case 8:return H.return(Rq(M,!0,f.orchestrationActions));case 2:return c=g.d4(H),Z="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",S="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",c instanceof g.cN&&c.type==="QUOTA_EXCEEDED"&&(Z="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
S="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),uf("PDE handleAdd error"),H.return(Rq(M,!1,void 0,Z,S,"DOWNLOAD_STATE_FAILED"))}})},OZt=function(w,M){var P,u,X,U,f,h,c,Z,S,H,p,F,E,y,q,d,l,e,R,I,w4,t,$M,fz;
return g.n(function(U1){switch(U1.L){case 1:return P=M.entityKey,u=g.Jt(P).entityId,g.B(U1,Ci(w.B,{mode:"readonly",UF:!0},function(ZU){var M_=bI(ZU,P,"playbackData"),Tp=bI(ZU,g.rt(u,"offlineVideoPolicy"),"offlineVideoPolicy");ZU=bI(ZU,g.rt(u,"transfer"),"transfer");return g.NZ.all([M_,Tp,ZU])}),2);
case 2:X=U1.B;U=g.G(X);f=U.next().value;h=U.next().value;c=U.next().value;Z=f;S=h;H=c;if(!Z||!S)return U1.return(Rq(M,!0));p=[];y=((E=Z)==null?0:E.playerResponseJson)?JSON.parse(Z.playerResponseJson):null;if(!(H&&y&&w.P3.D("html5_refresh_deprecated_downloads"))){U1.M0(3);break}F=t6$(w,y,H);return g.B(U1,xMp(w,H),4);case 4:p=U1.B;case 3:q={lastPlayerResponseTimestampSeconds:Z.playerResponseTimestamp,offlineToken:S.offlineToken,formatIds:p};d={};if((l=H)==null?0:l.maximumDownloadQuality)d.maximumDownloadQuality=
H.maximumDownloadQuality;g.DU(U1,5);e=void 0;return g.B(U1,rCU(w,M),7);case 7:return e=U1.B,g.DU(U1,8),g.B(U1,Iic(P,w.P3,{refreshData:q,TU:d,offlineSourceData:e,mediaCapabilities:F}),10);case 10:R=U1.B;g.zp(U1,9,5);break;case 8:return g.d4(U1,5),I=hG(M)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",uf("PDE handleRefresh error"),U1.return(Rq(M,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",I,
"DOWNLOAD_STATE_FAILED"));case 9:return g.B(U1,jox(w,R,M),11);case 11:return U1.return(Rq(M,!0,R.orchestrationActions));case 5:return w4=g.d4(U1),t="PDE handleRefresh error",w4 instanceof Error&&(t="PDE handleRefresh error: "+w4.message),$M="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",fz="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",w4 instanceof g.cN&&w4.type==="QUOTA_EXCEEDED"&&($M="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",fz="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
uf(t),U1.return(Rq(M,!1,void 0,$M,fz,"DOWNLOAD_STATE_FAILED"))}})},rCU=function(w,M){var P,u,X,U;
return g.n(function(f){if(f.L==1)return P=g.Jt(M.entityKey).entityId,u=g.rt(P,"videoDownloadContextEntity"),g.B(f,xU(w.B,u,"videoDownloadContextEntity"),2);X=f.B;return(U=X)!=null&&U.offlineModeType?f.return({offlineModeType:X.offlineModeType}):f.return(void 0)})},jox=function(w,M,P){var u,X,U,f,h;
return g.n(function(c){if(c.L==1){if(!M.frameworkUpdates||!g.A(M.frameworkUpdates,DF))return c.return();if(!(g.A(M.frameworkUpdates,DF).mutations&&g.A(M.frameworkUpdates,DF).mutations.length>0&&g.A(M.frameworkUpdates,DF).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return c.M0(2);u=g.Jt(g.A(M.frameworkUpdates,DF).mutations[0].entityKey).entityId;return g.B(c,qz(w.B,u),3)}if(c.L!=2){X=c.B;U=g.A(P.actionMetadata,kZ);if(h=(f=U)==null?void 0:f.playlistId)X.playlistId=h;X.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.fp(w.P3)?g.B(c,yu(u,w.B,P,w.C,X),2):g.LW(w.P3)?g.B(c,YZ(u,w.B,P,w.C),2):c.M0(2)}return g.B(c,map(g.A(M.frameworkUpdates,DF)),0)})},Rq=function(w,M,P,u,X,U){return new Qu(M?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",hG(w),P,u,X,U)},t6$=function(w,M,P){M=X_U(w.P3,P.cotn,M);
P=g.oI(M);return g.Or2(M,P,w.P3)},xMp=function(w,M){var P,u,X,U,f,h,c,Z,S,H,p;
return g.n(function(F){if(F.L==1)return P=[],g.B(F,Ci(w.B,{mode:"readonly",UF:!0},function(E){var y=[],q=M.offlineVideoStreams;if(q){q=g.G(q);for(var d=q.next();!d.done;d=q.next())y.push(bI(E,d.value,"offlineVideoStreams"))}return g.NZ.all(y)}),2);
if(u=F.B)for(X=g.G(u),U=X.next();!U.done;U=X.next())if(f=U.value,h=void 0,(h=f)==null?0:h.streamsProgress)for(c=f.streamsProgress,Z=0;Z<c.length;Z++)S=c[Z],H=JSON.parse(S.formatStreamBytes),p={itag:H.itag,lmt:H.lastModified,xtags:H.xtags},P.push(p);return F.return(P)})},aiA=function(w,M){this.B=w;
this.P3=M},wG4=function(w,M){var P,u,X,U,f,h,c,Z,S,H,p,F;
return g.n(function(E){switch(E.L){case 1:return P=hG(M),g.B(E,Oi(w.B,"videoPlaybackPositionEntity"),2);case 2:u=E.B;if(u.length===0)return E.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P));g.DU(E,3);return g.B(E,vq.getInstance(),5);case 5:X=E.B;if(!X)throw Error("prefStorage is undefined");return g.B(E,X.get("psi"),6);case 6:return U=E.B,c=(h=(f=U)==null?void 0:f.yg)!=null?h:"0",g.B(E,Kvh(u,c),7);case 7:return Z=E.B,S={isPaused:Z.watchHistoryPaused,yg:Z.syncTimestampUsec},g.B(E,X.set("psi",
S),8);case 8:if(S.isPaused){E.M0(9);break}H=g.A(Z.frameworkUpdates,DF);if(!Z.frameworkUpdates||!H){E.M0(9);break}return g.B(E,map(H),9);case 9:g.zp(E,4);break;case 3:return p=g.d4(E),F="PPE handleRefresh error: "+(p instanceof Error?p.message:"unknown error"),uf(F),E.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",P,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return E.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
P))}})},Mrj=function(w,M){var P,u,X,U,f,h,c,Z;
return g.n(function(S){switch(S.L){case 1:return P=hG(M),u=g.Jt(M.entityKey).entityId,g.DU(S,2),g.B(S,vq.getInstance(),4);case 4:X=S.B;if(!X)throw Error("prefStorage is undefined");return g.B(S,X.get("psi"),5);case 5:U=S.B;f=g.A(M.actionMetadata,ibp);if(((h=U)==null?void 0:h.isPaused)!==!1||(c=f)==null||!c.lastPlaybackPositionSeconds){S.M0(6);break}Z={key:g.rt(u,"videoPlaybackPositionEntity"),videoId:u,lastPlaybackPositionSeconds:f.lastPlaybackPositionSeconds};return g.B(S,tq(w.B,Z,"videoPlaybackPositionEntity"),
6);case 6:g.zp(S,3);break;case 2:return g.d4(S),S.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",P,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return S.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P))}})},Pc3=function(w,M){var P,u,X;
return g.n(function(U){switch(U.L){case 1:P=hG(M);g.DU(U,2);u=g.Jt(M.entityKey).entityId;if(u==="!*$_ALL_ENTITIES_!*$")return g.B(U,pX3(w.B),5);X=g.rt(u,"videoPlaybackPositionEntity");return g.B(U,Hyp(w.B,X),5);case 5:g.zp(U,3);break;case 2:return g.d4(U),U.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",P,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return U.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
P))}})},uyj=function(w,M){this.api=w;
this.B=M;this.logger=new g.pM("woffle");this.L=!1;this.yH={TR:this.TR};this.logger.debug("Initialized OfflineMediaManager")},XGp=function(w){return g.n(function(M){return M.return(zBC(w))})},$ba=function(w){var M;
return g.n(function(P){if(P.L==1)return g.B(P,g.YGM(w),2);M=P.B;return P.return(M.filter(function(u){return!!u.url}).map(function(u){return u.url}))})},nv=function(w,M){var P=g.ID(M);
if(P===1||P===0)return Promise.resolve();(P=UbU(w,M))&&P.stopVideo();w.C=0;return XGp(M)},vK=function(w,M,P,u){P=P===void 0?!1:P;
u=u===void 0?!0:u;var X=typeof M==="string"?M:M.videoDetails.videoId;g.ID(X)===2&&((M=UbU(w,X))?M.stopVideo():w.logger.info(function(){return"Corresponding player for "+X+" not found. Pausing anyway"}),g.AW(X,2),w.C=2,P?fZc(w.B):u&&WKE(w.B))},UbU=function(w,M){var P;
return((P=w.player)==null?void 0:P.getVideoData().videoId)===M?w.player:null},hTU=function(w,M,P){M.getPlayerResponse();
g.AW(M.videoId,2);w.C=2;w.L=!1;var u;(u=w.player)==null||u.dispose();w.player=w.api.oy(M);M={};w.player.Ng((M.localmediachange=w.bD,M.signatureexpired=w.MC,M.statechange=w.A9N,M),w);var X=w.TR(P);w.player.rN(g.G8(X,X,!0,"m"),!1);w.logger.debug(function(){return"Starting headless playback with quality: "+X});
w.player.n1(!1)},cKA=function(w,M){this.B=w;
this.P3=M},SRC=function(w,M){var P,u;
return g.n(function(X){switch(X.L){case 1:return P=hG(M),g.B(X,xU(w.B,M.entityKey,"transfer"),2);case 2:if(u=X.B)return X.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P));g.DU(X,3);return g.B(X,ZbE(w,M),5);case 5:g.zp(X,4);break;case 3:return g.d4(X),X.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",P,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return X.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
P))}})},HbU=function(w,M){var P,u;
return g.n(function(X){switch(X.L){case 1:return P=hG(M),g.B(X,xU(w.B,M.entityKey,"transfer"),2);case 2:u=X.B;if(!u||u.transferState!=="TRANSFER_STATE_COMPLETE")return X.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P));g.DU(X,3);return g.B(X,ZbE(w,M,!0),5);case 5:g.zp(X,4);break;case 3:return g.d4(X),X.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",P,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return X.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P))}})},pG4=function(w,M){var P,u,X,U,f,h,c,Z,S,H;
return g.n(function(p){switch(p.L){case 1:return P=hG(M),u=g.Jt(M.entityKey).entityId,g.B(p,Ci(w.B,{mode:"readonly",UF:!0},function(F){var E=bI(F,M.entityKey,"transfer");F=bI(F,g.rt(u,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.NZ.all([E,F])}),2);
case 2:X=p.B;U=g.G(X);f=U.next().value;h=U.next().value;c=f;Z=h;if(!c||c.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return p.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P));g.DU(p,3);c.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.B(p,tq(w.B,c,"transfer"),5);case 5:S=g.Jt(c.key).entityId;aG4({videoId:S,oG:c,offlineModeType:(H=Z)==null?void 0:H.offlineModeType});g.zp(p,4);break;case 3:return g.d4(p),p.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
P,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return p.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P))}})},ZbE=function(w,M,P){P=P===void 0?!1:P;
var u,X,U,f,h,c,Z,S,H,p,F,E,y,q,d;return g.n(function(l){switch(l.L){case 1:return u=g.A(M.actionMetadata,FK$),X=g.Jt(M.entityKey).entityId,U=g.rt(X,"downloadStatusEntity"),g.B(l,Ci(w.B,{mode:"readonly",UF:!0},function(e){var R=bI(e,U,"downloadStatusEntity");e=bI(e,g.rt(X,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.NZ.all([R,e])}),2);
case 2:return f=l.B,h=g.G(f),c=h.next().value,Z=h.next().value,S=c,H=Z,p="TRANSFER_STATE_TRANSFER_IN_QUEUE",((F=S)==null?void 0:F.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(p="TRANSFER_STATE_PAUSED_BY_USER"),q={key:M.entityKey,transferState:p,cotn:g.Hl(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(E=u)==null?void 0:E.maximumDownloadQuality,preferredAudioTrack:(y=u)==null?void 0:y.preferredAudioTrack,transferRetryCount:0,isRefresh:P,hasLoggedFirstStarted:!1},g.B(l,Ci(w.B,
{mode:"readwrite",UF:!0},function(e){var R=[];P&&R.push(Jq(e,g.rt(X,"offlineVideoStreams")));R.push(gP(e,q,"transfer"));return g.NZ.all(R)}),3);
case 3:if(!P){l.M0(4);break}return g.B(l,XGp(X),4);case 4:xax({videoId:X,oG:q,offlineModeType:(d=H)==null?void 0:d.offlineModeType}),g.yx(l)}})},NV4=function(w,M,P,u){if(!w.action.entityKey)throw Error("entityKey is missing.");
var X=g.Jt(w.action.entityKey);X={entityType:X.fP,entityId:X.entityId,offlineOrchestrationActionType:w.action.actionType,orchestrationAction:{orchestrationActionId:w.actionId}};M&&(X.offlineOrchestrationActionResult=M.status,X.isRetryable=P?!1:M.B,M.C&&(X.offlineOrchestrationFailureReason=EOE(M.C,X.isRetryable)));var U,f;if((U=w.action.actionMetadata)==null?0:(f=U.offlineLoggingData)==null?0:f.offlineModeType)X.offlineModeType=w.action.actionMetadata.offlineLoggingData.offlineModeType;u&&(X.additionalOrchestrationActions=
u.map(function(h){return{orchestrationActionId:h.actionId}}));
return X},EOE=function(w,M){return w!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||M?w==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&M?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":w:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},VrU=function(w,M){var P={offlineOrchestrationContext:NV4(w)};
M=QVE(M,P);kSt(BbE(),M,w.rootActionId)},mbA=function(w,M,P,u){u=u===void 0?[]:u;
M={offlineOrchestrationContext:NV4(w,M,P,u)};M=QVE(3,M);kSt(BbE(),M,w.rootActionId)},oOh=function(){this.actions=[]},GVj=function(w,M){M=g.G(M);
for(var P=M.next();!P.done;P=M.next())P=P.value,VrU(P,1),w.actions.push(P);w.actions.sort(w.B)},yK$=function(w,M){if(M)for(var P=0;P<w.actions.length;P++)if(M==="!*$_ALL_ENTITIES_!*$"&&w.actions[P].actionId!==M||M!=="!*$_ALL_ENTITIES_!*$"&&w.actions[P].rootActionId===M&&w.actions[P].actionId!==M)w.actions.splice(P,1),P--},Dbt=function(w,M){w=g.G(w.actions);
for(var P=w.next();!P.done;P=w.next())if(P.value.actionId===M)return!0;return!1},Kv=function(w,M,P,u,X){g.v.call(this);
var U=this;this.L=w;this.mN=M;this.B3=P;this.j=u;this.P3=X;this.B=new oOh;this.K=new g.vb;this.C=new g.gV(function(){U.retry()});
this.V=NaN;this.G=!1;this.yH={vXs:function(){return U.B},
Ev:function(){return U.K},
C6L:function(){return U.C},
retry:function(){return U.retry()}};
g.b(this,this.C);this.S=this.L.observe(this.Lu.bind(this))},zTt=function(w,M,P,u,X){var U;
return g.n(function(f){if(f.L==1)return U=new Kv(w,M,P,u,X),g.B(f,qR3(U),2);YRE(U);return f.return(U)})},YRE=function(w){var M=w.B.actions[0];
return w.X?((M==null?void 0:M.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&w.X[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(w.G=!0),Promise.resolve()):TVE(w)},TVE=function(w){var M,P,u,X,U,f,h,c,Z,S,H,p,F,E,y,q,d;
return g.n(function(l){switch(l.L){case 1:if(w.X)throw Error("Already processing an action");if(w.sO())return l.return();M=w.B.actions.shift();COt(w.B3,!M);if(M===void 0)return l.return();M.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&M.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&yK$(w.B,M.actionId);P="";M.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&M.rootActionId===M.actionId&&(P=M.actionId);u=[M];w.X=u;if(X=w.mN[M.entityType]){l.M0(2);break}w.X=
void 0;return g.B(l,TVE(w),3);case 3:return l.return();case 2:U=g.G(u);for(f=U.next();!f.done;f=U.next())h=f.value,VrU(h,2);g.DU(l,4,5);return g.B(l,gj4(X,u.map(function(e){return e.action})),7);
case 7:c=l.B,Z=g.G(u),S=Z.next();case 8:if(S.done){l.M0(10);break}H=S.value;p=c.get(H.action);return g.B(l,dbU(w,H,p),9);case 9:S=Z.next();l.M0(8);break;case 10:yK$(w.B,P);case 5:g.B5(l);w.X=void 0;g.Qx(l,6);break;case 4:return F=g.d4(l),uf("Orchestration error",F),g.DU(l,12),g.B(l,lZx(w,u),14);case 14:g.zp(l,5);break;case 12:E=g.d4(l);uf("Orchestration retry error",E);y=g.G(u);for(q=y.next();!q.done;q=y.next())d=q.value,d.retryScheduleIndex<3&&GVj(w.B,[d]);l.M0(5);break;case 6:return g.B(l,TVE(w),
0)}})},dbU=function(w,M,P){var u,X,U,f,h,c,Z,S,H,p,F,E;
return g.n(function(y){switch(y.L){case 1:u=M.retryScheduleIndex+2===3;if(P.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){y.M0(2);break}if(P.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){y.M0(0);break}mbA(M,P,u);if(P.B&&M.retryScheduleIndex+1<3)return g.B(y,lZx(w,[M]),0);U=((X=P)==null?0:X.L)?P.L:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";f={entityKey:M.action.entityKey,failureReason:U};h=void 0;g.fp(w.P3)?h="mainVideoDownloadStateEntity":g.LW(w.P3)&&(h="musicTrackDownloadMetadataEntity");
if(!h||!P.downloadState){y.M0(7);break}c=g.Jt(M.action.entityKey).entityId;return g.B(y,HK(c,h,w.L,P.downloadState),7);case 7:$Z(w.j,f);if(P.downloadState==="DOWNLOAD_STATE_FAILED"&&w.P3.D("html5_auto_retry_failed_pde_actions")){y.M0(0);break}uf("Orchestration result is not retryable, deleting action");return g.B(y,Hyp(w.L,mW(M).key),0);case 2:Z=void 0;try{Z=(S=P.X)==null?void 0:S.map(function(q){return w.createAction(q,M)})}catch(q){return mbA(M,P,u),H={entityKey:M.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},$Z(w.j,H),uf("Orchestration subactions creation error",q),y.return()}mbA(M,P,u,Z);if(!Z){y.M0(12);break}p=Z.map(function(q){return mW(q)});
F=0;case 13:if(!(F<Z.length)||w.G){y.M0(15);break}return g.B(y,Ci(w.L,{mode:"readwrite",UF:!0},function(q){var d=[];d.push(u4c(q,p.slice(F,F+10),"offlineOrchestrationActionWrapperEntity"));return g.NZ.all(d)}),16);
case 16:F+=10;y.M0(13);break;case 15:if(w.G)return w.G=!1,y.return();case 12:return E=mW(M),g.B(y,Hyp(w.L,E.key),17);case 17:VrU(M,4),g.yx(y)}})},Q34=function(w,M){var P,u,X,U,f,h,c,Z,S,H,p,F;
return g.n(function(E){P=[];u=Infinity;X=4E3;U=g.G(M);for(f=U.next();!f.done;f=U.next())h=f.value,c=Number(h.enqueueTimeSec),Z=LKp(c),S=h.retryScheduleIndex,H=S!=null&&S>0,Z>0&&H?(u=Math.min(u,c),X=Math.min(Z,X)):P.push(h);isFinite(u)&&(!w.C.isActive()||u<w.V)&&(w.V=u,w.C.start(X));w.K.UH()||(p=P.length,P=P.filter(function(y){var q;y=((q=y.actionProto)==null?void 0:q.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!eTE.includes(y)}),F=P.length<p,!w.C.isActive()&&F&&w.C.start(1));
P.length>0&&BVp(w,P);return g.B(E,YRE(w),0)})},RTE=function(w){var M,P,u,X,U,f,h;
return g.n(function(c){if(c.L==1)return g.B(c,kVE(w),2);M=c.B;P=[];u=g.G(M);for(X=u.next();!X.done;X=u.next())U=X.value,f=g.Jt(U.key),h=f.entityId,Dbt(w.B,h)||P.push(U);return g.B(c,Q34(w,P),0)})},LKp=function(w){w=w*1E3-Date.now();
return w>4E3?4E3:w},lZx=function(w,M){var P,u,X;
return g.n(function(U){P=g.G(M);for(u=P.next();!u.done;u=P.next()){X=u.value;var f=void 0,h=void 0,c=((h=X.action)==null?void 0:(f=h.actionMetadata)==null?void 0:f.retryScheduleIntervalsInSeconds)||[1,2,4];f=1;X.retryScheduleIndex<c.length&&(f=c[X.retryScheduleIndex]);X.B=f*1E3+Date.now();X.retryScheduleIndex++}return g.B(U,nOA(w,M),0)})},qR3=function(w){var M;
return g.n(function(P){if(P.L==1)return g.B(P,Oi(w.L,"offlineOrchestrationActionWrapperEntity"),2);M=P.B;return g.B(P,Q34(w,M),0)})},BVp=function(w,M){M.length!==0&&M.forEach(function(P){P=Vu(P);
P.retryScheduleIndex<3&&GVj(w.B,[P])})},kVE=function(w,M){var P;
return g.n(function(u){if(u.L==1)return g.B(u,Oi(w.L,"offlineOrchestrationActionWrapperEntity",M),2);P=u.B;return u.return(P.filter(ovC))})},nOA=function(w,M){if(M.length===0)return Promise.resolve([]);
M=M.map(function(P){return mW(P)});
return SZE(w.L,M)},vOV=function(w){this.h9=w;
this.B=void 0},s3C=function(w,M){var P,u,X,U;
return g.n(function(f){P=M.videoId;u=!0;if(M.captionTracks.length)X=O4$(M),w.B=new g.ze(w.h9,M,X);else if(M.Lx)U=g.Ray(M),w.B=new g.d7(w.h9,M.Lx,P,U,M.b4,M.eventId),u=M.b4;else return f.return();return f.return(new Promise(function(h){var c;(c=w.B)==null||c.Sr({j1:function(){return g.n(function(Z){if(Z.L==1)return g.B(Z,w.j1(P,u),2);h();g.yx(Z)})},
GI:function(){}})}))})},KKC=function(w){var M;
return g.n(function(P){if(P.L==1)return g.B(P,YZ4(w),2);M=P.B;return P.return(!!M&&M.length>0)})},bf=function(w){g.v.call(this);
this.B=w;this.L=this.B.observe(this.C.bind(this))},bba=function(w,M){var P,u,X,U,f,h,c;
return g.n(function(Z){switch(Z.L){case 1:if(M.length===0)return Z.return([]);P=M.map(function(S){return g.rt(S,"transfer")});
return g.B(Z,Oi(w.B,"transfer",P),2);case 2:u=Z.B;X=u.filter(ovC).map(function(S){return g.Jt(S.key).entityId});
U=M.filter(function(S){return X.indexOf(S)===-1});
if(U.length===0)return Z.return([]);f=g.G(U);h=f.next();case 3:if(h.done){Z.M0(5);break}c=h.value;return g.B(Z,XGp(c),4);case 4:h=f.next();Z.M0(3);break;case 5:return Z.return(U)}})},gO$=function(w,M,P,u,X,U){var f,h,c;
return g.n(function(Z){f="STREAM_TYPE_UNKNOWN";P.video&&P.audio?(f="STREAM_TYPE_AUDIO_AND_VIDEO",uf("unexpected stream type")):P.video&&!P.audio?f="STREAM_TYPE_VIDEO":!P.video&&P.audio&&(f="STREAM_TYPE_AUDIO");h=g.rt(M,"offlineVideoStreams");c={numBytesDownloaded:X.toFixed(),numTotalBytes:U.toFixed(),streamType:f,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(u),itag:f==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(P.itag):void 0};return g.B(Z,Ci(w,{mode:"readwrite",UF:!0},
function(S){var H=bI(S,h,"offlineVideoStreams"),p=bI(S,g.rt(M,"transfer"),"transfer");return g.NZ.all([H,p]).then(function(F){F=g.G(F);var E=F.next().value;F=F.next().value;if(!F)return Jq(S,h).then(function(){});
var y=IZc(E);E=AK3(E,u,c,h);var q=gP(S,E,"offlineVideoStreams");IZc(E)>y&&(F.lastProgressTimeMs=Date.now().toString());y=[q];F.offlineVideoStreams||(F.offlineVideoStreams=[]);F.offlineVideoStreams.indexOf(h)===-1&&(F.offlineVideoStreams.push(h),y.push(gP(S,F,"transfer")));return g.NZ.all(y)})}),0)})},JKt=function(w,M){var P,u,X,U,f;
return g.n(function(h){if(h.L==1)return P=g.rt(M,"offlineVideoStreams"),g.B(h,xU(w,P,"offlineVideoStreams"),2);u=h.B;if(!u||!u.streamsProgress)return h.return();X=g.G(u.streamsProgress);for(U=X.next();!U.done;U=X.next())f=U.value,f.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",f.numTotalBytes!==f.numBytesDownloaded&&(f.numBytesDownloaded=f.numTotalBytes);return g.B(h,tq(w,u,"offlineVideoStreams"),0)})},AK3=function(w,M,P,u){if(w&&w.streamsProgress){u=w;
a:{M=M.itag+";"+M.xtags;for(var X=w.streamsProgress,U=0;U<X.length;U++){var f=JSON.parse(X[U].formatStreamBytes);if(f.itag+";"+f.xtags===M){X[U]=P;P=X;break a}}X.push(P);P=X}u.streamsProgress=P}else w={key:u,streamsProgress:[P]};return w},IZc=function(w){if(w==null?0:w.streamsProgress){var M=0;
w=w.streamsProgress;for(var P=0;P<w.length;P++){var u=w[P];isNaN(Number(u.numBytesDownloaded))?uf("stream progress bytes number invalid"):M+=Number(u.numBytesDownloaded)}return M}return 0},rK3=function(w,M,P,u){g.v.call(this);
var X=this;this.L=w;this.api=M;this.OO=P;this.Lu=u;this.K=new g.vb;this.X=new g.gV(function(){X.B&&X.B.transferState==="TRANSFER_STATE_TRANSFERRING"&&X.K.UH()&&((X.B.transferRetryCount||0)<3?vK(X.j,X.G,!1,!1):nv(X.j,X.G.videoDetails.videoId),X.G9("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.B3=this.Cu=0;this.S=this.V=!1;this.t9=g.Oh(this.api.N().experiments,"html5_transfer_processing_logs_interval");this.eL=new g.V2(this);this.yH={kQO:function(){return X.X},
JlI:function(){return X.Lu},
Ev:function(){return X.K}};
this.mN=this.L.observe(this.Lv.bind(this));this.j=new uyj(M,this);this.Yu=new vOV(M);this.ys=new bf(this.L);this.UO=this.K.listen("publicytnetworkstatus-online",this.qa.bind(this));this.xu=this.K.listen("publicytnetworkstatus-offline",this.xfN.bind(this));this.S=this.api.N().D("html5_less_transfer_processing_logs");g.b(this,this.eL);this.eL.Y(M,"offlinetransferpause",this.e3$);if(g.fp(this.api.N()))this.C="mainVideoDownloadStateEntity";else if(g.LW(this.api.N())||g.hW(this.api.N()))this.C="musicTrackDownloadMetadataEntity"},
j33=function(w){return g.n(function(M){if(M.L==1)M=g.B(M,Da3(),2);
else{var P=w.ys;var u=g.bT();u=Object.keys(u);P=bba(P,u);M=g.B(M,P,0)}return M})},AG=function(w,M){M=M===void 0?!1:M;
var P;return g.n(function(u){if(u.L==1){if(w.B)throw Error("Already downloading a video");w.B3=0;w.V=!1;return g.B(u,CcE(w),2)}return u.L!=4?(P=u.B,t7U(w.OO,!P),P&&w.K.UH()?M?g.B(u,new Promise(function(X){g.cF(X,1E3)}),4):u.M0(4):(!P&&w.B&&Iq(w),u.M0(0))):g.B(u,tr$(w,P),0)})},xbt=function(w){return g.n(function(M){if(M.L==1)return w.G?g.B(M,nv(w.j,w.G.videoDetails.videoId),3):M.M0(0);
Iq(w);g.yx(M)})},Ob4=function(w,M){var P,u,X;
return g.n(function(U){switch(U.L){case 1:return g.DU(U,2),(P=!!M.captionTracks.length||!!M.Lx)?g.B(U,KKC(M.videoId),4):U.return();case 4:return(u=U.B)?U.return():g.B(U,s3C(w.Yu,M),5);case 5:g.zp(U,0);break;case 2:X=g.d4(U),uf("Caption downloading error",X,M.cotn),g.yx(U)}})},tr$=function(w,M){var P,u,X,U,f,h;
return g.n(function(c){switch(c.L){case 1:if(w.V)return c.return();w.V=!0;w.B=M;P=g.Jt(w.B.key);u=P.entityId;X=void 0;if(w.B.transferState==="TRANSFER_STATE_TRANSFERRING")return g.B(c,gl(w,u),7);if(w.B.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||w.B.transferRetryCount||w.B.hasLoggedFirstStarted){c.M0(3);break}return g.B(c,gl(w,u),5);case 5:return X=c.B,w.B.hasLoggedFirstStarted=!0,g.B(c,aZh(w),6);case 6:Oya({videoId:u,oG:w.B,offlineModeType:X},void 0,void 0,!0);c.M0(3);break;case 7:X=c.B,
WK({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:u,oG:w.B,offlineModeType:X});case 3:return g.B(c,wI4(w),8);case 8:return U=null,g.DU(c,9),g.B(c,i_c(w,M),11);case 11:U=c.B;w.G=U;g.zp(c,10);break;case 9:return f=g.d4(c),uf("error getting player response",f,M.cotn),g.B(c,w.G9("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return c.return();case 10:return h=X_U(w.api.N(),M.cotn,U),g.B(c,Ob4(w,h),13);case 13:return g.B(c,$ba(h.videoId),
14);case 14:h.qk=c.B,hTU(w.j,h,M.maximumDownloadQuality),w.X.start(108E5),g.yx(c)}})},CcE=function(w){var M,P;
return g.n(function(u){if(u.L==1)return g.B(u,Oi(w.L,"transfer"),2);M=u.B;P=M.filter(MDt).sort(PoE);return P.length===0?u.return():u.return(P[0])})},wI4=function(w){var M,P,u;
return g.n(function(X){if(X.L==1){if(!w.B)return JG(w,"onTransferStart"),X.return();w.X.start(108E5);return g.B(X,rl(w,"TRANSFER_STATE_TRANSFERRING"),2)}M=w.B;return(u=((P=M)==null?0:P.key)?g.Jt(M.key).entityId:"")&&w.C?g.B(X,HK(u,w.C,w.L,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):X.M0(0)})},fZc=function(w){var M,P,u,X;
g.n(function(U){switch(U.L){case 1:if(!w.B){JG(w,"onTransferPausedByUser");U.M0(2);break}M=w.B;w.X.stop();return g.B(U,rl(w,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:u=((P=M)==null?0:P.key)?g.Jt(M.key).entityId:"";if(!u||!w.C){U.M0(4);break}return g.B(U,HK(u,w.C,w.L,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.B(U,gl(w,u),6);case 6:X=U.B,w_A({videoId:u,oG:M,offlineModeType:X});case 2:Iq(w),AG(w),g.yx(U)}})},WKE=function(w){var M,P,u;
g.n(function(X){if(X.L==1){if(!w.B)return JG(w,"onTransferPausedByNetwork"),X.return();w.X.stop();return g.B(X,rl(w,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(X.L!=3)return M=w.B,(u=((P=M)==null?0:P.key)?g.Jt(M.key).entityId:"")&&w.C?g.B(X,HK(u,w.C,w.L,"DOWNLOAD_STATE_PAUSED"),3):X.M0(3);Iq(w);g.yx(X)})},u6U=function(w){var M,P,u,X,U;
g.n(function(f){switch(f.L){case 1:if(!w.B)return JG(w,"onTransferComplete"),f.return();M=w.B;w.X.stop();if(!M||!w.G){f.M0(2);break}P=X_U(w.api.N(),M.cotn,w.G);return g.B(f,Ob4(w,P),2);case 2:return g.B(f,rl(w,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:X=((u=M)==null?0:u.key)?g.Jt(M.key).entityId:"";if(!X||!w.C){f.M0(5);break}return g.B(f,HK(X,w.C,w.L,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.B(f,JKt(w.L,X),7);case 7:return g.B(f,gl(w,X),8);case 8:U=f.B,WK({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:X,oG:M,offlineModeType:U}),Iq(w),AG(w),g.yx(f)}})},XIa=function(w,M,P){var u,X;
g.n(function(U){switch(U.L){case 1:if(!w.B)return JG(w,"onTransferProgress: "+M),U.return();if(w.B.transferState==="TRANSFER_STATE_TRANSFERRING"){U.M0(2);break}return g.B(U,wI4(w),2);case 2:u=Date.now();if(!(u-w.Cu>1E3)){U.M0(4);break}w.Cu=u;return g.B(U,gO$(w.L,P.videoId,P.L,P.KU,P.bytesDownloaded,P.B),5);case 5:if(w.S&&!(w.S&&u-w.B3>w.t9)){U.M0(4);break}w.B3=u;return g.B(U,gl(w,M),7);case 7:X=U.B,Oya({videoId:M,oG:w.B,offlineModeType:X},P.bytesDownloaded,P.B);case 4:w.X.start(108E5),g.yx(U)}})},
$Bx=function(w){var M=(w.B.transferRetryCount||0)<3;
M&&(w=w.B,w.transferRetryCount=(w.transferRetryCount||0)+1);return M},UBc=function(w,M){M=M===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":M;
var P,u,X,U;return g.n(function(f){if(f.L==1)return w.B||JG(w,"setTransferToFailed: "+M),P="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",M==="TRANSFER_FAILURE_REASON_NETWORK"?P="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":M==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(P="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.B(f,rl(w,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",M),2);if(f.L!=3)return $Z(w.Lu,{entityKey:(u=w.B)==null?void 0:u.key,failureReason:P}),
X=w.B?g.Jt(w.B.key).entityId:"",g.B(f,gl(w,X),3);U=f.B;var h={videoId:X,oG:w.B,offlineModeType:U},c=M,Z={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};c&&(Z.transferFailureReason=c,Z.failureReason=iZh(c));WK(Z,h);g.yx(f)})},rl=function(w,M,P,u){var X;
return g.n(function(U){if(U.L==1){if(!w.B)return JG(w,"saveTransferState: "+M),U.return();w.B.transferState=M;w.B.failureReason=u;g.DU(U,2);return g.B(U,aZh(w,function(f){return P?I2(f,"offlineVideoStreams",w.B.offlineVideoStreams).then(function(h){for(var c=g.G(h),Z=c.next();!Z.done;Z=c.next())if((Z=Z.value)&&Z.streamsProgress){Z=g.G(Z.streamsProgress);for(var S=Z.next();!S.done;S=Z.next())S.value.streamState=P}return u4c(f,h.filter(function(H){return!!H}),"offlineVideoStreams")}):g.NZ.resolve(void 0)}),
4)}if(U.L!=2)return g.zp(U,0);
X=g.d4(U);return X instanceof g.cN&&X.type==="QUOTA_EXCEEDED"?g.B(U,w.G9("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):U.M0(0)})},aZh=function(w,M){var P;
return g.n(function(u){if(!w.B)return u.return();P=w.B;return g.B(u,Ci(w.L,{mode:"readwrite",UF:!0},function(X){var U=[gP(X,P,"transfer")];M&&U.push(M(X));return g.NZ.all(U)}),0)})},Iq=function(w){w.B=void 0;
w.G=void 0;w.X.stop()},i_c=function(w,M){var P,u,X,U,f;
return g.n(function(h){if(h.L==1)return P=g.Jt(M.key),u=P.entityId,X=g.rt(u,"playbackData"),g.B(h,xU(w.L,X,"playbackData"),2);U=h.B;if((f=U)==null?0:f.playerResponseJson)return h.return(JSON.parse(U.playerResponseJson));throw Error("No PlayerResponse found");})},JG=function(w,M){w.api.II("woffle",{mcte:M});
uf("missing current transfer entity.")},gl=function(w,M){var P,u,X;
return g.n(function(U){if(U.L==1)return g.B(U,xU(w.L,g.rt(M,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);P=U.B;return U.return((X=(u=P)==null?void 0:u.offlineModeType)!=null?X:void 0)})},MDt=function(w){return fWA[w.transferState]!==void 0},PoE=function(w,M){var P=fWA[w.transferState],u=fWA[M.transferState];
return P!==u?P-u:Number(w.enqueuedTimestampMs)-Number(M.enqueuedTimestampMs)},jE=function(w,M){var P=this;
this.P3=w;this.api=M;this.K=new g.vb;this.G=new g.hC;this.yH={LL:function(){return P.C.yH.LL()},
Ev:function(){return P.K},
Scu:function(){return P.C},
q$:function(){return P.q$()},
rS:function(){return P.rS()},
yW:function(){return P.yW()},
xU:function(){return P.xU()},
KI:function(){return P.KI()},
GV:function(u){return P.GV(u)}};
this.C=new JnU(function(){return WZA(P)},function(){P.yW()},this.api.K$(),this.api.D.bind(this.api));
this.B=new Xe(this.api);rnE(this.C)},WZA=function(w){return g.n(function(M){w.api.Vs("onOrchestrationBecameLeader");
return g.B(M,w.rS(),0)})},c_a=function(w){var M,P;
return g.n(function(u){if(u.L==1)return g.B(u,a2(),2);if(u.L!=3){M=u.B;if(!M)return uf("PES is undefined"),u.return();w.L=new rK3(M,w.api,w.C,w.B);P=w.F6(M);return g.B(u,zTt(M,P,w.C,w.B,w.P3),3)}w.j=u.B;return g.B(u,huE(w),0)})},huE=function(w){var M;
return g.n(function(P){switch(P.L){case 1:if(!w.L)return uf("transferManager is undefined"),P.return();if(w.L.B){P.M0(2);break}return g.B(P,AG(w.L),2);case 2:if(!w.P3.D("woffle_enable_main_downloads_library")){P.M0(4);break}return g.B(P,w.JK(),4);case 4:if(!w.P3.D("html5_offline_playback_position_sync")){P.M0(6);break}return g.B(P,w.gE(),7);case 7:return g.B(P,w.GV(864E5),6);case 6:return g.B(P,w.refreshAllStaleEntities(43200,!0),9);case 9:return g.B(P,w.xP(),10);case 10:if(!w.P3.D("html5_retry_downloads_for_expiration")){P.M0(11);
break}return g.B(P,w.KI(),11);case 11:return w.V=g.ZK(function(){w.refreshAllStaleEntities(43200,!0);w.xP()},9E5),g.rH(g.C0(),function(){return w.xU()}),g.B(P,a2(),13);
case 13:return M=P.B,g.B(P,gvE(M),14);case 14:jV4(w.C),g.yx(P)}})},Z_$=function(){var w,M,P,u,X,U;
return g.n(function(f){switch(f.L){case 1:return g.B(f,a2(),2);case 2:w=f.B;if(!w)return f.return([]);M=Date.now()/1E3;return g.B(f,Oi(w,"offlineVideoPolicy"),3);case 3:P=f.B,u=g.G(P),X=u.next();case 4:if(X.done){f.M0(6);break}U=X.value;if(!(U.expirationTimestamp&&Number(U.expirationTimestamp)<M)){f.M0(5);break}U.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";U.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.B(f,tq(w,U,"offlineVideoPolicy"),5);
case 5:X=u.next();f.M0(4);break;case 6:return f.return(P.map(function(h){return h.key}))}})},Cv=function(w,M,P,u,X){var U,f,h;
return g.n(function(c){if(c.L==1)return g.B(c,a2(),2);U=c.B;if(!U)return c.return([]);f=M.map(function(Z){var S=g.rt(Z,P);S={actionType:u,entityKey:S,actionMetadata:Object.assign({},$Mc(),X)};u!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(S.actionMetadata.priority=0);Z=new Nz(P,Z,S);return mW(Z)});
h=SZE(U,f);rnE(w.C);return c.return(h)})},SNh=function(w,M,P,u){var X,U,f,h,c,Z,S,H;
return g.n(function(p){switch(p.L){case 1:X=[],U=g.G(M),f=U.next();case 2:if(f.done){p.M0(4);break}h=f.value;if(h.upToDate||P&&!h.shouldAutoSyncMetadata||!h.playlistId){p.M0(3);break}c={};switch(u){case "mainPlaylistEntity":Z={nextAutoRefreshIntervalSeconds:h.checkInSeconds,autoSync:P};c={mainPlaylistEntityActionMetadata:Z};break;case "musicPlaylist":S={autoSync:P},c={musicPlaylistEntityActionMetadata:S}}return g.B(p,Cv(w,[h.playlistId],u,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",c),6);case 6:(H=
p.B)&&X.push.apply(X,g.L(H));case 3:f=U.next();p.M0(2);break;case 4:return p.return(X)}})},H_p=function(w,M){var P;
return g.n(function(u){return M.length?(P=$Mc(),g.Lq(P,kZ,{isEnqueuedForExpiredStreamUrlRefetch:!0}),w.api.II("qrd",{v:M.length}),u.return(Cv(w,M,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",P))):u.return([])})},pIV=function(w,M,P){this.B=w;
this.P3=M;this.C=P},N1c=function(w,M){var P,u,X,U,f,h,c,Z,S,H,p,F,E,y,q,d,l;
return g.n(function(e){switch(e.L){case 1:return P=hG(M),u=g.Jt(M.entityKey),X=u.entityId,U=[],g.DU(e,2),g.B(e,FZ4(w,X),4);case 4:U=e.B;if(!(w.P3.D("woffle_enable_main_downloads_library")&&((f=U)==null?0:f.length))){e.M0(5);break}return g.B(e,V63(w.B,[M.entityKey]),5);case 5:g.zp(e,3);break;case 2:return h=g.d4(e),c="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Z="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",h instanceof g.cN&&h.type==="QUOTA_EXCEEDED"?(c="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
Z="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):uf("Playlist add error"),e.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",P,void 0,c,Z));case 3:S=[];if(!w.P3.D("html5_offline_prevent_redownload_downloaded_video")){e.M0(7);break}return g.B(e,u13(w.B,"mainVideoEntity",U),8);case 8:U=e.B;case 7:if((H=U)==null?0:H.length)for(p=g.G(U),F=p.next();!F.done;F=p.next())if(E=F.value,y=E.offlineVideoData,q=void 0,(q=y)==null?0:q.videoId)d=void 0,l=Number(((d=M.actionMetadata)==null?void 0:d.priority)||
0)+1,S.push(BK("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",y.videoId,"mainVideoEntity",l,tG,ERU(M,y,X)));return e.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P,S))}})},mBc=function(w,M){var P,u,X,U,f,h,c,Z,S,H,p,F,E,y,q,d,l,e,R,I,w4,t,$M,fz,U1,ZU,M_,Tp,kM,w3,sE,Vt,v5,OE,pC,g3,MK,T,nE,ep,P5,d3,D,i2,J5,fQ,KC,g4,O1,aK,vT,Y,m,z,Q,K,Su,J,O,k,eu,IF,W5,hx,l2,Gp,i6,qj,nC,YM,yy,Lz,Ba,YV;
return g.n(function(fE){switch(fE.L){case 1:return P=hG(M),u=M.entityKey,X=g.Jt(u).entityId,U=[],f=!1,X==="!*$_ALL_ENTITIES_!*$"?(f=!0,g.B(fE,Oi(w.B,"mainPlaylistEntity"),5)):g.B(fE,xU(w.B,u,"mainPlaylistEntity"),4);case 4:(h=fE.B)&&U.push(h);fE.M0(3);break;case 5:U=fE.B;case 3:if((c=U)==null||!c.length)return fE.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P));Z=g.A(M.actionMetadata,VDA);H=(S=Z)==null?void 0:S.nextAutoRefreshIntervalSeconds;F=(p=Z)==null?void 0:p.autoSync;E=[];q=y=
!0;d=!1;if(!f&&F===!1){fE.M0(6);break}g.DU(fE,7);return g.B(fE,BsC(0,!!F,!0,U),9);case 9:E=fE.B;g.zp(fE,8);break;case 7:l=g.d4(fE);if(!(l instanceof Error&&l.message==="No data")){l instanceof Error&&l.message==="Empty response body"&&uf(l.message);fE.M0(8);break}return X==="!*$_ALL_ENTITIES_!*$"?g.B(fE,SoU(w.B,M,w.C,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.B(fE,cCU(X,w.B,M,w.C),8);case 8:if(!E.length||!f&&E[0].playlistId!==X)return fE.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
P));case 6:if(f){e=[];R=g.G(E);for(I=R.next();!I.done;I=R.next())w4=I.value,w4.upToDate||F&&!w4.shouldAutoSyncMetadata||!w4.playlistId||(t={nextAutoRefreshIntervalSeconds:w4.checkInSeconds,autoSync:F},e.push(BK("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",w4.playlistId,"mainPlaylistEntity",0,tG,{mainPlaylistEntityActionMetadata:t})));return fE.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P,e))}E.length&&($M=E[0],d=!!$M.upToDate,F&&(y=(fz=$M.shouldAutoSyncMetadata)!=null?fz:!0,q=(U1=
$M.shouldAutoSyncVideos)!=null?U1:!0,$M.checkInSeconds&&(H=$M.checkInSeconds)));if(d||!y)return fE.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P));ZU=[];M_=U[0];if(!M_.downloadState){Tp=void 0;fE.M0(15);break}return g.B(fE,xU(w.B,M_.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:Tp=fE.B;case 15:return kM=Tp,sE=((w3=kM)==null?0:w3.addedTimestampMillis)?String(kM.addedTimestampMillis):void 0,g.DU(fE,17),g.B(fE,FZ4(w,X,sE,H),19);case 19:ZU=fE.B;g.zp(fE,18);break;case 17:Vt=
g.d4(fE);if(!(Vt instanceof Error&&Vt.message==="No data for playlist")){if(Vt instanceof Error&&Vt.message==="Empty response body for playlist")uf(Vt.message);else return v5="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",OE="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Vt instanceof g.cN&&Vt.type==="QUOTA_EXCEEDED"&&(v5="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",OE="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),fE.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
P,void 0,v5,OE));fE.M0(18);break}return g.B(fE,cCU(X,w.B,M,w.C),18);case 18:if(!q)return fE.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P));pC=[];g3=new Map;if((MK=ZU)==null?0:MK.length)for(T=g.G(ZU),nE=T.next();!nE.done;nE=T.next())ep=nE.value,P5=ep.offlineVideoData,d3=void 0,((d3=P5)==null?0:d3.videoId)&&g3.set(P5.videoId,P5);D=new Map;i2=[];if((J5=M_)==null?0:(fQ=J5.videos)==null?0:fQ.length)for(KC=g.G(M_.videos),g4=KC.next();!g4.done;g4=KC.next())if(O1=g4.value,aK=JSON.parse(g.Jt(O1).entityId),
vT=aK.videoId)g3.has(vT)?(D.set(vT,g3.get(vT)),g3.delete(vT)):i2.push(vT);m=Number(((Y=M.actionMetadata)==null?void 0:Y.priority)||0)+1;z=g.G(g3.entries());for(Q=z.next();!Q.done;Q=z.next())K=Q.value,Su=g.G(K),J=Su.next().value,O=Su.next().value,k=J,eu=O,pC.push(BK("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",k,"mainVideoEntity",m,tG,ERU(M,eu,X)));IF=g.G(D.entries());for(W5=IF.next();!W5.done;W5=IF.next())hx=W5.value,l2=g.G(hx),Gp=l2.next().value,i6=l2.next().value,qj=Gp,nC=i6,pC.push(BK("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
qj,"mainVideoEntity",m,tG,ERU(M,nC,X)));YM=g.G(i2);for(yy=YM.next();!yy.done;yy=YM.next())Lz=yy.value,Ba={playlistId:X},YV={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:Ba},pC.push(BK("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",Lz,"mainVideoEntity",0,tG,YV));return fE.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P,pC))}})},oRC=function(w,M){var P,u,X,U;
return g.n(function(f){switch(f.L){case 1:return P=hG(M),g.DU(f,2),u=g.Jt(M.entityKey).entityId,u==="!*$_ALL_ENTITIES_!*$"?g.B(f,SoU(w.B,M,w.C,(X=M.actionMetadata)==null?void 0:(U=X.offlineLoggingData)==null?void 0:U.offlineDeleteReason),5):g.B(f,cCU(u,w.B,M,w.C),6);case 6:if(!w.P3.D("woffle_enable_main_downloads_library")){f.M0(5);break}return g.B(f,mMx(w.B,M.entityKey),5);case 5:g.zp(f,3);break;case 2:return g.d4(f),f.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",P,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return f.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P))}})},FZ4=function(w,M,P,u){var X,U,f,h,c,Z,S;
return g.n(function(H){switch(H.L){case 1:return g.B(H,LvA([M]),2);case 2:return X=H.B,g.B(H,GyC(w,X[0],P,u),3);case 3:return U=H.B,f=U.mainPlaylistEntity,h=U.wl$,Z=Wv3(f,(c=h)==null?void 0:c.avatar),g.DU(H,4),g.B(H,Gh(Z),6);case 6:g.zp(H,5);break;case 4:S=g.d4(H),S instanceof Error&&S.message==="Failed to fetch"&&uf(S.message);case 5:return H.return(X[0].videos)}})},GyC=function(w,M,P,u){var X,U,f,h,c,Z,S,H,p,F,E,y,q,d,l,e,R;
return g.n(function(I){switch(I.L){case 1:X=Date.now().toString();P||(P=X);U=M.videos;f=M.playlistId;h=[];c=[];if(U)for(Z=g.G(U),S=Z.next();!S.done;S=Z.next()){H=S.value;p=H.offlineVideoData;if(!p||!p.videoId)throw uf("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");F=p.videoId;E={videoId:F,playlistId:f};y={id:g.rt(JSON.stringify(E),"mainPlaylistVideoEntity"),video:g.rt(F,"mainVideoEntity")};h.push(y);c.push(y.id)}d={key:g.rt(f,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:P,lastSyncedTimestampMillis:X};l={key:g.rt(f,"mainPlaylistEntity"),playlistId:f,videos:c,title:M.title,thumbnailStyleData:y_3(M),visibility:DBj(M),downloadState:d.key};M.channel&&(e=M.channel.offlineChannelData,q=qNa(g.rt(f,"ytMainChannelEntity"),e),l.channelOwner=q.id);((R=l)==null?0:R.entityMetadata)?(l.entityMetadata.offlineLastModifiedTimestampSeconds=M.lastModifiedTimestamp,u&&(l.entityMetadata.nextAutoRefreshIntervalSeconds=String(u))):l&&(l.entityMetadata={nextAutoRefreshIntervalSeconds:u?
String(u):void 0,offlineLastModifiedTimestampSeconds:M.lastModifiedTimestamp});g.DU(I,2);return g.B(I,Ci(w.B,{mode:"readwrite",UF:!0},function(w4){var t=gP(w4,l,"mainPlaylistEntity"),$M=gP(w4,d,"mainPlaylistDownloadStateEntity");t=[t,$M];$M=g.G(h);for(var fz=$M.next();!fz.done;fz=$M.next())t.push(gP(w4,fz.value,"mainPlaylistVideoEntity"));q&&t.push(gP(w4,q,"ytMainChannelEntity"));return g.NZ.all(t)}),4);
case 4:g.zp(I,3);break;case 2:throw g.d4(I),uf("PES failure for playlist"),Error("PES failure for playlist");case 3:return I.return({mainPlaylistEntity:l,wl$:q,G23:h})}})},qNa=function(w,M){return{id:w,
channelId:M.channelId,title:M.title,avatar:M.thumbnail}},y_3=function(w){var M=[],P=w.videos;
P&&P.length>0&&M.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:P[0].offlineVideoData.thumbnail}}});if((w=w.additionalMetadadatas)&&w.length>0)for(w=g.G(w),P=w.next();!P.done;P=w.next()){var u=P.value.offlineBundleItemPlaylistData,X=void 0;P=(X=u)==null?void 0:X.style;X=void 0;u={collageThumbnail:{coverThumbnail:(X=u)==null?void 0:X.coverThumbnail}};switch(P){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":M.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:u});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":M.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:u});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":M.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:u});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":M.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:u})}}return M},DBj=function(w){switch(w.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},ERU=function(w,M,P){M={offlineVideoData:M,
playlistId:P};if(w=g.A(w.actionMetadata,VDA))M.maximumDownloadQuality=w.maximumDownloadQuality;return{mainVideoEntityActionMetadata:M}},YNa=function(w,M,P){this.B=w;
this.P3=M;this.C=P},dBE=function(w,M){var P,u,X,U,f,h,c,Z,S,H,p,F,E;
return g.n(function(y){switch(y.L){case 1:return P=hG(M),u=g.Jt(M.entityKey),X=u.entityId,U=g.A(M.actionMetadata,xZ),h=!((f=U)==null?0:f.playlistId),g.DU(y,2),g.B(y,zuh(w,X,void 0,(c=U)==null?void 0:c.offlineVideoData,h),4);case 4:g.zp(y,3);break;case 2:return Z=g.d4(y),S="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",H="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Z instanceof g.cN&&Z.type==="QUOTA_EXCEEDED"&&(S="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",H="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
y.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",P,void 0,S,H));case 3:p=1;p=Number(((F=M.actionMetadata)==null?void 0:F.priority)||0)+1;var q=(q=g.A(M.actionMetadata,xZ))?{playbackDataActionMetadata:{maximumDownloadQuality:q.maximumDownloadQuality}}:void 0;E=BK("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",X,"playbackData",p,T1a,q);return y.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P,[E]))}})},lWC=function(w,M){var P,u,X,U,f,h,c,Z,S,H,p,F,E,y,q,d,l;
return g.n(function(e){switch(e.L){case 1:return P=hG(M),u=g.Jt(M.entityKey),X=u.entityId,g.B(e,xU(w.B,M.entityKey,"mainVideoEntity"),2);case 2:U=e.B;if(!U){f=void 0;e.M0(3);break}return g.B(e,xU(w.B,U.downloadState,"mainVideoDownloadStateEntity"),4);case 4:f=e.B;case 3:h=f;if(!U||!h)return e.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P));g.DU(e,5);return g.B(e,zuh(w,X,h.addedTimestampMillis,(Z=g.A(M.actionMetadata,xZ))==null?void 0:Z.offlineVideoData),7);case 7:S=1;S=Number(((H=
M.actionMetadata)==null?void 0:H.priority)||0)+1;c=BK("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",X,"playbackData",S,T1a);g.zp(e,6);break;case 5:p=g.d4(e);if(!(p instanceof Error&&p.message==="No data")){if(p instanceof Error&&p.message==="Empty response body")uf(p.message);else return F="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",E="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",p instanceof g.cN&&p.type==="QUOTA_EXCEEDED"&&(F="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
E="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),e.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",P,void 0,F,E));e.M0(6);break}return g.B(e,qz(w.B,X),9);case 9:y=e.B;q=g.A(M.actionMetadata,xZ);if(l=(d=q)==null?void 0:d.playlistId)y.playlistId=l;y.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.B(e,yu(X,w.B,M,w.C,y),6);case 6:return e.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P,c?[c]:void 0))}})},LZc=function(w,M){var P,u,X,U,f,h,c,Z,S,H;
return g.n(function(p){switch(p.L){case 1:return P=hG(M),g.DU(p,2),u=g.Jt(M.entityKey).entityId,u==="!*$_ALL_ENTITIES_!*$"?g.B(p,SoU(w.B,M,w.C,(S=M.actionMetadata)==null?void 0:(H=S.offlineLoggingData)==null?void 0:H.offlineDeleteReason),5):g.B(p,qz(w.B,u),6);case 6:X=p.B;U=g.A(M.actionMetadata,xZ);if(h=(f=U)==null?void 0:f.playlistId)X.playlistId=h;X.offlineDeleteReason=(c=M.actionMetadata)==null?void 0:(Z=c.offlineLoggingData)==null?void 0:Z.offlineDeleteReason;return g.B(p,yu(u,w.B,M,w.C,X),7);
case 7:if(!w.P3.D("woffle_enable_main_downloads_library")){p.M0(5);break}return g.B(p,mMx(w.B,M.entityKey),5);case 5:g.zp(p,3);break;case 2:return g.d4(p),p.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",P,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return p.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P))}})},zuh=function(w,M,P,u,X){var U,f,h,c,Z,S;
return g.n(function(H){switch(H.L){case 1:if(U=u){H.M0(2);break}return g.B(H,lia([M]),3);case 3:f=H.B,U=f[0];case 2:return g.B(H,euV(w,U,P,X),4);case 4:h=H.B;c=h.mainVideoEntity;Z=h.channelEntity;g.DU(H,5);var p=Et(c.thumbnail),F=Et(Z.avatar);return g.B(H,Gh(p.concat(F)),7);case 7:g.zp(H,0);break;case 5:S=g.d4(H),S instanceof Error&&S.message==="Failed to fetch"&&uf(S.message),g.yx(H)}})},euV=function(w,M,P,u){var X,U,f,h,c,Z,S,H,p,F,E,y,q;
return g.n(function(d){switch(d.L){case 1:P||(P=Date.now().toString());U=(X=M.channel)==null?void 0:X.offlineChannelData;f={id:g.rt(M.videoId,"ytMainChannelEntity"),channelId:U.channelId,title:U.title,avatar:U.thumbnail};h={key:g.rt(M.videoId,"mainVideoDownloadStateEntity"),playbackData:g.rt(M.videoId,"playbackData"),addedTimestampMillis:P,videoDownloadContextEntity:g.rt(M.videoId,"videoDownloadContextEntity")};c={key:g.rt(M.videoId,"videoPlaybackPositionEntity"),videoId:M.videoId,lastPlaybackPositionSeconds:"0"};
w.P3.D("html5_offline_playback_position_sync")&&(Z={playbackPosition:c.key});S=g.rt(M.videoId,"mainVideoEntity");H={key:S,videoId:M.videoId,title:M.title,thumbnail:M.thumbnail,localizedStrings:{viewCount:M.shortViewCountText},userState:Z,lengthSeconds:M.lengthSeconds?Number(M.lengthSeconds):void 0,publishedTimestampMillis:M.publishedTimestamp?(Number(M.publishedTimestamp)*1E3).toString():void 0,formattedDescription:M.description,owner:f.id,downloadState:h.key};if(!w.P3.D("woffle_enable_main_downloads_library")||
!u){d.M0(2);break}return g.B(d,Nsc(w.B,[S]),3);case 3:if(E=d.B)p=E.mainDownloadsLibraryEntity,F=E.mainDownloadsListEntity;case 2:return q=PzU,y={key:g.rt(M.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.Lq(h,q,y),g.B(d,Ci(w.B,{mode:"readwrite",UF:!0},function(l){var e=gP(l,f,"ytMainChannelEntity"),R=gP(l,h,"mainVideoDownloadStateEntity"),I=gP(l,H,"mainVideoEntity");e=[e,R,I];w.P3.D("html5_offline_playback_position_sync")&&(R=gP(l,c,"videoPlaybackPositionEntity"),
e.push(R));p&&(R=gP(l,p,"mainDownloadsLibraryEntity"),e.push(R));F&&(R=gP(l,F,"mainDownloadsListEntity"),e.push(R));y&&(l=gP(l,y,"downloadStatusEntity"),e.push(l));return g.NZ.all(e)}),4);
case 4:return d.return({mainVideoEntity:H,channelEntity:f})}})},B1V=function(w,M,P){this.B=w;
this.P3=M;this.C=P},kyp=function(w,M){var P,u,X,U,f,h,c,Z,S,H,p,F,E,y,q,d,l,e,R,I,w4,t,$M,fz,U1,ZU,M_;
return g.n(function(Tp){switch(Tp.L){case 1:return P=hG(M),u=[],g.B(Tp,vq.getInstance(),2);case 2:X=Tp.B;if(!X){Tp.M0(3);break}return g.B(Tp,X.get("sdois"),4);case 4:return U=Tp.B,g.B(Tp,(h=X)==null?void 0:h.get("lmqf"),5);case 5:f=Tp.B;case 3:g.DU(Tp,6);if(U===void 0)throw Error("prefStorage or opt-in state is undefined");c=[];if(U){Tp.M0(8);break}return g.B(Tp,Eja(w.B),9);case 9:c=Tp.B,c.reverse();case 8:if(!c.length){Tp.M0(10);break}Z=g.G(c);S=Z.next();case 11:if(S.done){Tp.M0(10);break}H=S.value;
if(!H){Tp.M0(12);break}p=g.Jt(H).entityId;return g.B(Tp,qz(w.B,p),14);case 14:return F=Tp.B,F.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.B(Tp,yu(p,w.B,{entityKey:H,actionType:M.actionType},w.C,F),12);case 12:S=Z.next();Tp.M0(11);break;case 10:return g.B(Tp,kNt(U,(E=f)!=null?E:"SD"),16);case 16:return y=Tp.B,g.B(Tp,HZE(y),17);case 17:q=Fvh(y);if(!w.P3.D("woffle_enable_main_downloads_library")){Tp.M0(18);break}if(U){Tp.M0(19);break}return g.B(Tp,mMx(w.B,g.KT),19);case 19:return g.B(Tp,
V63(w.B,[g.KT]),18);case 18:if((d=q)==null?0:d.length)for(l=g.G(q),e=l.next();!e.done;e=l.next())if(I=R=e.value,w4=I.actionType,t=I.entityKey,$M=I.actionMetadata,w4&&t&&$M&&!g.A($M,QCj)){w4==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&($M.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(fz=g.A(R.actionMetadata,xZ))fz.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",R.actionMetadata=Object.assign({},R.actionMetadata,{mainVideoEntityActionMetadata:fz});u.push(R)}g.zp(Tp,
7);break;case 6:return U1=g.d4(Tp),ZU="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",M_="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",U1 instanceof g.cN&&U1.type==="QUOTA_EXCEEDED"&&(ZU="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",M_="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Tp.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",P,void 0,ZU,M_));case 7:return Tp.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P,u))}})},RuC=function(){jE.apply(this,
arguments);
this.S="mainVideoEntity"},nRC=function(w,M,P){M=M===void 0?43200:M;
P=P===void 0?!0:P;var u=u===void 0?!1:u;var X,U,f;return g.n(function(h){switch(h.L){case 1:if(!w.K.UH())return h.return([]);X=[];g.DU(h,2);return g.B(h,BsC(M,P,u),4);case 4:X=h.B;g.zp(h,3);break;case 2:U=g.d4(h),U instanceof Error&&U.message==="No data"||U instanceof Error&&U.message==="Empty response body"&&uf(U.message);case 3:return f=SNh(w,X,P,"mainPlaylistEntity"),h.return(f)}})},vRE=function(w,M,P,u){u=u===void 0?!1:u;
var X,U,f,h,c,Z,S,H,p,F,E,y,q,d,l;return g.n(function(e){switch(e.L){case 1:return X=[],g.B(e,QoA(),2);case 2:return(U=e.B)||u?g.B(e,R9C(M,P),3):e.return([]);case 3:f=e.B;if((h=f)==null||!h.length)return e.return([]);c={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};Z=g.G(f);S=Z.next();case 4:if(S.done){e.M0(6);break}p=H=S.value;F=p.actionType;E=p.entityKey;y=p.actionMetadata;if(!(F&&E&&y)||g.A(y,QCj)){e.M0(5);break}F==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(y.offlineLoggingData=
c);q=g.Jt(E);d=q.entityId;return g.B(e,Cv(w,[d],"mainVideoEntity",F,y),8);case 8:l=e.B,X=X.concat(l);case 5:S=Z.next();e.M0(4);break;case 6:return e.return(X)}})},sCE=function(w,M){this.B=w;
this.C=M},b_$=function(w,M){var P,u,X,U,f,h,c,Z,S,H,p,F,E,y,q,d;
return g.n(function(l){switch(l.L){case 1:return P=hG(M),u=g.Jt(M.entityKey),X=u.entityId,U=[],g.DU(l,2),g.B(l,KZE(w,X),4);case 4:U=l.B;if((f=U)==null||!f.length){l.M0(5);break}return g.B(l,qoV(w.B,M.entityKey),5);case 5:g.zp(l,3);break;case 2:return h=g.d4(l),c="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Z="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",h instanceof g.cN&&h.type==="QUOTA_EXCEEDED"&&(c="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Z="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
l.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",P,void 0,c,Z));case 3:return S=[],g.B(l,u13(w.B,"musicTrack",U),7);case 7:U=l.B;if(U.length)for(H=g.G(U),p=H.next();!p.done;p=H.next())if(F=p.value,E=F.offlineVideoData,y=void 0,(y=E)==null?0:y.videoId)q=void 0,d=Number(((q=M.actionMetadata)==null?void 0:q.priority)||0)+1,S.push(BK("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",E.videoId,"musicTrack",d,Ot,dl(M,E,X)));return l.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P,S))}})},
IW4=function(w,M){var P,u,X,U,f,h,c,Z,S,H,p,F,E,y,q,d,l,e,R,I,w4,t,$M,fz,U1,ZU,M_,Tp,kM,w3,sE,Vt,v5,OE,pC,g3,MK,T,nE,ep,P5,d3,D,i2,J5,fQ,KC,g4,O1,aK,vT,Y,m,z,Q,K,Su,J,O;
return g.n(function(k){switch(k.L){case 1:return P=hG(M),u=M.entityKey,X=g.Jt(u).entityId,U=[],f=!1,X==="!*$_ALL_ENTITIES_!*$"?(f=!0,g.B(k,Oi(w.B,"musicAlbumRelease"),5)):g.B(k,xU(w.B,u,"musicAlbumRelease"),4);case 4:(h=k.B)&&U.push(h);k.M0(3);break;case 5:U=k.B;case 3:if((c=U)==null||!c.length)return k.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P));if(f){Z=[];S=g.G(U);for(H=S.next();!H.done;H=S.next())p=H.value,F=g.Jt(p.id).entityId,Z.push(BK("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
F,"musicAlbumRelease",0,Ot));return k.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P,Z))}E=[];y=U[0];q=void 0;if(!y.downloadMetadata){k.M0(6);break}return g.B(k,xU(w.B,y.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:d=k.B,q=Number((e=(l=d)==null?void 0:l.addedTimestampMillis)!=null?e:"0")/1E3;case 6:return g.DU(k,8),g.B(k,KZE(w,X,(R=q)==null?void 0:R.toString()),10);case 10:E=k.B;g.zp(k,9);break;case 8:I=g.d4(k);if(!(I instanceof Error&&I.message==="No data")){if(I instanceof
Error&&I.message==="Empty response body")uf(I.message);else return w4="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",t="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",I instanceof g.cN&&I.type==="QUOTA_EXCEEDED"&&(w4="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",t="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),k.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",P,void 0,w4,t));k.M0(9);break}return g.B(k,zh(X,"musicAlbumRelease",w.B,M,w.C),9);case 9:$M=[];fz=
new Map;if((U1=E)==null?0:U1.length)for(ZU=g.G(E),M_=ZU.next();!M_.done;M_=ZU.next())Tp=M_.value,kM=Tp.offlineVideoData,w3=void 0,((w3=kM)==null?0:w3.videoId)&&fz.set(kM.videoId,kM);sE=new Map;Vt=[];if((v5=y)==null?0:(OE=v5.tracks)==null?0:OE.length)for(pC=g.G(y.tracks),g3=pC.next();!g3.done;g3=pC.next())if(MK=g3.value,T=g.Jt(MK).entityId)fz.has(T)?(sE.set(T,fz.get(T)),fz.delete(T)):Vt.push(T);ep=Number(((nE=M.actionMetadata)==null?void 0:nE.priority)||0)+1;P5=g.G(fz.entries());for(d3=P5.next();!d3.done;d3=
P5.next())D=d3.value,i2=g.G(D),J5=i2.next().value,fQ=i2.next().value,KC=J5,g4=fQ,$M.push(BK("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",KC,"musicTrack",ep,Ot,dl(M,g4)));O1=g.G(sE.entries());for(aK=O1.next();!aK.done;aK=O1.next())vT=aK.value,Y=g.G(vT),m=Y.next().value,z=Y.next().value,Q=m,K=z,$M.push(BK("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Q,"musicTrack",ep,Ot,dl(M,K)));Su=g.G(Vt);for(J=Su.next();!J.done;J=Su.next())O=J.value,$M.push(BK("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",O,"musicTrack",
0,Ot));return k.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P,$M))}})},A_3=function(w,M){var P,u;
return g.n(function(X){switch(X.L){case 1:return P=hG(M),g.DU(X,2),u=g.Jt(M.entityKey).entityId,u==="!*$_ALL_ENTITIES_!*$"?g.B(X,Th(w.B,M,w.C),5):g.B(X,zh(u,"musicAlbumRelease",w.B,M,w.C),6);case 6:return g.B(X,Yo$(w.B,M.entityKey),5);case 5:g.zp(X,3);break;case 2:return g.d4(X),X.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",P,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return X.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
P))}})},KZE=function(w,M,P){var u,X,U;
return g.n(function(f){switch(f.L){case 1:return g.B(f,LvA([M]),2);case 2:return u=f.B,g.B(f,gRc(w,u[0],P),3);case 3:return X=f.B,U=Et(X.thumbnailDetails),g.B(f,Gh(U),4);case 4:return f.return(u[0].videos)}})},gRc=function(w,M,P){var u,X,U,f,h,c,Z,S,H,p,F,E,y,q;
return g.n(function(d){if(d.L==1){u=M.additionalMetadadatas;X=void 0;if(u&&u.length>0)for(U=g.G(u),f=U.next();!f.done;f=U.next())if(h=f.value,h.offlineMusicPlaylistData){X=h.offlineMusicPlaylistData;break}c=M.playlistId;Z=z9E(M);S=Z.q9;H=Z.bl;p=P?(Number(P)*1E3).toString():Date.now().toString();F=M.lastModifiedTimestamp?(Number(M.lastModifiedTimestamp)*1E3).toString():"0";E={id:g.rt(c,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:H,lastModifiedTimestampMillis:F,addedTimestampMillis:p,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};y={id:g.rt(c,"musicAlbumRelease"),title:M.title,audioPlaylistId:c,trackCount:M.totalVideoCount,tracks:S,downloadMetadata:E.id};X&&(y.thumbnailDetails=(q=X.albumHqThumbnail)!=null?q:X.albumArtistThumbnail,y.artistDisplayName=X.albumArtistDisplayName,y.releaseDate=X.albumReleaseDate,y.contentRating={explicitType:X.albumReleaseExplicitType},y.releaseType=X.albumReleaseType);return g.B(d,Ci(w.B,{mode:"readwrite",UF:!0},function(l){var e=gP(l,y,"musicAlbumRelease");
l=gP(l,E,"musicAlbumReleaseDownloadMetadataEntity");return g.NZ.all([e,l])}),2)}return d.return(y)})},J_V=function(w,M){this.B=w;
this.C=M},jCE=function(w,M){var P,u,X,U,f,h,c,Z,S,H,p,F,E,y,q,d;
return g.n(function(l){switch(l.L){case 1:return P=hG(M),u=g.Jt(M.entityKey),X=u.entityId,U=[],g.DU(l,2),g.B(l,r_t(w,X),4);case 4:U=l.B;if((f=U)==null||!f.length){l.M0(5);break}return g.B(l,qoV(w.B,M.entityKey),5);case 5:g.zp(l,3);break;case 2:return h=g.d4(l),c="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Z="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",h instanceof g.cN&&h.type==="QUOTA_EXCEEDED"&&(c="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Z="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
l.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",P,void 0,c,Z));case 3:return S=[],g.B(l,u13(w.B,"musicTrack",U),7);case 7:U=l.B;if(U.length)for(H=g.G(U),p=H.next();!p.done;p=H.next())if(F=p.value,E=F.offlineVideoData,y=void 0,(y=E)==null?0:y.videoId)q=void 0,d=Number(((q=M.actionMetadata)==null?void 0:q.priority)||0)+1,S.push(BK("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",E.videoId,"musicTrack",d,aq,dl(M,E,X)));return l.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P,S))}})},
Cox=function(w,M){var P,u,X,U,f,h,c,Z,S,H,p,F,E,y,q,d,l,e,R,I,w4,t,$M,fz,U1,ZU,M_,Tp,kM,w3,sE,Vt,v5,OE,pC,g3,MK,T,nE,ep,P5,d3,D,i2,J5,fQ,KC,g4,O1,aK,vT,Y,m,z,Q,K,Su,J,O,k,eu,IF,W5,hx,l2,Gp,i6,qj,nC,YM,yy;
return g.n(function(Lz){switch(Lz.L){case 1:return P=hG(M),u=M.entityKey,X=g.Jt(u).entityId,U=[],f=!1,X==="!*$_ALL_ENTITIES_!*$"?(f=!0,g.B(Lz,Oi(w.B,"musicPlaylist"),5)):g.B(Lz,xU(w.B,u,"musicPlaylist"),4);case 4:(h=Lz.B)&&U.push(h);Lz.M0(3);break;case 5:U=Lz.B;case 3:if((c=U)==null||!c.length)return Lz.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P));Z=g.A(M.actionMetadata,TsC);H=(S=Z)==null?void 0:S.autoSync;p=[];E=F=!0;y=!1;q=void 0;if(!f&&H===!1){Lz.M0(6);break}g.DU(Lz,7);return g.B(Lz,
nj4(0,!!H,!0,U),9);case 9:p=Lz.B;g.zp(Lz,8);break;case 7:d=g.d4(Lz);if(!(d instanceof Error&&d.message==="No data")){d instanceof Error&&d.message==="Empty response body"&&uf(d.message);Lz.M0(8);break}return X==="!*$_ALL_ENTITIES_!*$"?g.B(Lz,Th(w.B,M,w.C),8):g.B(Lz,zh(X,"musicPlaylist",w.B,M,w.C),8);case 8:if(!p.length||!f&&p[0].playlistId!==X)return Lz.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P));case 6:if(f){l=[];e=g.G(p);for(R=e.next();!R.done;R=e.next())I=R.value,I.upToDate||
H&&!I.shouldAutoSyncMetadata||!I.playlistId||(w4={autoSync:H},l.push(BK("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",I.playlistId,"musicPlaylist",0,aq,{musicPlaylistEntityActionMetadata:w4})));return Lz.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P,l))}p.length&&(t=p[0],y=!!t.upToDate,H&&(F=($M=t.shouldAutoSyncMetadata)!=null?$M:!0,E=(fz=t.shouldAutoSyncVideos)!=null?fz:!0,t.checkInSeconds&&(q=t.checkInSeconds)));if(y||!F)return Lz.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
P));U1=[];ZU=U[0];M_=void 0;if(!ZU.downloadMetadata){Lz.M0(15);break}return g.B(Lz,xU(w.B,ZU.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:Tp=Lz.B,M_=Number((w3=(kM=Tp)==null?void 0:kM.addedTimestampMillis)!=null?w3:"0")/1E3;case 15:return g.DU(Lz,17),g.B(Lz,r_t(w,X,(sE=M_)==null?void 0:sE.toString(),q),19);case 19:U1=Lz.B;g.zp(Lz,18);break;case 17:Vt=g.d4(Lz);if(!(Vt instanceof Error&&Vt.message==="No data")){if(Vt instanceof Error&&Vt.message==="Empty response body")uf(Vt.message);
else return v5="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",OE="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Vt instanceof g.cN&&Vt.type==="QUOTA_EXCEEDED"&&(v5="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",OE="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Lz.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",P,void 0,v5,OE));Lz.M0(18);break}return g.B(Lz,zh(X,"musicPlaylist",w.B,M,w.C),18);case 18:if(!E)return Lz.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
P));pC=[];g3=new Map;if((MK=U1)==null?0:MK.length)for(T=g.G(U1),nE=T.next();!nE.done;nE=T.next())ep=nE.value,P5=ep.offlineVideoData,d3=void 0,((d3=P5)==null?0:d3.videoId)&&g3.set(P5.videoId,P5);D=new Map;i2=[];if((J5=ZU)==null?0:(fQ=J5.tracks)==null?0:fQ.length)for(KC=g.G(ZU.tracks),g4=KC.next();!g4.done;g4=KC.next())if(O1=g4.value,aK=g.Jt(O1).entityId)g3.has(aK)?(D.set(aK,g3.get(aK)),g3.delete(aK)):i2.push(aK);Y=Number(((vT=M.actionMetadata)==null?void 0:vT.priority)||0)+1;m=g.G(g3.entries());for(z=
m.next();!z.done;z=m.next())Q=z.value,K=g.G(Q),Su=K.next().value,J=K.next().value,O=Su,k=J,pC.push(BK("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",O,"musicTrack",Y,aq,dl(M,k)));eu=g.G(D.entries());for(IF=eu.next();!IF.done;IF=eu.next())W5=IF.value,hx=g.G(W5),l2=hx.next().value,Gp=hx.next().value,i6=l2,qj=Gp,pC.push(BK("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",i6,"musicTrack",Y,aq,dl(M,qj)));nC=g.G(i2);for(YM=nC.next();!YM.done;YM=nC.next())yy=YM.value,pC.push(BK("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
yy,"musicTrack",0,aq));return Lz.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P,pC))}})},tDA=function(w,M){var P,u;
return g.n(function(X){switch(X.L){case 1:return P=hG(M),g.DU(X,2),u=g.Jt(M.entityKey).entityId,u==="!*$_ALL_ENTITIES_!*$"?g.B(X,Th(w.B,M,w.C),5):g.B(X,zh(u,"musicPlaylist",w.B,M,w.C),6);case 6:return g.B(X,Yo$(w.B,M.entityKey),5);case 5:g.zp(X,3);break;case 2:return g.d4(X),X.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",P,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return X.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
P))}})},r_t=function(w,M,P,u){var X,U,f;
return g.n(function(h){switch(h.L){case 1:return g.B(h,LvA([M]),2);case 2:return X=h.B,g.B(h,xBE(w,X[0],P,u),3);case 3:return U=h.B,f=Et(U.thumbnailDetails),g.B(h,Gh(f),4);case 4:return h.return(X[0].videos)}})},xBE=function(w,M,P,u){var X,U,f,h,c,Z,S,H,p;
return g.n(function(F){return F.L==1?(X=M.playlistId,U=z9E(M),f=U.q9,h=U.bl,c=P?(Number(P)*1E3).toString():Date.now().toString(),Z=M.lastModifiedTimestamp?(Number(M.lastModifiedTimestamp)*1E3).toString():"0",S={id:g.rt(X,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:h,lastModifiedTimestampMillis:Z,addedTimestampMillis:c,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},H={id:g.rt(X,"musicPlaylist"),title:M.title,playlistId:X,thumbnailDetails:M.thumbnail,visibility:O_3(M),trackCount:M.totalVideoCount,
tracks:f,downloadMetadata:S.id},u&&(((p=H)==null?0:p.entityMetadata)?H.entityMetadata.nextAutoRefreshIntervalSeconds=String(u):H&&(H.entityMetadata={nextAutoRefreshIntervalSeconds:String(u)})),g.B(F,Ci(w.B,{mode:"readwrite",UF:!0},function(E){var y=gP(E,H,"musicPlaylist");E=gP(E,S,"musicPlaylistDownloadMetadataEntity");return g.NZ.all([y,E])}),2)):F.return(H)})},O_3=function(w){switch(w.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},aW3=function(w,M){this.B=w;
this.C=M},PUx=function(w,M){var P,u,X,U,f,h,c,Z,S,H,p,F,E;
return g.n(function(y){switch(y.L){case 1:return P=hG(M),u=g.Jt(M.entityKey),X=u.entityId,U=g.A(M.actionMetadata,wiV),g.DU(y,2),g.B(y,iRa(w,X,void 0,(f=U)==null?void 0:f.track,(h=U)==null?void 0:h.albumRelease),4);case 4:if((c=U)==null?0:c.playlistId){y.M0(5);break}return g.B(y,qoV(w.B,M.entityKey),5);case 5:g.zp(y,3);break;case 2:return Z=g.d4(y),S="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",H="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Z instanceof g.cN&&Z.type==="QUOTA_EXCEEDED"&&
(S="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",H="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),y.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",P,void 0,S,H));case 3:F=Number(((p=M.actionMetadata)==null?void 0:p.priority)||0)+1;var q=(q=g.A(M.actionMetadata,wiV))?{playbackDataActionMetadata:{maximumDownloadQuality:q.maximumDownloadQuality}}:void 0;E=BK("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",X,"playbackData",F,M2U,q);return y.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
P,[E]))}})},uqC=function(w,M){var P,u,X,U,f,h,c,Z,S,H,p,F,E,y,q;
return g.n(function(d){switch(d.L){case 1:return P=hG(M),u=g.Jt(M.entityKey),X=u.entityId,g.B(d,xU(w.B,M.entityKey,"musicTrack"),2);case 2:U=d.B;if(!U){f=void 0;d.M0(3);break}return g.B(d,xU(w.B,U.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:f=d.B;case 3:h=f;if(!U||!h)return d.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P));Z=g.A(M.actionMetadata,wiV);g.DU(d,5);return g.B(d,iRa(w,X,h.addedTimestampMillis,(S=Z)==null?void 0:S.track,(H=Z)==null?void 0:H.albumRelease),
7);case 7:F=Number(((p=M.actionMetadata)==null?void 0:p.priority)||0)+1;c=BK("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",X,"playbackData",F,M2U);g.zp(d,6);break;case 5:E=g.d4(d);if(!(E instanceof Error&&E.message==="No data")){if(E instanceof Error&&E.message==="Empty response body")uf(E.message);else return y="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",q="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",E instanceof g.cN&&E.type==="QUOTA_EXCEEDED"&&(y="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
q="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),d.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",P,void 0,y,q));d.M0(6);break}return g.B(d,YZ(X,w.B,M,w.C),6);case 6:return d.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P,c?[c]:void 0))}})},Xix=function(w,M){var P,u;
return g.n(function(X){switch(X.L){case 1:return P=hG(M),g.DU(X,2),u=g.Jt(M.entityKey).entityId,u==="!*$_ALL_ENTITIES_!*$"?g.B(X,Th(w.B,M,w.C),5):g.B(X,YZ(u,w.B,M,w.C),6);case 6:return g.B(X,Yo$(w.B,M.entityKey),5);case 5:g.zp(X,3);break;case 2:return g.d4(X),X.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",P,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return X.return(new Qu("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
P))}})},iRa=function(w,M,P,u,X){var U,f,h,c,Z,S;
return g.n(function(H){switch(H.L){case 1:if(U=u){H.M0(2);break}return g.B(H,lia([M]),3);case 3:f=H.B,h=f[0],U=DM3(h);case 2:return g.B(H,$Tc(w,U,M,X,P),4);case 4:c=H.B;Z=c.musicTrackEntity;S=c.j6;var p=Et(Z.thumbnailDetails),F=[];S&&(F=Et(S.thumbnailDetails));return g.B(H,Gh(p.concat(F)),0)}})},$Tc=function(w,M,P,u,X){var U;
return g.n(function(f){return f.L==1?(X||(X=Date.now().toString()),U={id:g.rt(P,"musicTrackDownloadMetadataEntity"),playbackData:g.rt(P,"playbackData"),addedTimestampMillis:X,videoDownloadContextEntity:g.rt(P,"videoDownloadContextEntity")},u&&(M.albumRelease=u.id),g.B(f,Ci(w.B,{mode:"readwrite",UF:!0},function(h){var c=[],Z=gP(h,U,"musicTrackDownloadMetadataEntity");c.push(Z);Z=gP(h,M,"musicTrack");c.push(Z);u&&(h=gP(h,u,"musicAlbumRelease"),c.push(h));return g.NZ.all(c)}),2)):f.L!=3?g.B(f,HK(P,"musicTrackDownloadMetadataEntity",
w.B,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):f.return({musicTrackEntity:M,
j6:u})})},wF=function(){jE.apply(this,arguments);
this.S="musicTrack"},UTE=function(w,M,P){M=M===void 0?43200:M;
P=P===void 0?!0:P;var u=u===void 0?!1:u;var X,U;return g.n(function(f){switch(f.L){case 1:if(!w.K.UH())return f.return([]);X=[];g.DU(f,2);return g.B(f,nj4(M,P,u),4);case 4:X=f.B;g.zp(f,3);break;case 2:g.d4(f);case 3:return U=SNh(w,X,P,"musicPlaylist"),f.return(U)}})},fYE=function(){g.D0.apply(this,arguments);
var w=this;this.events=new g.V2(this);this.P3=this.player.N();this.yH={cek:function(){return w.B},
Yn:function(){return w.Yn()},
K4:function(M){return w.K4(M)}}},WbA=function(w){var M;
w=g.A((M=w.getWatchNextResponse())==null?void 0:M.currentVideoEndpoint,g.c7);if(w==null?0:w.playlistId)var P=w.playlistId;return P},h$U=function(w,M){var P,u,X,U;
return g.n(function(f){if(f.L==1){P=M.clientPlaybackNonce;u={cpn:P,offlineSourceVisualElement:g.Hm(M.UO||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};M.L&&(u.videoFmt=Number(M.L.itag));M.X&&(u.audioFmt=Number(M.X.itag));if((X=WbA(M))&&M.videoId){var h=M.videoId;h=X!=="PPSV"?Promise.resolve(!1):w.B.hO(h);f=g.B(f,h,3)}else f=f.M0(2);return f}f.L!=2&&(U=f.B)&&(u.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");w.L=P;g.ub("offlinePlaybackStarted",u);g.yx(f)})};
g.BV.prototype.oy=g.Xl(45,function(w){return this.app.oy(w)});
g.op.prototype.oy=g.Xl(44,function(w){return g.GAy(this,9,w)});
g.V(R2,kU);g.hH.Object.defineProperties(R2.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.B.entityMetadata},
set:function(w){this.B.entityMetadata=w}}});
g.V(whp,R2);whp.prototype.L=function(){return[]};
g.V(ih$,R2);ih$.prototype.L=function(){return[]};
g.V(MVE,R2);MVE.prototype.L=function(){return[]};
g.V(Pmp,R2);Pmp.prototype.L=function(){return[]};
g.V(uap,R2);uap.prototype.L=function(){var w=[];this.B.alternateChannel&&w.push(this.B.alternateChannel);this.B.alternateChannelList&&w.push.apply(w,g.L(this.B.alternateChannelList));this.B.oneofChannelEntity&&w.push(this.B.oneofChannelEntity);return[].concat(g.L(new Set(w)))};
g.V(XhU,R2);XhU.prototype.L=function(){var w=[];this.B.entryCollection&&w.push(this.B.entryCollection);return[].concat(g.L(new Set(w)))};
g.V($P3,kU);$P3.prototype.L=function(){var w=[];this.B.video&&w.push(this.B.video);return[].concat(g.L(new Set(w)))};
g.V(UPa,R2);UPa.prototype.L=function(){var w=[];this.B.parentPlaylist&&w.push(this.B.parentPlaylist);if(this.B.entries)for(var M=g.G(this.B.entries),P=M.next();!P.done;P=M.next())w.push.apply(w,g.L((new $P3(P.value)).L()));return[].concat(g.L(new Set(w)))};
g.V(fxE,R2);fxE.prototype.L=function(){var w=[];this.B.descriptionEntity&&w.push(this.B.descriptionEntity);this.B.creators&&w.push.apply(w,g.L(this.B.creators));this.B.theBiggestFan&&w.push(this.B.theBiggestFan);return[].concat(g.L(new Set(w)))};
g.V(WQ4,R2);WQ4.prototype.L=function(){return[]};
g.V(hOC,R2);hOC.prototype.L=function(){return[]};
g.V(c0c,R2);c0c.prototype.L=function(){return[]};
g.V(ZhC,R2);ZhC.prototype.L=function(){return[]};
g.V(Sva,R2);Sva.prototype.L=function(){return[]};
g.V(HhE,R2);HhE.prototype.L=function(){return[]};
g.V(phC,R2);phC.prototype.L=function(){return[]};
g.V(FQc,R2);FQc.prototype.L=function(){return[]};
g.V(EXE,R2);EXE.prototype.L=function(){return[]};
g.V(NTC,R2);NTC.prototype.L=function(){var w=[];this.B.downloadsList&&w.push(this.B.downloadsList);this.B.smartDownloadsList&&w.push(this.B.smartDownloadsList);this.B.recommendedDownloadsList&&w.push(this.B.recommendedDownloadsList);this.B.refresh&&w.push(this.B.refresh);return[].concat(g.L(new Set(w)))};
g.V(VVE,kU);VVE.prototype.L=function(){var w=[];this.B.video&&w.push(this.B.video);this.B.playlist&&w.push(this.B.playlist);this.B.videoItem&&w.push(this.B.videoItem);this.B.playlistItem&&w.push(this.B.playlistItem);return[].concat(g.L(new Set(w)))};
g.V(mPV,R2);mPV.prototype.L=function(){var w=[];this.B.refresh&&w.push(this.B.refresh);if(this.B.downloads)for(var M=g.G(this.B.downloads),P=M.next();!P.done;P=M.next())w.push.apply(w,g.L((new VVE(P.value)).L()));return[].concat(g.L(new Set(w)))};
g.V(oXE,R2);oXE.prototype.L=function(){var w=[];this.B.localImageEntities&&w.push.apply(w,g.L(this.B.localImageEntities));return[].concat(g.L(new Set(w)))};
g.V(GF$,R2);GF$.prototype.L=function(){var w=[];this.B.playbackData&&w.push(this.B.playbackData);this.B.localImageEntities&&w.push.apply(w,g.L(this.B.localImageEntities));this.B.videoDownloadContextEntity&&w.push(this.B.videoDownloadContextEntity);return[].concat(g.L(new Set(w)))};
g.V(y0E,R2);y0E.prototype.L=function(){return[]};
g.V(DP4,R2);DP4.prototype.L=function(){var w=[];this.B.fakeChildren&&w.push.apply(w,g.L(this.B.fakeChildren));return[].concat(g.L(new Set(w)))};
g.V(qv$,R2);qv$.prototype.L=function(){var w=[];this.B.video&&w.push(this.B.video);this.B.playbackData&&w.push(this.B.playbackData);this.B.offlineVideoPolicy&&w.push(this.B.offlineVideoPolicy);return[].concat(g.L(new Set(w)))};
g.V(YvC,R2);YvC.prototype.L=function(){return[]};
g.V(zOE,R2);zOE.prototype.L=function(){var w=[];this.B.channelOwner&&w.push(this.B.channelOwner);this.B.videos&&w.push.apply(w,g.L(this.B.videos));this.B.collaboratorChannels&&w.push.apply(w,g.L(this.B.collaboratorChannels));this.B.downloadState&&w.push(this.B.downloadState);this.B.refresh&&w.push(this.B.refresh);return[].concat(g.L(new Set(w)))};
g.V(TT3,R2);TT3.prototype.L=function(){var w=[];this.B.video&&w.push(this.B.video);this.B.channelContributor&&w.push(this.B.channelContributor);return[].concat(g.L(new Set(w)))};
g.V(dPh,kU);dPh.prototype.L=function(){var w=[];this.B.localImageEntities&&w.push.apply(w,g.L(this.B.localImageEntities));this.B.videoDownloadContextEntity&&w.push(this.B.videoDownloadContextEntity);return[].concat(g.L(new Set(w)))};
g.V(lxt,kU);lxt.prototype.L=function(){var w=[];this.B.recommendedVideoMetadata&&w.push.apply(w,g.L((new dPh(this.B.recommendedVideoMetadata)).L()));return[].concat(g.L(new Set(w)))};
g.V(LQV,kU);LQV.prototype.L=function(){var w=[];this.B.playbackPosition&&w.push(this.B.playbackPosition);return[].concat(g.L(new Set(w)))};
g.V(eO3,R2);eO3.prototype.L=function(){var w=[];this.B.owner&&w.push(this.B.owner);this.B.downloadState&&w.push(this.B.downloadState);this.B.userState&&w.push.apply(w,g.L((new LQV(this.B.userState)).L()));this.B.additionalMetadata&&w.push.apply(w,g.L((new lxt(this.B.additionalMetadata)).L()));return[].concat(g.L(new Set(w)))};
g.V(BTC,R2);BTC.prototype.L=function(){var w=[];this.B.userChannelDetails&&w.push(this.B.userChannelDetails);return[].concat(g.L(new Set(w)))};
g.V(QLx,R2);QLx.prototype.L=function(){var w=[];this.B.channelOwner&&w.push(this.B.channelOwner);this.B.playbackPosition&&w.push(this.B.playbackPosition);this.B.localImageEntities&&w.push.apply(w,g.L(this.B.localImageEntities));this.B.downloadStatus&&w.push(this.B.downloadStatus);return[].concat(g.L(new Set(w)))};
g.V(kFE,R2);kFE.prototype.L=function(){return[]};
g.V(RO4,R2);RO4.prototype.L=function(){return[]};
g.V(nX$,R2);nX$.prototype.L=function(){return[]};
g.V(vXt,R2);vXt.prototype.L=function(){return[]};
g.V(sLc,R2);sLc.prototype.L=function(){return[]};
g.V(KQV,R2);KQV.prototype.L=function(){return[]};
g.V(bh4,R2);bh4.prototype.L=function(){return[]};
g.V(IxV,R2);IxV.prototype.L=function(){return[]};
g.V(A0t,R2);A0t.prototype.L=function(){return[]};
g.V(gXp,R2);gXp.prototype.L=function(){return[]};
g.V(J0$,R2);J0$.prototype.L=function(){return[]};
g.V(r0V,R2);r0V.prototype.L=function(){return[]};
g.V(jLt,R2);jLt.prototype.L=function(){var w=[];this.B.trackDownloadMetadatas&&w.push.apply(w,g.L(this.B.trackDownloadMetadatas));return[].concat(g.L(new Set(w)))};
g.V(Cmj,R2);
Cmj.prototype.L=function(){var w=[];this.B.downloadedTracks&&w.push.apply(w,g.L(this.B.downloadedTracks));this.B.smartDownloadedTracks&&w.push.apply(w,g.L(this.B.smartDownloadedTracks));this.B.downloadedEpisodes&&w.push.apply(w,g.L(this.B.downloadedEpisodes));this.B.downloadedAlbumReleases&&w.push.apply(w,g.L(this.B.downloadedAlbumReleases));this.B.smartDownloadedAlbumReleases&&w.push.apply(w,g.L(this.B.smartDownloadedAlbumReleases));this.B.downloadedPlaylists&&w.push.apply(w,g.L(this.B.downloadedPlaylists));this.B.smartDownloadedPlaylists&&
w.push.apply(w,g.L(this.B.smartDownloadedPlaylists));this.B.metadataOnlyTracks&&w.push.apply(w,g.L(this.B.metadataOnlyTracks));return[].concat(g.L(new Set(w)))};
g.V(tVA,R2);tVA.prototype.L=function(){var w=[];this.B.trackDownloadMetadatas&&w.push.apply(w,g.L(this.B.trackDownloadMetadatas));return[].concat(g.L(new Set(w)))};
g.V(xPV,R2);xPV.prototype.L=function(){var w=[];this.B.playbackData&&w.push(this.B.playbackData);this.B.localImageEntities&&w.push.apply(w,g.L(this.B.localImageEntities));this.B.videoDownloadContextEntity&&w.push(this.B.videoDownloadContextEntity);return[].concat(g.L(new Set(w)))};
g.V(Oh3,R2);Oh3.prototype.L=function(){var w=[];this.B.musicLibraryStatusEntity&&w.push(this.B.musicLibraryStatusEntity);this.B.primaryArtists&&w.push.apply(w,g.L(this.B.primaryArtists));this.B.details&&w.push(this.B.details);this.B.userDetails&&w.push(this.B.userDetails);this.B.tracks&&w.push.apply(w,g.L(this.B.tracks));this.B.share&&w.push(this.B.share);this.B.downloadMetadata&&w.push(this.B.downloadMetadata);this.B.refresh&&w.push(this.B.refresh);return[].concat(g.L(new Set(w)))};
g.V(axt,R2);axt.prototype.L=function(){var w=[];this.B.albumRelease&&w.push(this.B.albumRelease);this.B.tracks&&w.push.apply(w,g.L(this.B.tracks));return[].concat(g.L(new Set(w)))};
g.V(wWt,R2);wWt.prototype.L=function(){var w=[];this.B.albumRelease&&w.push(this.B.albumRelease);return[].concat(g.L(new Set(w)))};
g.V(iLh,R2);iLh.prototype.L=function(){var w=[];this.B.details&&w.push(this.B.details);this.B.userDetails&&w.push(this.B.userDetails);return[].concat(g.L(new Set(w)))};
g.V(Mm$,R2);Mm$.prototype.L=function(){var w=[];this.B.parentArtist&&w.push(this.B.parentArtist);return[].concat(g.L(new Set(w)))};
g.V(PYp,R2);PYp.prototype.L=function(){var w=[];this.B.parentArtist&&w.push(this.B.parentArtist);return[].concat(g.L(new Set(w)))};
g.V(uHA,R2);uHA.prototype.L=function(){return[]};
g.V(XWt,R2);XWt.prototype.L=function(){return[]};
g.V($2x,kU);$2x.prototype.L=function(){var w=[];this.B.creatorEntity&&w.push(this.B.creatorEntity);return[].concat(g.L(new Set(w)))};
g.V(U2j,R2);
U2j.prototype.L=function(){var w=[];this.B.tracks&&w.push.apply(w,g.L(this.B.tracks));this.B.refresh&&w.push(this.B.refresh);this.B.musicLibraryStatusEntity&&w.push(this.B.musicLibraryStatusEntity);this.B.details&&w.push(this.B.details);this.B.downloadMetadata&&w.push(this.B.downloadMetadata);this.B.sideloadMetadata&&w.push(this.B.sideloadMetadata);this.B.userDetails&&w.push(this.B.userDetails);this.B.entryCollection&&w.push(this.B.entryCollection);this.B.share&&w.push(this.B.share);this.B.podcastShowAdditionalMetadata&&w.push.apply(w,
g.L((new $2x(this.B.podcastShowAdditionalMetadata)).L()));return[].concat(g.L(new Set(w)))};
g.V(fHc,R2);fHc.prototype.L=function(){return[]};
g.V(WlC,R2);
WlC.prototype.L=function(){var w=[];this.B.musicLibraryStatusEntity&&w.push(this.B.musicLibraryStatusEntity);this.B.artists&&w.push.apply(w,g.L(this.B.artists));this.B.audioModeVersion&&w.push(this.B.audioModeVersion);this.B.videoModeVersion&&w.push(this.B.videoModeVersion);this.B.userDetails&&w.push(this.B.userDetails);this.B.details&&w.push(this.B.details);this.B.albumRelease&&w.push(this.B.albumRelease);this.B.share&&w.push(this.B.share);this.B.libraryEdit&&w.push(this.B.libraryEdit);this.B.downloadMetadata&&
w.push(this.B.downloadMetadata);this.B.playbackPosition&&w.push(this.B.playbackPosition);this.B.lyrics&&w.push(this.B.lyrics);return[].concat(g.L(new Set(w)))};
g.V(hqE,R2);hqE.prototype.L=function(){var w=[];this.B.parentTrack&&w.push(this.B.parentTrack);return[].concat(g.L(new Set(w)))};
g.V(cmc,R2);cmc.prototype.L=function(){var w=[];this.B.parentTrack&&w.push(this.B.parentTrack);return[].concat(g.L(new Set(w)))};
g.V(ZL3,R2);ZL3.prototype.L=function(){return[]};
g.V(SJa,R2);SJa.prototype.L=function(){return[]};
g.V(HLE,R2);HLE.prototype.L=function(){return[]};
g.V(pWA,R2);pWA.prototype.L=function(){return[]};
g.V(Flh,R2);Flh.prototype.L=function(){var w=[];this.B.transfer&&w.push(this.B.transfer);this.B.adsPlaybackData&&w.push.apply(w,g.L(this.B.adsPlaybackData));this.B.drmLicense&&w.push(this.B.drmLicense);this.B.offlineVideoPolicy&&w.push(this.B.offlineVideoPolicy);this.B.videoDownloadContextEntity&&w.push(this.B.videoDownloadContextEntity);return[].concat(g.L(new Set(w)))};
g.V(E4c,R2);E4c.prototype.L=function(){return[]};
g.V(Nnx,R2);Nnx.prototype.L=function(){var w=[];this.B.offlineVideoStreams&&w.push.apply(w,g.L(this.B.offlineVideoStreams));this.B.captionTrack&&w.push.apply(w,g.L(this.B.captionTrack));return[].concat(g.L(new Set(w)))};
g.V(VmC,R2);VmC.prototype.L=function(){return[]};
g.V(m2j,R2);m2j.prototype.L=function(){return[]};
g.V(o4U,R2);o4U.prototype.L=function(){return[]};
g.V(GKC,R2);GKC.prototype.L=function(){return[]};
g.V(ymj,R2);ymj.prototype.L=function(){return[]};
g.V(D2a,R2);D2a.prototype.L=function(){return[]};
g.V(qJV,R2);qJV.prototype.L=function(){return[]};
g.V(YJc,R2);YJc.prototype.L=function(){return[]};
g.V(zqE,R2);zqE.prototype.L=function(){return[]};
g.V(Tnj,R2);Tnj.prototype.L=function(){return[]};
g.V(d2E,R2);d2E.prototype.L=function(){return[]};
g.V(lHE,R2);lHE.prototype.L=function(){return[]};
g.V(LlV,R2);LlV.prototype.L=function(){return[]};
g.V(eq4,R2);eq4.prototype.L=function(){return[]};
g.V(BnV,R2);BnV.prototype.L=function(){return[]};
g.V(Qut,R2);Qut.prototype.L=function(){return[]};
g.V(kKh,R2);kKh.prototype.L=function(){return[]};
g.V(RqV,R2);RqV.prototype.L=function(){return[]};
g.V(n4C,R2);n4C.prototype.L=function(){return[]};
g.V(v4h,R2);v4h.prototype.L=function(){return[]};
g.V(su$,R2);su$.prototype.L=function(){return[]};
var vjE=["browse","music/browse","unplugged/browse"],ACp=["offline/playlist_sync_check"],dMC=["offline"],soc=["offline/offline_video_playback_position_sync"],bZE=["offline/get_playback_data_entity"],ni;vq.getInstance=function(){return g.n(function(w){return w.return(new Promise(function(M){g.rK().then(function(P){P?(vq.instance||(vq.instance=new vq(P)),M(vq.instance)):M(void 0)})}))})};
vq.prototype.get=function(w){var M=this,P,u,X;return g.n(function(U){if(U.L==1)return g.B(U,AmC(M.token),2);if(U.L!=3)return P=U.B,g.B(U,P.get("prefs",w),3);u=U.B;if(!u)return U.return();X=(0,g.G$)();return u.expirationTimestampMs<=X?U.return():U.return(u.value)})};
vq.prototype.set=function(w,M,P){P=P===void 0?31536E3:P;var u=this,X,U,f;return g.n(function(h){if(h.L==1)return X=(0,g.G$)(),U={key:w,value:M,expirationTimestampMs:X+P*1E3},g.B(h,AmC(u.token),2);f=h.B;return g.B(h,g.T$(f,"prefs",U),0)})};
vq.prototype.remove=function(w){var M=this,P;return g.n(function(u){if(u.L==1)return g.B(u,AmC(M.token),2);P=u.B;return g.B(u,P.delete("prefs",w),0)})};
g.V(si,g.bK);g.V(Ki,CYx);Ki.prototype.C=function(w,M){M=x2E(M);w=(new TextEncoder).encode(JSON.stringify(w));return this.B.encrypt(w,M)};
Ki.prototype.L=function(w,M){if(!(w instanceof Uint8Array))throw g4t(1);var P=new TextDecoder;M=x2E(M);w=this.B.decrypt(w,M);return JSON.parse(P.decode(w))};
var OLC={accountLinkStatusEntity:c0c,booleanEntity:MVE,buttonEntity:eq4,captionTrack:ZL3,channelHandle:whp,chipEntity:qJV,commerceAcquisitionClientPayloadEntity:Qut,commerceCartListEntity:kKh,contextNoteFeedEntityPayload:ih$,continuationTokenEntity:YvC,downloadQualityPickerEntity:phC,downloadsPageRefreshTokenEntity:EXE,downloadsPageViewConfigurationEntity:kFE,downloadStatusEntity:FQc,dismissState:YJc,sfvAudioItemCurrentlyPlayingEntity:GKC,emojiFountainDataEntity:lHE,emojiCustomizationSetEntity:d2E,
fakeChannel:uap,fakePlaylist:XhU,fakePlaylistEntryCollection:UPa,fakeVideo:fxE,fakeVideoDescription:WQ4,featuredProductsEntity:gXp,flowStateEntity:hOC,iconBadgeEntity:RqV,interstitialInteractionStateEntity:Sva,likeButtonAnimationEntity:RO4,liveChatPollStateEntity:HhE,liveViewerLeaderboardChatEntryPointStateEntity:m2j,liveViewerLeaderboardPointsEntity:o4U,liveReactionsDataEntity:LlV,logoEntity:ZhC,macroMarkerEntity:nX$,mainDownloadsLibraryEntity:NTC,mainDownloadsListEntity:mPV,mainPlaylistDownloadStateEntity:oXE,
mainPlaylistEntity:zOE,mainPlaylistVideoEntity:TT3,mainVideoDownloadStateEntity:GF$,mainVideoEntity:eO3,markersEngagementPanelSyncEntity:vXt,markersVisibilityOverrideEntity:sLc,musicAlbumReleaseDetail:axt,musicAlbumReleaseDownloadMetadataEntity:jLt,musicAlbumRelease:Oh3,musicAlbumReleaseUserDetail:wWt,musicArtistDetail:Mm$,musicArtist:iLh,musicArtistUserDetail:PYp,musicDownloadsLibraryEntity:Cmj,musicLibraryEdit:uHA,musicLibraryStatusEntity:XWt,musicPlaylist:U2j,musicPlaylistDownloadMetadataEntity:tVA,
musicShare:fHc,musicTrackDetail:hqE,musicTrackDownloadMetadataEntity:xPV,musicTrack:WlC,musicTrackUserDetail:cmc,offlineOrchestrationActionWrapperEntity:SJa,offlineVideoPolicy:HLE,offlineVideoStreams:pWA,offlineabilityEntity:y0E,orchestrationWebSamplingEntity:DP4,pageHeaderEntity:zqE,pdpStateEntity:n4C,pinnedProductEntity:J0$,playbackData:Flh,playerStateEntity:KQV,quantityIncrementerEntity:v4h,refresh:E4c,saveToPlaylistListEntity:ymj,selectedChipIndexEntityPayload:bh4,settingEntity:D2a,stringEntity:Pmp,
suggestedFeedbackChipStateEntity:IxV,transfer:Nnx,trendingOfferEntity:r0V,videoDownloadContextEntity:VmC,videoOverviewAsyncDataEntity:su$,videoPlaybackPositionEntity:BnV,votingEntity:Tnj,ytMainChannelEntity:BTC,youchatPendingResponseEntity:A0t,ytMainDownloadedVideoEntity:qv$,ytMainVideoEntity:QLx};g.V(rP,CYx);rP.prototype.C=function(w){return w};
rP.prototype.L=function(w){if(w instanceof Uint8Array)throw g4t(0);return w};
g.V(js,g.v);js.prototype.observe=function(w){var M=this;this.observers.push(w);return function(){var P=M.observers.indexOf(w);P>=0&&M.observers.splice(P,1)}};
js.prototype.L=function(w){ZyU(this,w.data)};
js.prototype.v3=function(){this.channel.close()};
var Ev$,p_3=new g.og("elementsCommand");var DF=new g.og("entityBatchUpdate");var PzU=new g.og("downloadStatusEntity");var VDA=new g.og("mainPlaylistEntityActionMetadata");var xZ=new g.og("mainVideoEntityActionMetadata");var TsC=new g.og("musicPlaylistEntityActionMetadata");var wiV=new g.og("musicTrackEntityActionMetadata");var QCj=new g.og("localImageEntityActionMetadata");var kZ=new g.og("playbackDataActionMetadata");var FK$=new g.og("transferEntityActionMetadata");var ibp=new g.og("videoPlaybackPositionEntityActionMetadata");var eBC;new g.hC;new g.hC;nvV.prototype.request=function(w,M,P){M=M===void 0?{}:M;return this.locks.request(w,M,function(u){return P(u)})};var PK=g.aF.caches,Mz,IGE;wl.prototype.open=function(w){return PK.open(Kq3(w))};
wl.prototype.has=function(w){return PK.has(Kq3(w))};
wl.prototype.delete=function(w){return PK.delete(Kq3(w))};
wl.prototype.match=function(w,M){var P=this,u,X,U,f,h,c;return g.n(function(Z){switch(Z.L){case 1:return g.B(Z,P.keys(),2);case 2:u=Z.B,X=g.G(u),U=X.next();case 3:if(U.done){Z.M0(5);break}f=U.value;return g.B(Z,P.open(f),6);case 6:return h=Z.B,g.B(Z,h.match(w,M),7);case 7:if(c=Z.B)return Z.return(c);U=X.next();Z.M0(3);break;case 5:return Z.return()}})};
g.V(sVa,wl);sVa.prototype.keys=function(){var w,M,P,u,X,U,f,h,c;return g.n(function(Z){if(Z.L==1)return w=[],M=g.IS("CacheStorage keys"),g.B(Z,PK.keys(),2);P=Z.B;u=g.G(P);for(X=u.next();!X.done;X=u.next()){U=X.value;var S=U.indexOf(":");f=S===-1?{pY:U}:{pY:U.substring(0,S),datasyncId:U.substring(S+1)};h=f.pY;c=f.datasyncId;c===M&&w.push(h)}return Z.return(w)})};g.V(Xe,g.v);Xe.prototype.C=function(w){this.api.Vs("onOfflineOperationFailure",w.data)};
Xe.prototype.X=function(w){this.api.publish("offlinetransferpause",w.data)};
Xe.prototype.v3=function(){var w;(w=this.B)==null||w.close();var M;(M=this.L)==null||M.close()};JnU.prototype.fV=function(){this.B&&Ut(this)};
JnU.prototype.T8=function(){this.L&&this.L.resolve();this.C=this.B=!1;this.S()};var eTE=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var ZZ3="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var yCE="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.V(JCE,eE);JCE.prototype.L=function(w){return cK(w)?Cza(this,w):ZF(w)?OZt(this,w):Promise.reject(Error("Unsupported action type: "+w.actionType))};g.V(aiA,eE);aiA.prototype.L=function(w){return ZF(w)?wG4(this,w):M6p(w)?Mrj(this,w):SE(w)?Pc3(this,w):Promise.reject(Error("Unsupported action type: "+w.actionType))};g.N=uyj.prototype;g.N.A9N=function(w){var M=this,P,u,X,U;return g.n(function(f){if(!g.C(w.state,128))return f.M0(0);P=w.state.tV;var h=(u=P)==null?void 0:u.errorCode,c=(X=P)==null?void 0:X.nQ;U=h==="net.connect"&&c===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(h==null?0:h.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.B(f,M.G9(M.player.getVideoData().videoId,U),0)})};
g.N.G9=function(w,M){var P=this;return g.n(function(u){if(u.L==1){if(P.L)return u.return();P.L=!0;return M==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(vK(P,w,!1,!0),u.M0(0)):g.B(u,nv(P,w),3)}g.AW(w,4);return g.B(u,P.B.G9(M),0)})};
g.N.bD=function(w){w.status===2?(w.status!==this.C&&(wI4(this.B),g.AW(w.videoId,2)),w.x5&&XIa(this.B,w.videoId,w.x5)):w.status===4?(nv(this,w.videoId),this.G9(w.videoId,w.uU?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):w.status===1&&u6U(this.B);this.C=w.status;this.api.Vs("localmediachange",{videoId:w.videoId,status:w.status})};
g.N.MC=function(){var w=this,M;return g.n(function(P){if(P.L==1){if(w.L)return P.return();w.L=!0;M=w.player.getVideoData().videoId;return g.B(P,nv(w,M),2)}return g.B(P,w.B.MC(),0)})};
g.N.TR=function(w){switch(w){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.N.D=function(w){return this.api.N().D(w)};g.V(cKA,eE);cKA.prototype.L=function(w){return cK(w)?SRC(this,w):ZF(w)?HbU(this,w):M6p(w)?pG4(this,w):Promise.reject(Error("Unsupported action type: "+w.actionType))};oOh.prototype.B=function(w,M){var P=w.action.actionMetadata.priority-M.action.actionMetadata.priority;P===0&&(w.B<M.B?P=-1:w.B>M.B&&(P=1));return P};g.V(Kv,g.v);Kv.prototype.v3=function(){this.S&&this.S();g.v.prototype.v3.call(this)};
Kv.prototype.createAction=function(w,M){var P=g.Jt(w.entityKey).entityType,u=g.Hl(16);return new Nz(P,u,w,M.actionId,M.rootActionId)};
Kv.prototype.Lu=function(w){var M=this,P,u,X,U,f,h,c,Z,S;return g.n(function(H){if(H.L==1){if(M.sO())return H.return();u=(P=w.offlineOrchestrationActionWrapperEntity)!=null?P:new Set;X=[];U=g.G(u);for(f=U.next();!f.done;f=U.next())h=f.value,c=g.Jt(h),Z=c.entityId,Dbt(M.B,Z)||X.push(h);return g.B(H,kVE(M,X),2)}S=H.B;return g.B(H,Q34(M,S),0)})};
Kv.prototype.retry=function(){var w=this;return g.n(function(M){return g.B(M,RTE(w),0)})};vOV.prototype.j1=function(w,M){M=M===void 0?!0:M;var P=this,u,X,U,f,h,c,Z,S;return g.n(function(H){switch(H.L){case 1:if(!P.B)return H.return();u=[];X=g.$l(P.B.L,M);U=[];for(f={vG:0};f.vG<X.length;f={vG:f.vG},f.vG++)h=X[f.vG],c=P.B.YW(h,"json3"),Z=g.qx(c,{withCredentials:!0,format:"RAW"},3,500).then(function(p){return function(F){F={metadata:g.Tt(X[p.vG]),trackData:F.xhr.responseText};U.push(F)}}(f)).NS(function(p){uf("Caption fetch error",p)}),u.push(Z);
return g.B(H,aPx(u),2);case 2:return g.DU(H,3),g.B(H,qZC(w,U),5);case 5:g.zp(H,0);break;case 3:S=g.d4(H),uf("Caption DB transaction error",S),g.yx(H)}})};g.V(bf,g.v);bf.prototype.v3=function(){this.L&&this.L();g.v.prototype.v3.call(this)};
bf.prototype.C=function(w){var M=this,P,u,X,U,f,h,c,Z;return g.n(function(S){u=(P=w.transfer)!=null?P:new Set;X=[];U=g.G(u);for(f=U.next();!f.done;f=U.next())h=f.value,c=g.Jt(h),Z=c.entityId,X.push(Z);return X.length===0?S.return():g.B(S,bba(M,X),0)})};g.V(rK3,g.v);g.N=rK3.prototype;g.N.v3=function(){this.mN&&this.mN();this.ys.dispose();this.X.dispose();this.UO&&g.jm(this.K.RB,this.UO);this.xu&&g.jm(this.K.RB,this.xu);g.v.prototype.v3.call(this)};
g.N.e3$=function(w){var M=this,P,u,X;return g.n(function(U){switch(U.L){case 1:P=g.rt(w,"transfer");if(M.B&&P===M.B.key){vK(M.j,M.G,!0);M.X.stop();U.M0(0);break}return g.B(U,Ci(M.L,{mode:"readwrite",UF:!0},function(f){return bI(f,P,"transfer").then(function(h){if(h&&h.transferState!=="TRANSFER_STATE_COMPLETE"&&h.transferState!=="TRANSFER_STATE_FAILED")return h.transferState="TRANSFER_STATE_PAUSED_BY_USER",gP(f,h,"transfer").then(function(){return h})})}),3);
case 3:u=U.B;if(!u){U.M0(0);break}if(!w||!M.C){U.M0(5);break}return g.B(U,HK(w,M.C,M.L,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.B(U,gl(M,w),7);case 7:X=U.B,w_A({videoId:w,oG:u,offlineModeType:X}),g.yx(U)}})};
g.N.xfN=function(){var w=this;if(this.B&&this.G){vK(this.j,this.G,!1);var M=this.B,P=(M==null?0:M.key)?g.Jt(M.key).entityId:"";P&&this.C&&(new Promise(function(u,X){HK(P,w.C,w.L,"DOWNLOAD_STATE_PAUSED").catch(function(U){X(U)})})).catch(function(u){uf("Download state setting error",u)})}this.X.stop()};
g.N.qa=function(){this.B?tr$(this,this.B):AG(this)};
g.N.Lv=function(w){var M=this;return g.n(function(P){switch(P.L){case 1:if(!M.B){P.M0(2);break}if(M.B.transferState==="TRANSFER_STATE_COMPLETE"||M.B.transferState==="TRANSFER_STATE_FAILED"||!w.transfer||!w.transfer.has(M.B.key)){P.M0(3);break}return g.B(P,xU(M.L,M.B.key,"transfer"),4);case 4:M.B=P.B;if(M.B){P.M0(3);break}return g.B(P,xbt(M),3);case 3:if(M.B)return P.return();case 2:return g.B(P,AG(M),0)}})};
g.N.G9=function(w,M){var P=this,u,X,U,f,h;return g.n(function(c){switch(c.L){case 1:if(!P.B){JG(P,"onTransferFailure: "+w);c.M0(2);break}u=P.B;U=((X=u)==null?0:X.key)?g.Jt(u.key).entityId:"";a:switch(w){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var Z=!1;break a;default:Z=!0}return Z&&$Bx(P)?g.B(c,rl(P,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.B(c,
UBc(P,w),5);case 5:if(!U||!P.C){c.M0(2);break}return g.B(c,HK(U,P.C,P.L,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.B(c,gl(P,U),9);case 9:f=c.B;WK({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:U,oG:u,offlineModeType:f});if(!U||!P.C){c.M0(2);break}return g.B(c,HK(U,P.C,P.L,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:Iq(P),h=AG(P,!0),M&&M(h),g.yx(c)}})};
g.N.MC=function(w){var M=this,P,u,X,U,f,h,c,Z,S,H,p,F;return g.n(function(E){switch(E.L){case 1:if(!M.B){JG(M,"onMaybeTransferStreamsExpired");E.M0(2);break}return $Bx(M)?g.B(E,rl(M,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.B(E,UBc(M,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!M.C){E.M0(2);break}P=M.B;X=((u=P)==null?0:u.key)?g.Jt(P.key).entityId:"";if(!X){E.M0(2);break}return g.B(E,HK(X,M.C,M.L,"DOWNLOAD_STATE_FAILED"),2);case 9:return M.B||JG(M,"onMaybeTransferStreamsExpiredRetryAttempting"),
U=M.B,h=((f=U)==null?0:f.key)?g.Jt(U.key).entityId:"",g.B(E,gl(M,h),10);case 10:return c=E.B,WK({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:h,oG:U,offlineModeType:c}),Z=$Mc(),g.Lq(Z,kZ,{isEnqueuedForExpiredStreamUrlRefetch:!0}),S=g.rt(h,"playbackData"),H={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:S,actionMetadata:Z},p=mW(new Nz("playbackData",h,H)),g.B(E,tq(M.L,p,"offlineOrchestrationActionWrapperEntity"),2);case 2:Iq(M),F=AG(M,!0),
w&&w(F),g.yx(E)}})};
var cRc={},fWA=(cRc.TRANSFER_STATE_TRANSFERRING=1,cRc.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,cRc);g.N=jE.prototype;g.N.q$=function(){return this.G.promise};
g.N.rS=function(){if(this.L&&this.j)return this.G.promise;c_a(this).then(this.G.resolve).catch(this.G.reject);return this.G.promise};
g.N.F6=function(w){var M={};return M.playbackData=new JCE(w,this.P3,this.B),M.transfer=new cKA(w,this.P3),M.videoPlaybackPositionEntity=new aiA(w,this.P3),M};
g.N.xU=function(){var w=this;return g.n(function(M){return w.L?g.B(M,j33(w.L),0):M.M0(0)})};
g.N.yW=function(){var w=this,M,P;return g.n(function(u){if(u.L==1)return w.L||w.j?g.B(u,w.q$(),2):u.return();w.V!==void 0&&(g.HF(w.V),w.V=void 0);w.X!==void 0&&(g.HF(w.X),w.X=void 0);(M=w.L)==null||M.dispose();w.L=void 0;(P=w.j)==null||P.dispose();w.j=void 0;w.api.Vs("onOrchestrationLostLeader");w.G=new g.hC;g.yx(u)})};
g.N.isOrchestrationLeader=function(){return this.C.B};
g.N.hO=function(){return g.n(function(w){return w.return(!1)})};
g.N.nF=function(w){var M=this.B;M.api.publish("offlinetransferpause",w);var P;(P=M.L)==null||P.postMessage(w)};
g.N.qa=function(w){var M,P;return g.n(function(u){if(u.L==1)return g.B(u,a2(),2);M=u.B;if(!M)return u.return();P=g.rt(w,"transfer");return g.B(u,Ci(M,{mode:"readwrite",UF:!0},function(X){var U=bI(X,P,"transfer"),f=bI(X,g.rt(w,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.NZ.all([U,f]).then(function(h){h=g.G(h);var c=h.next().value;var Z=h.next().value;return c&&c.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(c.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",gP(X,c,"transfer").then(function(){WK({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:w,oG:c,offlineModeType:Z==null?void 0:Z.offlineModeType});return g.NZ.resolve(null)})):g.NZ.resolve(null)})}),0)})};
g.N.It=function(w){w=w===void 0?43200:w;var M=this,P,u,X,U,f,h,c,Z;return g.n(function(S){if(S.L==1)return M.K.UH()?g.B(S,a2(),2):S.return(Z_$());if(S.L!=3){P=S.B;if(!P)return S.return([]);u=Date.now()/1E3;return g.B(S,Oi(P,"offlineVideoPolicy"),3)}X=S.B;U=[];f=g.G(X);for(h=f.next();!h.done;h=f.next())c=h.value,Number(c.lastUpdatedTimestampSeconds)+w<=u&&(Z=g.Jt(c.key).entityId,U.push(Z));return U.length?S.return(Cv(M,U,M.S,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):S.return([])})};
g.N.deleteAll=function(){return Cv(this,["!*$_ALL_ENTITIES_!*$"],this.S,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.N.refreshAllStaleEntities=function(w){var M=this;return g.n(function(P){return P.L==1?g.B(P,M.It(w),2):P.return(P.B)})};
g.N.setUpPositionSyncInterval=function(w){var M=this;this.X!==void 0&&(g.HF(this.X),this.X=void 0);var P=w!=null?w:864E5;this.X=g.ZK(function(){M.GV(P)},P)};
g.N.GV=function(w){var M=this,P,u,X,U,f,h;return g.n(function(c){switch(c.L){case 1:return g.DU(c,2),g.B(c,vq.getInstance(),4);case 4:P=c.B;if(!P)throw Error("prefStorage is undefined");return g.B(c,P.get("psi"),5);case 5:u=c.B;U=((X=u)==null?0:X.yg)?Number(u.yg)/1E3:0;f=Date.now();if(!(U+w<=f)){c.M0(6);break}return g.B(c,Cv(M,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.zp(c,0);break;case 2:h=g.d4(c),uf("Offline manager error",h),
g.yx(c)}})};
g.N.KI=function(){var w=this,M,P,u,X,U,f,h;return g.n(function(c){if(c.L==1)return g.B(c,a2(),2);if(c.L!=3)return(M=c.B)?g.B(c,Oi(M,"transfer"),3):c.return([]);P=c.B;u=[];X=g.G(P);for(U=X.next();!U.done;U=X.next())f=U.value,f.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&f.key&&(h=g.Jt(f.key).entityId,u.push(h));return c.return(H_p(w,u))})};
g.N.xP=function(){return g.n(function(w){return w.return([])})};
g.N.JK=function(){return g.n(function(w){g.yx(w)})};
g.N.gE=function(){return g.n(function(w){g.yx(w)})};g.V(pIV,eE);pIV.prototype.L=function(w){return cK(w)?N1c(this,w):ZF(w)?mBc(this,w):SE(w)?oRC(this,w):Promise.reject(Error("Unsupported action type: "+w.actionType))};
var tG=[10];g.V(YNa,eE);YNa.prototype.L=function(w){return cK(w)?dBE(this,w):ZF(w)?lWC(this,w):SE(w)?LZc(this,w):Promise.reject(Error("Unsupported action type: "+w.actionType))};
var T1a=[10];g.V(B1V,eE);B1V.prototype.L=function(w){return ZF(w)?kyp(this,w):Promise.reject(Error("Unsupported action type: "+w.actionType))};g.V(RuC,jE);g.N=RuC.prototype;g.N.F6=function(w){var M=jE.prototype.F6.call(this,w);M.mainVideoEntity=new YNa(w,this.P3,this.B);M.mainPlaylistEntity=new pIV(w,this.P3,this.B);M.mainDownloadsListEntity=new B1V(w,this.P3,this.B);return M};
g.N.refreshAllStaleEntities=function(w,M){var P=this,u,X,U,f,h,c,Z,S,H,p,F;return g.n(function(E){switch(E.L){case 1:u=[];if(!P.P3.D("web_player_offline_playlist_auto_refresh")){E.M0(2);break}return g.B(E,nRC(P,w,M),3);case 3:u=E.B;case 2:return g.B(E,vq.getInstance(),4);case 4:return X=E.B,g.B(E,(U=X)==null?void 0:U.get("sdois"),5);case 5:return f=E.B,g.B(E,(h=X)==null?void 0:h.get("lmqf"),6);case 6:c=E.B;if(!f){E.M0(7);break}S=u;H=S.concat;return g.B(E,vRE(P,f,(Z=c)!=null?Z:"SD",w===0),8);case 8:u=
H.call(S,E.B);case 7:return p=u,F=p.concat,g.B(E,jE.prototype.refreshAllStaleEntities.call(P,w,M),9);case 9:return u=F.call(p,E.B),E.return(u)}})};
g.N.hO=function(w){var M,P,u,X,U,f,h,c;return g.n(function(Z){if(Z.L==1)return g.B(Z,a2(),2);if(Z.L!=3)return(M=Z.B)?g.B(Z,xU(M,g.KT,"mainDownloadsListEntity"),3):Z.return(!1);P=Z.B;if((u=P)==null?0:(X=u.downloads)==null?0:X.length)for(U=g.rt(w,"mainVideoEntity"),f=g.G(P.downloads),h=f.next();!h.done;h=f.next())if(c=h.value,c.videoItem===U)return Z.return(!0);return Z.return(!1)})};
g.N.xP=function(){var w=this,M,P,u,X,U,f,h,c;return g.n(function(Z){if(Z.L==1)return g.B(Z,a2(),2);if(Z.L!=3)return(M=Z.B)?g.B(Z,Oi(M,"downloadStatusEntity"),3):Z.return([]);P=Z.B;u=[];X=g.G(P);for(U=X.next();!U.done;U=X.next())f=U.value,f.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&f.key&&(h=g.Jt(f.key).entityId,u.push(h));return u.length?(c={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},Z.return(Cv(w,u,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
c))):Z.return([])})};
g.N.gE=function(){var w;return g.n(function(M){return M.L==1?g.B(M,a2(),2):(w=M.B)?g.B(M,Ci(w,{mode:"readwrite",UF:!0},function(P){return I2(P,"mainVideoEntity").then(function(u){var X=[];u=g.G(u);for(var U=u.next();!U.done;U=u.next()){U=U.value;var f=void 0;(f=U.userState)!=null&&f.playbackPosition||(f=g.Jt(U.key).entityId,f={key:g.rt(f,"videoPlaybackPositionEntity"),videoId:f,lastPlaybackPositionSeconds:"0"},X.push(gP(P,f,"videoPlaybackPositionEntity")),U.userState={playbackPosition:f.key},X.push(gP(P,
U,"mainVideoEntity")))}return g.NZ.all(X)})}),0):M.return()})};
g.N.JK=function(){var w,M,P,u,X,U,f,h,c,Z,S,H,p,F,E,y,q,d,l,e,R,I,w4,t,$M,fz,U1,ZU,M_,Tp,kM,w3,sE,Vt,v5,OE,pC,g3;return g.n(function(MK){if(MK.L==1)return g.B(MK,a2(),2);if(MK.L!=3){w=MK.B;if(!w)return MK.return();M=g.rt("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.B(MK,Ci(w,{mode:"readonly",UF:!0},function(T){return g.NZ.all([bI(T,M,"mainDownloadsListEntity"),bI(T,g.KT,"mainDownloadsListEntity"),I2(T,"mainVideoEntity"),I2(T,"mainPlaylistEntity")])}),3)}P=MK.B;
u=g.G(P);X=u.next().value;U=u.next().value;f=u.next().value;h=u.next().value;c=X;Z=U;S=f;H=h;p=new Set;if((F=c)==null?0:(E=F.downloads)==null?0:E.length)for(y=g.G(c.downloads),q=y.next();!q.done;q=y.next())d=q.value,l=void 0,(e=(l=d.videoItem)!=null?l:d.playlistItem)&&p.add(e);if((R=Z)==null?0:(I=R.downloads)==null?0:I.length)for(w4=g.G(Z.downloads),t=w4.next();!t.done;t=w4.next())$M=t.value,$M.videoItem&&p.add($M.videoItem);fz=new Set;U1=[];ZU=g.G(H);for(M_=ZU.next();!M_.done;M_=ZU.next()){Tp=M_.value;
if(Tp.videos)for(kM=g.G(Tp.videos),w3=kM.next();!w3.done;w3=kM.next())sE=w3.value,(Vt=JSON.parse(g.Jt(sE).entityId).videoId)&&fz.add(Vt);Tp.key&&!p.has(Tp.key)&&U1.push(Tp.key)}v5=g.G(S);for(OE=v5.next();!OE.done;OE=v5.next())pC=OE.value,pC.key&&!p.has(pC.key)&&(g3=g.Jt(pC.key).entityId,fz.has(g3)||U1.push(pC.key));return U1.length?g.B(MK,V63(w,U1),0):MK.M0(0)})};g.V(sCE,eE);sCE.prototype.L=function(w){return cK(w)?b_$(this,w):ZF(w)?IW4(this,w):SE(w)?A_3(this,w):Promise.reject(Error("Unsupported action type: "+w.actionType))};
var Ot=[10];g.V(J_V,eE);J_V.prototype.L=function(w){return cK(w)?jCE(this,w):ZF(w)?Cox(this,w):SE(w)?tDA(this,w):Promise.reject(Error("Unsupported action type: "+w.actionType))};
var aq=[10];g.V(aW3,eE);aW3.prototype.L=function(w){return cK(w)?PUx(this,w):ZF(w)?uqC(this,w):SE(w)?Xix(this,w):Promise.reject(Error("Unsupported action type: "+w.actionType))};
var M2U=[10];g.V(wF,jE);wF.prototype.F6=function(w){var M=jE.prototype.F6.call(this,w);M.musicTrack=new aW3(w,this.B);M.musicPlaylist=new J_V(w,this.B);M.musicAlbumRelease=new sCE(w,this.B);return M};
wF.prototype.refreshAllStaleEntities=function(w,M){var P=this,u,X,U;return g.n(function(f){if(f.L==1)return g.B(f,UTE(P,w,M),2);if(f.L!=3)return X=u=f.B,U=X.concat,g.B(f,jE.prototype.refreshAllStaleEntities.call(P,w,M),3);u=U.call(X,f.B);return f.return(u)})};g.V(fYE,g.D0);g.N=fYE.prototype;g.N.create=function(){var w=this;g.b(this,this.events);if(g.fp(this.P3))this.B=new RuC(this.P3,this.player);else if(g.LW(this.P3)||g.hW(this.P3))this.B=new wF(this.P3,this.player);this.events.Y(this.player,"onPlaybackStartExternal",function(){w.Yn()});
this.events.Y(this.player,"videodatachange",function(){w.Yn()});
this.P3.D("html5_offline_playback_position_sync")&&this.events.Y(this.player,"presentingplayerstatechange",this.K4)};
g.N.Yo=function(){return!1};
g.N.Ga=function(w,M,P,u){var X=this;return g.n(function(U){return X.B?U.return(Cv(X.B,w,M,P,u)):U.return(Promise.reject())})};
g.N.deleteAll=function(){return this.B.deleteAll()};
g.N.It=function(w){return this.B.It(w)};
g.N.refreshAllStaleEntities=function(w){return this.B.refreshAllStaleEntities(w)};
g.N.setUpPositionSyncInterval=function(w){this.B.setUpPositionSyncInterval(w)};
g.N.nF=function(w){this.B.nF(w)};
g.N.qa=function(w){return this.B.qa(w)};
g.N.Yn=function(){var w=this,M;return g.n(function(P){M=w.player.getVideoData();return g.uD(M)?WbA(M)&&w.L!==M.clientPlaybackNonce?g.B(P,h$U(w,M),0):P.M0(0):P.return()})};
g.N.K4=function(w){var M=this,P,u,X,U,f,h,c;return g.n(function(Z){if(Z.L==1)return P=M.player.getVideoData(),u=P.TE,g.fW(w,2)||g.fW(w,512)?g.B(Z,a2(),2):Z.return();if(Z.L!=3){X=Z.B;if(!X)return uf("PES is undefined"),Z.return();U=P.videoId;return g.B(Z,xU(X,g.rt(U,"mainVideoEntity"),"mainVideoEntity"),3)}f=Z.B;if(!f)return Z.return();h=Math.floor(u).toString();c={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:h}};return g.B(Z,M.Ga([U],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
c),0)})};
g.N.isOrchestrationLeader=function(){return this.B.isOrchestrationLeader()};
g.N.updateDownloadState=function(w,M){var P,u,X,U;return g.n(function(f){if(f.L==1)return g.B(f,a2(),2);P=f.B;if(!P)return uf("PES is undefined"),f.return();u=g.Jt(w);X=u.entityType;U=u.entityId;return g.B(f,HK(U,X,P,M,!0),0)})};g.yT("offline",fYE);})(_yt_player);
